<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bloco de Notas com Análise de Plantões</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <style>
        /* Seus estilos CSS permanecem iguais */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            color: #333;
            padding: 10px;
            min-height: 100vh;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
            flex: 1;
        }
        header {
            text-align: center;
            margin-bottom: 15px;
            width: 100%;
            position: relative;
        }
        h1 {
            color: #2c3e50;
            font-size: 1.8rem;
            margin-bottom: 5px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        .subtitle {
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        
        .calendar-section, .notes-section, .analytics-section {
            width: 100%;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.08);
            transition: transform 0.3s ease;
            padding: 15px;
        }
        .calendar-section:hover, .notes-section:hover, .analytics-section:hover {
            transform: translateY(-5px);
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid #eee;
        }
        .section-header h2 {
            margin: 0;
            color: #2c3e50;
            flex: 1;
        }
        .toggle-section {
            background: none;
            border: none;
            color: #7f8c8d;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
        }
        .toggle-section:hover {
            background-color: #f0f0f0;
            color: #3498db;
        }
        
        .section-hidden .section-content {
            display: none;
        }
        .section-hidden {
            padding-bottom: 15px;
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid #eee;
        }
        .calendar-title {
            font-size: 1.1rem;
            color: #2c3e50;
        }
        .calendar-controls {
            display: flex;
            gap: 8px;
        }
        .calendar-control {
            background: #3498db;
            color: white;
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            touch-action: manipulation;
            box-shadow: 0 2px 5px rgba(52, 152, 219, 0.3);
        }
        .calendar-control:hover {
            background: #2980b9;
            transform: scale(1.1);
            box-shadow: 0 4px 8px rgba(52, 152, 219, 0.4);
        }
        .calendar-control:active {
            transform: scale(0.95);
        }
        
        .search-container {
            margin-bottom: 15px;
        }
        .search-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 0.9rem;
            background: #f9f9f9;
        }
        .search-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        .calendar-pagination {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #eee;
        }
        .pagination-info {
            font-size: 0.85rem;
            color: #7f8c8d;
        }
        .pagination-controls {
            display: flex;
            gap: 5px;
        }
        .pagination-btn {
            background: #f0f0f0;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s;
        }
        .pagination-btn:hover {
            background: #e0e0e0;
        }
        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        #calendar {
            width: 100%;
            border-collapse: collapse;
        }
        #calendar th, #calendar td {
            padding: 2px 2px;
            text-align: center;
            border: 1px solid #eee;
        }
        #calendar th {
            background-color: #f8f9fa;
            color: #2c3e50;
            font-weight: 600;
            font-size: 0.75rem;
        }
        #calendar td {
            height: 45px;
            vertical-align: top;
            position: relative;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        #calendar td:hover {
            background-color: #f5f7fa;
        }
        .today {
            background-color: #3498db;
            color: white;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 3px;
            font-size: 0.9rem;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(52, 152, 219, 0.5);
            border: 2px solid #2980b9;
        }
        .day-number {
            font-weight: bold;
            margin-bottom: 2px;
            font-size: 0.8rem;
        }
        .plantao {
            border-radius: 4px;
            padding: 1px;
            font-size: 0.65rem;
            margin-top: 1px;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            cursor: pointer;
            max-width: 100%;
        }
        .plantao:hover {
            opacity: 0.8;
        }
        .plantao:active {
            opacity: 0.7;
        }
        .plantao-blue {
            background-color: #2196F3;
            color: white;
        }
        .plantao-green {
            background-color: #4CAF50;
            color: white;
        }
        .plantao-red {
            background-color: #F44336;
            color: white;
        }
        .plantao-yellow {
            background-color: #FFEB3B;
            color: #333;
        }
        .plantao-purple {
            background-color: #9C27B0;
            color: white;
        }
        .plantao-orange {
            background-color: #FF9800;
            color: white;
        }
        
        .notes-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .notes-search {
            flex: 1;
            margin-right: 10px;
        }
        .notes-search-input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 0.9rem;
        }
        .notes-search-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        .sort-options {
            display: flex;
            gap: 5px;
        }
        .sort-btn {
            background: #f0f0f0;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s;
        }
        .sort-btn:hover {
            background: #e0e0e0;
        }
        .sort-btn.active {
            background: #3498db;
            color: white;
            border-color: #3498db;
        }
        
        .notes-mosaic {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
            max-height: 400px;
            overflow-y: auto;
        }
        .note-card {
            border-radius: 8px;
            padding: 10px;
            min-height: 120px;
            position: relative;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            display: flex;
            flex-direction: column;
        }
        .note-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .note-card.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
        }
        .note-title {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 0.9rem;
            border-bottom: 1px solid rgba(0,0,0,0.1);
            padding-bottom: 3px;
        }
        .note-content {
            flex: 1;
            overflow: hidden;
            font-size: 0.8rem;
            white-space: pre-wrap;
            word-break: break-word;
        }
        .note-date {
            font-size: 0.7rem;
            opacity: 0.7;
            margin-top: 5px;
            text-align: right;
        }
        .note-delete {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(255,255,255,0.7);
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 0.7rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.2s;
        }
        .note-card:hover .note-delete {
            opacity: 1;
        }
        .note-yellow {
            background-color: #FFEB3B;
        }
        .note-brown {
            background-color: #9e6f39;
        }
        .note-blue {
            background-color: #80D8FF;
        }
        .note-green {
            background-color: #B9F6CA;
        }
        .note-purple {
            background-color: #EA80FC;
        }
        .note-orange {
            background-color: #FFD180;
        }
        
        .fab-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 100;
        }
        .fab {
            width: 70px;
            height: 40px;
            border-radius: 20px;
            background-color: #3498db;
            color: white;
            border: none;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: all 0.3s ease;
            outline: none;
        }
        .fab:hover {
            background-color: #2980b9;
            transform: scale(1.1);
        }
        .fab:active {
            transform: scale(0.95);
        }
        .fab-menu {
            position: absolute;
            bottom: 50px;
            right: 0;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            padding: 8px 0;
            width: 200px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(10px);
            transition: all 0.3s ease;
        }
        .fab-menu.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        .fab-menu-item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .fab-menu-item:hover {
            background-color: #f5f7fa;
        }
        .fab-menu-icon {
            margin-right: 12px;
            font-size: 20px;
            width: 24px;
            text-align: center;
        }
        .fab-menu-text {
            font-size: 16px;
            color: #333;
        }
        
        .notes-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
        }
        .btn {
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            touch-action: manipulation;
            font-size: 0.85rem;
        }
        .btn-clear {
            background-color: #e74c3c;
            color: white;
            padding: 6px 10px;
            font-size: 0.8rem;
        }
        .btn-clear:hover {
            background-color: #c0392b;
        }
        .btn-clear:active {
            background-color: #a93226;
        }
        .btn-save {
            background-color: #4CAF50;
            color: white;
        }
        .btn-save:hover {
            background-color: #45a049;
        }
        .btn-save:active {
            background-color: #3d8b40;
        }
        .notes-count {
            font-size: 0.8rem;
            color: #7f8c8d;
        }
        footer {
            text-align: center;
            margin-top: 15px;
            color: #7f8c8d;
            font-size: 0.8rem;
            width: 100%;
            padding-bottom: 70px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 10px;
        }
        .modal-content {
            background-color: white;
            padding: 15px;
            border-radius: 12px;
            width: 100%;
            max-width: 500px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            max-height: 90vh;
            overflow-y: auto;
        }
        .modal-content.edit-mode {
            border: 2px solid #3498db;
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.5);
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid #eee;
        }
        .modal-title {
            font-size: 1.2rem;
            color: #2c3e50;
        }
        .close-modal {
            background: none;
            border: none;
            font-size: 1.4rem;
            cursor: pointer;
            color: #7f8c8d;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            touch-action: manipulation;
        }
        .close-modal:hover {
            background-color: #f0f0f0;
        }
        .close-modal:active {
            background-color: #e0e0e0;
        }
        .form-group {
            margin-bottom: 12px;
        }
        .form-group label {
            display: block;
            margin-bottom: 4px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 0.9rem;
        }
        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-family: inherit;
            font-size: 0.9rem;
            touch-action: manipulation;
        }
        .form-control:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        .modal-actions {
            display: flex;
            justify-content: space-between;
            gap: 8px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        .btn-delete {
            background-color: #e74c3c;
            color: white;
        }
        .btn-delete:hover {
            background-color: #c0392b;
        }
        .btn-delete:active {
            background-color: #a93226;
        }
        
        .color-selector {
            display: flex;
            gap: 8px;
            margin-top: 6px;
            flex-wrap: wrap;
        }
        .color-option {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
        }
        .color-option:hover {
            transform: scale(1.1);
        }
        .color-option.selected {
            border-color: #333;
            box-shadow: 0 0 0 2px white, 0 0 0 4px #333;
        }
        .color-blue {
            background-color: #2196F3;
        }
        .color-green {
            background-color: #4CAF50;
        }
        .color-red {
            background-color: #F44336;
        }
        .color-yellow {
            background-color: #FFEB3B;
        }
        .color-purple {
            background-color: #9C27B0;
        }
        .color-orange {
            background-color: #FF9800;
        }
        
        .day-plantoes {
            margin-top: 12px;
            border-top: 1px solid #eee;
            padding-top: 12px;
        }
        .day-plantoes-title {
            font-size: 0.95rem;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        .plantao-list {
            max-height: 200px;
            overflow-y: auto;
        }
        .plantao-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px;
            margin-bottom: 6px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .plantao-item:hover {
            transform: translateX(5px);
        }
        .plantao-info {
            flex: 1;
        }
        .plantao-title {
            font-weight: 600;
            margin-bottom: 2px;
            font-size: 0.85rem;
        }
        .plantao-time {
            font-size: 0.75rem;
            opacity: 0.8;
        }
        .plantao-actions {
            display: flex;
            gap: 4px;
        }
        .plantao-action {
            background: none;
            border: none;
            cursor: pointer;
            color: #7f8c8d;
            font-size: 0.9rem;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        .plantao-action:hover {
            background-color: rgba(0, 0, 0, 0.1);
        }
        
        .note-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 10px;
        }
        .note-modal-content {
            background-color: white;
            padding: 15px;
            border-radius: 12px;
            width: 100%;
            max-width: 500px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        .note-modal-content.edit-mode {
            border: 2px solid #3498db;
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.5);
        }
        
        .scale-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }
        .scale-option {
            flex: 1;
            min-width: 100px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background-color: white;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            font-size: 0.85rem;
        }
        .scale-option:hover {
            background-color: #f5f7fa;
            border-color: #3498db;
        }
        .scale-option.selected {
            background-color: #3498db;
            color: white;
            border-color: #3498db;
        }
        .scale-info {
            font-size: 0.75rem;
            color: #7f8c8d;
            margin-top: 4px;
        }
        
        .alternate-days-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }
        .alternate-day-option {
            flex: 1;
            min-width: 100px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background-color: white;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            font-size: 0.85rem;
        }
        .alternate-day-option:hover {
            background-color: #f5f7fa;
            border-color: #3498db;
        }
        .alternate-day-option.selected {
            background-color: #3498db;
            color: white;
            border-color: #3498db;
        }
        
        .toast {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background-color: #333;
            color: white;
            padding: 10px 20px;
            border-radius: 30px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            opacity: 0;
            transition: transform 0.3s, opacity 0.3s;
            z-index: 2000;
            max-width: 90%;
            text-align: center;
            font-size: 0.9rem;
        }
        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }
        
        .note-view-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 10px;
        }
        .note-view-content {
            background-color: white;
            padding: 15px;
            border-radius: 12px;
            width: 100%;
            max-width: 500px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            max-height: 90vh;
            overflow-y: auto;
        }
        .note-view-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid #eee;
        }
        .note-view-title {
            font-size: 1.2rem;
            color: #2c3e50;
            font-weight: bold;
        }
        .note-view-body {
            margin-bottom: 15px;
        }
        .note-view-content-text {
            white-space: pre-wrap;
            word-break: break-word;
            font-size: 0.9rem;
            line-height: 1.5;
            color: #333;
        }
        .note-view-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px solid #eee;
            font-size: 0.8rem;
            color: #7f8c8d;
        }
        .note-view-actions {
            display: flex;
            gap: 8px;
        }
        .btn-view {
            padding: 6px 10px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-size: 0.8rem;
        }
        .btn-edit-view {
            background-color: #3498db;
            color: white;
        }
        .btn-edit-view:hover {
            background-color: #2980b9;
        }
        .btn-delete-view {
            background-color: #e74c3c;
            color: white;
        }
        .btn-delete-view:hover {
            background-color: #c0392b;
        }
        
        .plantao-view-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 10px;
        }
        .plantao-view-content {
            background-color: white;
            padding: 15px;
            border-radius: 12px;
            width: 100%;
            max-width: 500px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            max-height: 90vh;
            overflow-y: auto;
        }
        .plantao-view-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid #eee;
        }
        .plantao-view-title {
            font-size: 1.2rem;
            color: #2c3e50;
            font-weight: bold;
        }
        .plantao-view-body {
            margin-bottom: 15px;
        }
        .plantao-view-description {
            white-space: pre-wrap;
            word-break: break-word;
            font-size: 0.9rem;
            line-height: 1.5;
            color: #333;
            margin-bottom: 10px;
        }
        .plantao-view-time {
            font-size: 0.85rem;
            color: #7f8c8d;
            margin-bottom: 10px;
        }
        .plantao-view-color {
            display: inline-block;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            margin-right: 8px;
            vertical-align: middle;
        }
        .plantao-view-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px solid #eee;
            font-size: 0.8rem;
            color: #7f8c8d;
        }
        .plantao-view-actions {
            display: flex;
            gap: 8px;
        }
        .btn-new-view {
            background-color: #4CAF50;
            color: white;
        }
        .btn-new-view:hover {
            background-color: #45a049;
        }
        
        .settings-content {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .shifts-list {
            margin-top: 10px;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 8px;
        }
        .shift-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            margin-bottom: 6px;
            background-color: #f9f9f9;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .shift-item:hover {
            background-color: #f0f0f0;
        }
        .shift-info {
            flex: 1;
        }
        .shift-name {
            font-weight: 600;
            margin-bottom: 2px;
            font-size: 0.9rem;
        }
        .shift-hours {
            font-size: 0.8rem;
            color: #7f8c8d;
        }
        .shift-value {
            font-size: 0.8rem;
            color: #27ae60;
            font-weight: 600;
        }
        .shift-actions {
            display: flex;
            gap: 4px;
        }
        .shift-action {
            background: none;
            border: none;
            cursor: pointer;
            color: #7f8c8d;
            font-size: 0.9rem;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        .shift-action:hover {
            background-color: rgba(0, 0, 0, 0.1);
        }
        .add-shift-form {
            margin-top: 10px;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 6px;
        }
        .form-row {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
            flex-wrap: wrap;
        }
        .form-row .form-group {
            flex: 1;
            margin-bottom: 0;
            min-width: 120px;
        }
        
        .shifts-selector {
            margin-top: 8px;
            max-height: 150px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 8px;
        }
        .shift-option {
            padding: 8px;
            margin-bottom: 6px;
            background-color: #f9f9f9;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .shift-option:hover {
            background-color: #e9f5ff;
            border-color: #3498db;
        }
        .shift-option.selected {
            background-color: #e9f5ff;
            border: 1px solid #3498db;
        }
        .shift-option-info {
            flex: 1;
        }
        .shift-option-name {
            font-weight: 600;
            margin-bottom: 2px;
            font-size: 0.9rem;
        }
        .shift-option-hours {
            font-size: 0.8rem;
            color: #7f8c8d;
        }
        .shift-option-value {
            font-size: 0.8rem;
            color: #27ae60;
            font-weight: 600;
        }
        
        .analytics-filters {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        .filter-group label {
            font-size: 0.8rem;
            font-weight: 600;
            color: #2c3e50;
        }
        .filter-select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 0.9rem;
        }
        .charts-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }
        .chart-wrapper {
            background: #f9f9f9;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .chart-title {
            text-align: center;
            margin-bottom: 10px;
            color: #2c3e50;
            font-weight: 600;
        }
        .analytics-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .summary-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            text-align: center;
        }
        .summary-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #3498db;
            margin: 10px 0;
        }
        .summary-label {
            font-size: 0.9rem;
            color: #7f8c8d;
        }

        @media (min-width: 992px) {
            .charts-container {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            .calendar-controls {
                flex-direction: row;
                align-items: center;
            }
            .calendar-control {
                width: 36px;
                height: 36px;
                font-size: 1.1rem;
            }
            .modal-content, .note-modal-content, .note-view-content, .plantao-view-content {
                width: 100%;
                padding: 12px;
            }
            h1 {
                font-size: 1.6rem;
            }
            .subtitle {
                font-size: 0.85rem;
            }
            #calendar th, #calendar td {
                padding: 3px 1px;
            }
            #calendar td {
                height: 40px;
            }
            .today {
                width: 24px;
                height: 24px;
                font-size: 0.8rem;
            }
            .plantao {
                font-size: 0.6rem;
            }
            .btn {
                padding: 10px 12px;
                font-size: 0.8rem;
            }
            .btn-clear {
                padding: 5px 8px;
                font-size: 0.75rem;
            }
            .modal-actions {
                flex-direction: column;
            }
            .modal-actions .btn {
                width: 100%;
            }
            .color-option {
                width: 32px;
                height: 32px;
            }
            .notes-mosaic {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
            .fab {
                width: 66px;
                height: 38px;
                font-size: 18px;
            }
            .fab-menu {
                width: 180px;
            }
            .alternate-day-option, .scale-option {
                min-width: 80px;
                font-size: 0.8rem;
            }
            .form-row {
                flex-direction: column;
            }
            .analytics-filters {
                flex-direction: column;
            }
            .notes-header {
                flex-direction: column;
                gap: 10px;
            }
            .notes-search {
                margin-right: 0;
                margin-bottom: 10px;
            }
            .sort-options {
                width: 100%;
                justify-content: space-between;
            }
        }
        
        @media (max-width: 480px) {
            body {
                padding: 8px;
            }
            .calendar-section, .notes-section, .analytics-section {
                padding: 12px;
            }
            #calendar th {
                font-size: 0.7rem;
                padding: 2px 1px;
            }
            #calendar td {
                height: 35px;
                padding: 2px 1px;
            }
            .today {
                width: 20px;
                height: 20px;
                font-size: 0.75rem;
            }
            .day-number {
                font-size: 0.75rem;
            }
            .plantao {
                font-size: 0.55rem;
            }
            .modal-title {
                font-size: 1rem;
            }
            .notes-mosaic {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
                gap: 8px;
            }
            .note-card {
                min-height: 100px;
                padding: 8px;
            }
            .fab {
                width: 62px;
                height: 36px;
                font-size: 16px;
            }
            .fab-menu {
                width: 160px;
            }
            .btn-clear {
                padding: 4px 6px;
                font-size: 0.7rem;
            }
            .alternate-day-option, .scale-option {
                min-width: 70px;
                font-size: 0.75rem;
                padding: 6px;
            }
            .analytics-summary {
                grid-template-columns: 1fr 1fr;
            }
            .summary-value {
                font-size: 1.2rem;
            }
            .sort-options {
                flex-wrap: wrap;
            }
            .sort-btn {
                flex: 1;
                min-width: 60px;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>Bloco de Notas com Análise de Plantões</h1>
        <p class="subtitle">Organize suas tarefas e anotações.</p>
    </header>
    <div class="container">
        <div class="calendar-section">
            <div class="calendar-header">
                <h2 class="calendar-title" id="calendar-title">Janeiro 2025</h2>
                <div class="calendar-controls">
                    <button class="calendar-control" id="prev-month">👈🏻</button>
                    <button class="calendar-control" id="next-month">👉🏻</button>
                </div>
            </div>
            
            <div class="search-container">
                <input type="text" class="search-input" id="plantao-search" placeholder="🔍 Buscar plantões por título...">
            </div>
            
            <table id="calendar">
                <thead>
                    <tr>
                        <th>Dom</th>
                        <th>Seg</th>
                        <th>Ter</th>
                        <th>Qua</th>
                        <th>Qui</th>
                        <th>Sex</th>
                        <th>Sáb</th>
                    </tr>
                </thead>
                <tbody id="calendar-body">
                </tbody>
            </table>
            
            <div class="calendar-pagination">
                <div class="pagination-info" id="pagination-info">Mostrando 1-30 de 30 dias</div>
                <div class="pagination-controls">
                    <button class="pagination-btn" id="prev-page" disabled>Anterior</button>
                    <button class="pagination-btn" id="next-page" disabled>Próxima</button>
                </div>
            </div>
        </div>
        <div class="notes-section" id="notes-section">
            <div class="section-header">
                <h4>Minhas Notas</h4>
                <button class="toggle-section" id="toggle-notes" title="Ocultar/Mostrar seção">👁️</button>
            </div>
            <div class="section-content">
                <div class="notes-header">
                    <div class="notes-search">
                        <input type="text" class="notes-search-input" id="notes-search" placeholder="🔍 Buscar notas...">
                    </div>
                    <div class="sort-options">
                        <button class="sort-btn active" id="sort-date" data-sort="date">Data</button>
                        <button class="sort-btn" id="sort-title" data-sort="title">Título</button>
                        <button class="sort-btn" id="sort-color" data-sort="color">Cor</button>
                    </div>
                </div>
                
                <div class="notes-mosaic" id="notes-mosaic">
                </div>
                <div class="notes-actions">
                    <div class="notes-count" id="notes-count">0 notas</div>
                    <button class="btn btn-clear" id="clear-notes">Limpar</button>
                </div>
            </div>
        </div>

        <div class="analytics-section" id="analytics-section">
            <div class="section-header">
                <h4>📊 Análise de Plantões</h4>
                <button class="toggle-section" id="toggle-analytics" title="Ocultar/Mostrar seção">👁️</button>
            </div>
            <div class="section-content">
                <div class="analytics-filters">
                    <div class="filter-group">
                        <label for="period-filter">Período</label>
                        <select id="period-filter" class="filter-select">
                            <option value="month">Este mês</option>
                            <option value="last-month">Mês anterior</option>
                            <option value="quarter">Este trimestre</option>
                            <option value="semester">Este semestre</option>
                            <option value="year">Este ano</option>
                            <option value="all">Todos</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="chart-type-filter">Tipo de Gráfico</label>
                        <select id="chart-type-filter" class="filter-select">
                            <option value="bar">Barras</option>
                            <option value="line">Linhas</option>
                            <option value="pie">Pizza</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="group-by-filter">Agrupar por</label>
                        <select id="group-by-filter" class="filter-select">
                            <option value="day">Dia</option>
                            <option value="week">Semana</option>
                            <option value="month">Mês</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>&nbsp;</label>
                        <button class="btn btn-save" id="apply-filters">Aplicar</button>
                    </div>
                    <div class="filter-group">
                        <label>&nbsp;</label>
                        <button class="btn btn-save" id="recalculate-values">Recalcular</button>
                    </div>
                </div>

                <div class="analytics-summary" id="analytics-summary">
                </div>

                <div class="charts-container">
                    <div class="chart-wrapper">
                        <h3 class="chart-title">Plantões por Tipo</h3>
                        <canvas id="shifts-by-type-chart"></canvas>
                    </div>
                    <div class="chart-wrapper">
                        <h3 class="chart-title">Valores por Mês</h3>
                        <canvas id="values-by-month-chart"></canvas>
                    </div>
                    <div class="chart-wrapper">
                        <h3 class="chart-title">Distribuição por Dia da Semana</h3>
                        <canvas id="shifts-by-weekday-chart"></canvas>
                    </div>
                    <div class="chart-wrapper">
                        <h3 class="chart-title">Evolução de Valores</h3>
                        <canvas id="values-evolution-chart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <footer>
        <p>&copy; 2025 Bloco de Notas Interativo | Feito com HTML, CSS e JavaScript</p>
    </footer>

    <div class="fab-container">
        <div class="fab-menu" id="fab-menu">
            <div class="fab-menu-item" id="home-btn">
                <span class="fab-menu-icon">🏠</span>
                <span class="fab-menu-text">Início</span>
            </div>
            <div class="fab-menu-item" id="add-plantao-btn">
                <span class="fab-menu-icon">📅</span>
                <span class="fab-menu-text">Plantão</span>
            </div>
            <div class="fab-menu-item" id="add-note-btn">
                <span class="fab-menu-icon">📝</span>
                <span class="fab-menu-text">Nota</span>
            </div>
            <div class="fab-menu-item" id="settings-btn">
                <span class="fab-menu-icon">⚙️</span>
                <span class="fab-menu-text">Ajustes</span>
            </div>
            <div class="fab-menu-item" id="analytics-btn">
                <span class="fab-menu-icon">📊</span>
                <span class="fab-menu-text">Análise</span>
            </div>
        </div>
        <button class="fab" id="fab-btn">👆🏻</button>
    </div>

    <div class="modal" id="plantao-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modal-title">🚑 Adicionar Plantão</h3>
                <button class="close-modal" id="close-modal">&times;</button>
            </div>
            <form id="plantao-form">
                <input type="hidden" id="plantao-date">
                <input type="hidden" id="plantao-id">
                <div class="form-group">
                    <label for="plantao-date-picker">📆 Data do Plantão</label>
                    <input type="date" id="plantao-date-picker" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="plantao-title">🏥 Título do Plantão</label>
                    <input type="text" id="plantao-title" class="form-control" maxlength="10" placeholder="Máx. 10 caracteres" required>
                </div>
                <div class="form-group">
                    <label>✔️ Selecione um Plantão Pré-definido</label>
                    <div class="shifts-selector" id="shifts-selector">
                    </div>
                </div>
                <div class="form-group">
                    <label for="plantao-description">📝 Descrição</label>
                    <textarea id="plantao-description" class="form-control" rows="2"></textarea>
                </div>
                <div class="form-group">
                    <label for="plantao-time">⏰ Hora (opcional)</label>
                    <input type="time" id="plantao-time" class="form-control">
                </div>
                <div class="form-group">
                    <label>🎨 Cor do Plantão</label>
                    <div class="color-selector">
                        <div class="color-option color-blue selected" data-color="blue"></div>
                        <div class="color-option color-green" data-color="green"></div>
                        <div class="color-option color-red" data-color="red"></div>
                        <div class="color-option color-yellow" data-color="yellow"></div>
                        <div class="color-option color-purple" data-color="purple"></div>
                        <div class="color-option color-orange" data-color="orange"></div>
                    </div>
                </div>
                <div class="form-group">
                    <label>📋 Padrões de Escala de Plantão</label>
                    <div class="scale-selector" id="scale-selector">
                        <div class="scale-option" data-type="12x24">
                            12x24
                            <div class="scale-info">12h trab, 24h desc</div>
                        </div>
                        <div class="scale-option" data-type="12x36">
                            12x36
                            <div class="scale-info">12h trab, 36h desc</div>
                        </div>
                        <div class="scale-option" data-type="24x72">
                            24x72
                            <div class="scale-info">24h trab, 72h desc</div>
                        </div>
                        <div class="scale-option" data-type="custom">
                            Personalizado
                            <div class="scale-info">Dias específicos</div>
                        </div>
                    </div>
                </div>
                <div class="form-group" id="custom-days-selector" style="display: none;">
                    <label>📅 Dias Personalizados</label>
                    <div class="alternate-days-selector">
                        <div class="alternate-day-option" data-type="odd">Dias Ímpares</div>
                        <div class="alternate-day-option" data-type="even">Dias Pares</div>
                        <div class="alternate-day-option" data-type="every3">A cada 3 dias</div>
                        <div class="alternate-day-option" data-type="every4">A cada 4 dias</div>
                    </div>
                </div>
                <div class="modal-actions">
                    <div>
                        <button type="button" class="btn btn-delete" id="delete-plantao" style="display: none;">❌ Excluir</button>
                    </div>
                    <div>
                        <button type="submit" class="btn btn-save">✅ Salvar</button>
                    </div>
                </div>
            </form>
            
            <div class="day-plantoes" id="day-plantoes">
                <h4 class="day-plantoes-title">🗒️ Plantões deste dia</h4>
                <div class="plantao-list" id="plantao-list">
                </div>
            </div>
        </div>
    </div>

    <div class="note-modal" id="note-modal">
        <div class="note-modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="note-modal-title">📝 Adicionar Nota</h3>
                <button class="close-modal" id="close-note-modal">&times;</button>
            </div>
            <form id="note-form">
                <input type="hidden" id="note-id">
                <div class="form-group">
                    <label for="note-title">✏️ Título da Nota</label>
                    <input type="text" id="note-title" class="form-control" placeholder="Título da nota" required>
                </div>
                <div class="form-group">
                    <label for="note-content">📝 Conteúdo da Nota</label>
                    <textarea id="note-content" class="form-control" rows="5" placeholder="Escreva sua nota aqui..." required></textarea>
                </div>
                <div class="form-group">
                    <label>🎨 Cor da Nota</label>
                    <div class="color-selector">
                        <div class="color-option color-yellow selected" data-color="yellow"></div>
                        <div class="color-option color-brown" data-color="brown"></div>
                        <div class="color-option color-blue" data-color="blue"></div>
                        <div class="color-option color-green" data-color="green"></div>
                        <div class="color-option color-purple" data-color="purple"></div>
                        <div class="color-option color-orange" data-color="orange"></div>
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="submit" class="btn btn-save">✅ Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <div class="note-view-modal" id="note-view-modal">
        <div class="note-view-content">
            <div class="note-view-header">
                <h3 class="note-view-title" id="note-view-title">✏️ Título da Nota</h3>
                <button class="close-modal" id="close-note-view-modal">&times;</button>
            </div>
            <div class="note-view-body">
                <div class="note-view-content-text" id="note-view-content-text">
                </div>
            </div>
            <div class="note-view-footer">
                <div class="note-view-date" id="note-view-date"></div>
                <div class="note-view-actions">
                    <button class="btn-view btn-edit-view" id="edit-note-view-btn">✏️ Editar</button>
                    <button class="btn-view btn-delete-view" id="delete-note-view-btn">❌ Excluir</button>
                </div>
            </div>
        </div>
    </div>

    <div class="plantao-view-modal" id="plantao-view-modal">
        <div class="plantao-view-content">
            <div class="plantao-view-header">
                <h3 class="plantao-view-title" id="plantao-view-title">✏️ Título do Plantão</h3>
                <button class="close-modal" id="close-plantao-view-modal">&times;</button>
            </div>
            <div class="plantao-view-body">
                <div class="plantao-view-time" id="plantao-view-time">
                    <span class="plantao-view-color" id="plantao-view-color"></span>
                    <span id="plantao-view-time-text">⏰ Hora do plantão</span>
                </div>
                <div class="plantao-view-description" id="plantao-view-description">
                </div>
            </div>
            <div class="plantao-view-footer">
                <div class="plantao-view-date" id="plantao-view-date"></div>
                <div class="plantao-view-actions">
                    <button class="btn-view btn-new-view" id="new-plantao-view-btn">🗒️ Novo</button>
                    <button class="btn-view btn-edit-view" id="edit-plantao-view-btn">📝 Editar</button>
                    <button class="btn-view btn-delete-view" id="delete-plantao-view-btn">❌ Excluir</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="settings-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">⚙️ Configurações</h3>
                <button class="close-modal" id="close-settings-modal">&times;</button>
            </div>
            
            <div class="settings-content">
                <div class="form-group">
                    <label>📱 Gerenciar Plantões Pré-definidos</label>
                    <p style="font-size: 0.85rem; color: #7f8c8d; margin-bottom: 10px;">🤔 Adicione, edite ou remova plantões pré-definidos para uso rápido.</p>
                    
                    <div class="shifts-list" id="settings-shifts-list">
                    </div>
                    
                    <div class="add-shift-form" id="add-shift-form" style="display: none;">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="new-shift-name">🏥 Nome do Plantão</label>
                                <input type="text" id="new-shift-name" class="form-control" placeholder="Ex: 🚑 HRL DN">
                            </div>
                            <div class="form-group">
                                <label for="new-shift-start">⏰ Horário de Entrada</label>
                                <input type="time" id="new-shift-start" class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="new-shift-end">⏰ Horário de Saída</label>
                                <input type="time" id="new-shift-end" class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="new-shift-value">💰 Valor (R$)</label>
                                <input type="text" id="new-shift-value" class="form-control" placeholder="Ex: 100,00">
                            </div>
                        </div>
                        <div class="modal-actions">
                            <button type="button" class="btn btn-save" id="save-new-shift">✅ Salvar Plantão</button>
                            <button type="button" class="btn btn-clear" id="cancel-new-shift">❌ Cancelar</button>
                        </div>
                    </div>
                    
                    <button class="btn btn-save" id="add-new-shift-btn" style="margin-top: 10px;">🚑 Adicionar Novo Plantão</button>
                </div>
                
                <div class="form-group" style="margin-top: 20px;">
                    <label>📁 Exportar Dados</label>
                    <p style="font-size: 0.85rem; color: #7f8c8d; margin-bottom: 10px;">🤔 Exporte todos os seus plantões e notas para um arquivo JSON.</p>
                    <button class="btn btn-save" id="export-data">📁 Exportar Dados</button>
                </div>
                
                <div class="form-group">
                    <label>🗂️ Importar Dados</label>
                    <p style="font-size: 0.85rem; color: #7f8c8d; margin-bottom: 10px;">🤔 Importe plantões e notas de um arquivo JSON.</p>
                    <input type="file" id="import-file" accept=".json" style="display: none;">
                    <button class="btn btn-save" id="import-data">🗂️ Importar Dados</button>
                </div>
                
                <div class="form-group">
                    <label>❌ Limpar todos os dados</label>
                    <p style="font-size: 0.85rem; color: #7f8c8d; margin-bottom: 10px;">🤔 Esta ação irá apagar todos os plantões e notas permanentemente.</p>
                    <button class="btn btn-clear" id="clear-all-data">🧹 Limpar Tudo</button>
                </div>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Configurações iniciais
            let currentMonth = new Date().getMonth();
            let currentYear = new Date().getFullYear();
            const monthNames = ["Janeiro", "Fevereiro", "Março", "Abril", "Maio", "Junho", "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"];
            
            // Variáveis para paginação do calendário
            let currentPage = 1;
            const daysPerPage = 30;
            let totalDays = 0;
            let filteredPlantoes = {};
            
            // Variáveis para ordenação de notas
            let currentSort = 'date';
            let sortOrder = 'desc';
            
            // Função para formatar valores monetários
            function formatCurrency(value) {
                const stringValue = String(value).replace(',', '.');
                const numValue = parseFloat(stringValue);
                if (isNaN(numValue)) return "R$ 0,00";
                
                const formattedValue = numValue.toFixed(2);
                const parts = formattedValue.split('.');
                let integerPart = parts[0];
                const decimalPart = parts[1];
                
                integerPart = integerPart.replace(/\B(?=(\d{3})+(?!\d))/g, ".");
                
                return `R$ ${integerPart},${decimalPart}`;
            }
            
            // Função para converter valores monetários
            function parseCurrency(value) {
                if (!value) return 0;
                const cleanValue = value.replace(/[^\d.,]/g, '');
                const numericValue = cleanValue.replace(',', '.');
                return parseFloat(numericValue) || 0;
            }
            
            // Elementos do DOM
            const calendarBody = document.getElementById('calendar-body');
            const calendarTitle = document.getElementById('calendar-title');
            const prevMonthBtn = document.getElementById('prev-month');
            const nextMonthBtn = document.getElementById('next-month');
            
            // Elementos de busca e paginação
            const plantaoSearchInput = document.getElementById('plantao-search');
            const paginationInfo = document.getElementById('pagination-info');
            const prevPageBtn = document.getElementById('prev-page');
            const nextPageBtn = document.getElementById('next-page');
            
            // Elementos do mosaico de notas
            const notesMosaic = document.getElementById('notes-mosaic');
            const clearNotesBtn = document.getElementById('clear-notes');
            const notesCount = document.getElementById('notes-count');
            
            // Elementos de busca e ordenação de notas
            const notesSearchInput = document.getElementById('notes-search');
            const sortDateBtn = document.getElementById('sort-date');
            const sortTitleBtn = document.getElementById('sort-title');
            const sortColorBtn = document.getElementById('sort-color');
            
            // Elementos do botão flutuante
            const fabBtn = document.getElementById('fab-btn');
            const fabMenu = document.getElementById('fab-menu');
            const homeBtn = document.getElementById('home-btn');
            const addPlantaoBtn = document.getElementById('add-plantao-btn');
            const addNoteBtn = document.getElementById('add-note-btn');
            const settingsBtn = document.getElementById('settings-btn');
            const analyticsBtn = document.getElementById('analytics-btn');
            
            // Elementos do modal de plantões
            const plantaoModal = document.getElementById('plantao-modal');
            const modalTitle = document.getElementById('modal-title');
            const plantaoForm = document.getElementById('plantao-form');
            const plantaoDateInput = document.getElementById('plantao-date');
            const plantaoIdInput = document.getElementById('plantao-id');
            const plantaoDatePickerInput = document.getElementById('plantao-date-picker');
            const plantaoTitleInput = document.getElementById('plantao-title');
            const plantaoDescriptionInput = document.getElementById('plantao-description');
            const plantaoTimeInput = document.getElementById('plantao-time');
            const deletePlantaoBtn = document.getElementById('delete-plantao');
            const closeModalBtn = document.getElementById('close-modal');
            const dayPlantoesSection = document.getElementById('day-plantoes');
            const plantaoList = document.getElementById('plantao-list');
            const shiftsSelector = document.getElementById('shifts-selector');
            
            // Elementos do modal de notas
            const noteModal = document.getElementById('note-modal');
            const noteModalTitle = document.getElementById('note-modal-title');
            const noteForm = document.getElementById('note-form');
            const noteIdInput = document.getElementById('note-id');
            const noteTitleInput = document.getElementById('note-title');
            const noteContentInput = document.getElementById('note-content');
            const closeNoteModalBtn = document.getElementById('close-note-modal');
            
            // Elementos do modal de visualização de notas
            const noteViewModal = document.getElementById('note-view-modal');
            const noteViewTitle = document.getElementById('note-view-title');
            const noteViewContentText = document.getElementById('note-view-content-text');
            const noteViewDate = document.getElementById('note-view-date');
            const closeNoteViewModalBtn = document.getElementById('close-note-view-modal');
            const editNoteViewBtn = document.getElementById('edit-note-view-btn');
            const deleteNoteViewBtn = document.getElementById('delete-note-view-btn');
            
            // Elementos do modal de visualização de plantões
            const plantaoViewModal = document.getElementById('plantao-view-modal');
            const plantaoViewTitle = document.getElementById('plantao-view-title');
            const plantaoViewDescription = document.getElementById('plantao-view-description');
            const plantaoViewTimeText = document.getElementById('plantao-view-time-text');
            const plantaoViewColor = document.getElementById('plantao-view-color');
            const plantaoViewDate = document.getElementById('plantao-view-date');
            const closePlantaoViewModalBtn = document.getElementById('close-plantao-view-modal');
            const newPlantaoViewBtn = document.getElementById('new-plantao-view-btn');
            const editPlantaoViewBtn = document.getElementById('edit-plantao-view-btn');
            const deletePlantaoViewBtn = document.getElementById('delete-plantao-view-btn');
            
            // Elementos do modal de configurações
            const settingsModal = document.getElementById('settings-modal');
            const closeSettingsModalBtn = document.getElementById('close-settings-modal');
            const clearAllDataBtn = document.getElementById('clear-all-data');
            const exportDataBtn = document.getElementById('export-data');
            const importDataBtn = document.getElementById('import-data');
            const importFileInput = document.getElementById('import-file');
            const settingsShiftsList = document.getElementById('settings-shifts-list');
            const addNewShiftBtn = document.getElementById('add-new-shift-btn');
            const addShiftForm = document.getElementById('add-shift-form');
            const saveNewShiftBtn = document.getElementById('save-new-shift');
            const cancelNewShiftBtn = document.getElementById('cancel-new-shift');
            const newShiftName = document.getElementById('new-shift-name');
            const newShiftStart = document.getElementById('new-shift-start');
            const newShiftEnd = document.getElementById('new-shift-end');
            const newShiftValue = document.getElementById('new-shift-value');
            
            // Elementos do seletor de cores
            const plantaoColorOptions = document.querySelectorAll('#plantao-modal .color-option');
            const noteColorOptions = document.querySelectorAll('#note-modal .color-option');
            let selectedPlantaoColor = 'blue';
            let selectedNoteColor = 'yellow';
            
            // Elementos do seletor de dias alternados
            const alternateDayOptions = document.querySelectorAll('.alternate-day-option');
            let selectedAlternateDaysType = null;
            
            // Elementos do seletor de escala
            const scaleOptions = document.querySelectorAll('.scale-option');
            const customDaysSelector = document.getElementById('custom-days-selector');
            let selectedScaleType = null;
            
            // Elemento de notificação toast
            const toast = document.getElementById('toast');
            
            // Elementos da seção de notas
            const notesSection = document.getElementById('notes-section');
            const toggleNotesBtn = document.getElementById('toggle-notes');
            
            // Elementos da nova seção de análise
            const analyticsSection = document.getElementById('analytics-section');
            const toggleAnalyticsBtn = document.getElementById('toggle-analytics');
            const applyFiltersBtn = document.getElementById('apply-filters');
            const recalculateBtn = document.getElementById('recalculate-values');
            const periodFilter = document.getElementById('period-filter');
            const chartTypeFilter = document.getElementById('chart-type-filter');
            const groupByFilter = document.getElementById('group-by-filter');
            const analyticsSummary = document.getElementById('analytics-summary');
            
            // Referências para os gráficos
            let shiftsByTypeChart = null;
            let valuesByMonthChart = null;
            let shiftsByWeekdayChart = null;
            let valuesEvolutionChart = null;
            
            // Variáveis para armazenar os itens atuais em visualização
            let currentViewingNote = null;
            let currentViewingPlantao = null;
            let currentViewingPlantaoDate = null;
            let selectedShift = null;
            let editingShiftId = null;
            
            // Função para formatar data como YYYY-MM-DD
            function formatDateToYYYYMMDD(date) {
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                return `${year}-${month}-${day}`;
            }
            
            // Função para mostrar notificação toast
            function showToast(message, duration = 3000) {
                toast.textContent = message;
                toast.classList.add('show');
                
                setTimeout(() => {
                    toast.classList.remove('show');
                }, duration);
            }
            
            // Carregar preferências de seções visíveis
            function loadSectionPreferences() {
                const savedPreferences = localStorage.getItem('sectionPreferences');
                if (savedPreferences) {
                    const preferences = JSON.parse(savedPreferences);
                    
                    if (preferences.notesHidden) {
                        notesSection.classList.add('section-hidden');
                        toggleNotesBtn.textContent = '👁️‍🗨️';
                    } else {
                        notesSection.classList.remove('section-hidden');
                        toggleNotesBtn.textContent = '👁️';
                    }
                    
                    if (preferences.analyticsHidden) {
                        analyticsSection.classList.add('section-hidden');
                        toggleAnalyticsBtn.textContent = '👁️‍🗨️';
                    } else {
                        analyticsSection.classList.remove('section-hidden');
                        toggleAnalyticsBtn.textContent = '👁️';
                    }
                }
            }
            
            // Salvar preferências de seções visíveis
            function saveSectionPreferences() {
                const preferences = {
                    notesHidden: notesSection.classList.contains('section-hidden'),
                    analyticsHidden: analyticsSection.classList.contains('section-hidden')
                };
                
                localStorage.setItem('sectionPreferences', JSON.stringify(preferences));
            }
            
            // Funções para alternar visibilidade das seções
            function toggleNotesSection() {
                notesSection.classList.toggle('section-hidden');
                if (notesSection.classList.contains('section-hidden')) {
                    toggleNotesBtn.textContent = '👁️‍🗨️';
                } else {
                    toggleNotesBtn.textContent = '👁️';
                }
                saveSectionPreferences();
            }
            
            function toggleAnalyticsSection() {
                analyticsSection.classList.toggle('section-hidden');
                if (analyticsSection.classList.contains('section-hidden')) {
                    toggleAnalyticsBtn.textContent = '👁️‍🗨️';
                    destroyCharts();
                } else {
                    toggleAnalyticsBtn.textContent = '👁️';
                    generateAnalytics();
                }
                saveSectionPreferences();
            }
            
            // Função para destruir todos os gráficos
            function destroyCharts() {
                if (shiftsByTypeChart) {
                    shiftsByTypeChart.destroy();
                    shiftsByTypeChart = null;
                }
                if (valuesByMonthChart) {
                    valuesByMonthChart.destroy();
                    valuesByMonthChart = null;
                }
                if (shiftsByWeekdayChart) {
                    shiftsByWeekdayChart.destroy();
                    shiftsByWeekdayChart = null;
                }
                if (valuesEvolutionChart) {
                    valuesEvolutionChart.destroy();
                    valuesEvolutionChart = null;
                }
            }
            
            // Carregar plantões pré-definidos - CORRIGIDO
            function loadShifts() {
                const savedShifts = localStorage.getItem('predefinedShifts');
                if (savedShifts) {
                    return JSON.parse(savedShifts);
                } else {
                    return [
                        { id: '1', name: 'HRL DN', startTime: '07:00', endTime: '07:00', value: '200,00' },
                        { id: '2', name: 'HTO SD', startTime: '07:00', endTime: '19:00', value: '100,00' },
                        { id: '3', name: 'HCM SN', startTime: '19:00', endTime: '07:00', value: '100,00' },
                        { id: '4', name: 'EXT DN', startTime: '07:00', endTime: '07:00', value: '200,00' },
                        { id: '5', name: 'EXT SD', startTime: '07:00', endTime: '19:00', value: '100,00' },
                        { id: '6', name: 'EXT SN', startTime: '19:00', endTime: '07:00', value: '100,00' }
                    ];
                }
            }
            
            // Salvar plantões pré-definidos
            function saveShifts(shifts) {
                localStorage.setItem('predefinedShifts', JSON.stringify(shifts));
            }
            
            // Renderizar lista de plantões no modal de configurações
            function renderSettingsShiftsList() {
                const shifts = loadShifts();
                settingsShiftsList.innerHTML = '';
                
                if (shifts.length === 0) {
                    settingsShiftsList.innerHTML = '<p style="text-align: center; color: #7f8c8d; padding: 10px;">Nenhum plantão pré-definido. Adicione um novo plantão.</p>';
                    return;
                }
                
                shifts.forEach(shift => {
                    const shiftItem = document.createElement('div');
                    shiftItem.className = 'shift-item';
                    
                    const shiftInfo = document.createElement('div');
                    shiftInfo.className = 'shift-info';
                    
                    const shiftName = document.createElement('div');
                    shiftName.className = 'shift-name';
                    shiftName.textContent = shift.name;
                    
                    const shiftHours = document.createElement('div');
                    shiftHours.className = 'shift-hours';
                    shiftHours.textContent = `${shift.startTime} - ${shift.endTime}`;
                    
                    const shiftValue = document.createElement('div');
                    shiftValue.className = 'shift-value';
                    shiftValue.textContent = formatCurrency(shift.value);
                    
                    shiftInfo.appendChild(shiftName);
                    shiftInfo.appendChild(shiftHours);
                    shiftInfo.appendChild(shiftValue);
                    
                    const shiftActions = document.createElement('div');
                    shiftActions.className = 'shift-actions';
                    
                    const editBtn = document.createElement('button');
                    editBtn.className = 'shift-action';
                    editBtn.innerHTML = '✏️';
                    editBtn.addEventListener('click', () => {
                        editShift(shift);
                    });
                    
                    const deleteBtn = document.createElement('button');
                    deleteBtn.className = 'shift-action';
                    deleteBtn.innerHTML = '🗑️';
                    deleteBtn.addEventListener('click', () => {
                        if (confirm('Tem certeza que deseja excluir este plantão?')) {
                            deleteShift(shift.id);
                            renderSettingsShiftsList();
                            renderShiftsSelector();
                            showToast('Plantão excluído com sucesso!');
                        }
                    });
                    
                    shiftActions.appendChild(editBtn);
                    shiftActions.appendChild(deleteBtn);
                    
                    shiftItem.appendChild(shiftInfo);
                    shiftItem.appendChild(shiftActions);
                    
                    settingsShiftsList.appendChild(shiftItem);
                });
            }
            
            // Renderizar lista de plantões no modal de plantões
            function renderShiftsSelector() {
                const shifts = loadShifts();
                shiftsSelector.innerHTML = '';
                
                if (shifts.length === 0) {
                    shiftsSelector.innerHTML = '<p style="text-align: center; color: #7f8c8d; padding: 10px;">Nenhum plantão pré-definido. Adicione plantões nas configurações.</p>';
                    return;
                }
                
                shifts.forEach(shift => {
                    const shiftOption = document.createElement('div');
                    shiftOption.className = 'shift-option';
                    if (selectedShift && selectedShift.id === shift.id) {
                        shiftOption.classList.add('selected');
                    }
                    
                    const shiftOptionInfo = document.createElement('div');
                    shiftOptionInfo.className = 'shift-option-info';
                    
                    const shiftOptionName = document.createElement('div');
                    shiftOptionName.className = 'shift-option-name';
                    shiftOptionName.textContent = shift.name;
                    
                    const shiftOptionHours = document.createElement('div');
                    shiftOptionHours.className = 'shift-option-hours';
                    shiftOptionHours.textContent = `${shift.startTime} - ${shift.endTime}`;
                    
                    const shiftOptionValue = document.createElement('div');
                    shiftOptionValue.className = 'shift-option-value';
                    shiftOptionValue.textContent = formatCurrency(shift.value);
                    
                    shiftOptionInfo.appendChild(shiftOptionName);
                    shiftOptionInfo.appendChild(shiftOptionHours);
                    shiftOptionInfo.appendChild(shiftOptionValue);
                    
                    shiftOption.appendChild(shiftOptionInfo);
                    
                    shiftOption.addEventListener('click', () => {
                        document.querySelectorAll('.shift-option').forEach(opt => {
                            opt.classList.remove('selected');
                        });
                        
                        shiftOption.classList.add('selected');
                        selectedShift = shift;
                        
                        plantaoTitleInput.value = shift.name;
                        plantaoTimeInput.value = shift.startTime;
                        plantaoDescriptionInput.value = `Plantão ${shift.name}: ${shift.startTime} - ${shift.endTime}`;
                    });
                    
                    shiftsSelector.appendChild(shiftOption);
                });
            }
            
            // Adicionar novo plantão
            function addShift(name, startTime, endTime, value) {
                const shifts = loadShifts();
                const newShift = {
                    id: Date.now().toString(),
                    name: name,
                    startTime: startTime,
                    endTime: endTime,
                    value: value
                };
                
                shifts.push(newShift);
                saveShifts(shifts);
                return newShift;
            }
            
            // Editar plantão
            function editShift(shift) {
                editingShiftId = shift.id;
                newShiftName.value = shift.name;
                newShiftStart.value = shift.startTime;
                newShiftEnd.value = shift.endTime;
                newShiftValue.value = shift.value;
                addShiftForm.style.display = 'block';
                addNewShiftBtn.style.display = 'none';
            }
            
            // Atualizar plantão
            function updateShift(id, name, startTime, endTime, value) {
                const shifts = loadShifts();
                const index = shifts.findIndex(shift => shift.id === id);
                
                if (index !== -1) {
                    shifts[index].name = name;
                    shifts[index].startTime = startTime;
                    shifts[index].endTime = endTime;
                    shifts[index].value = value;
                    saveShifts(shifts);
                    showToast('Plantão atualizado com sucesso!');
                }
            }
            
            // Excluir plantão
            function deleteShift(id) {
                const shifts = loadShifts();
                const filteredShifts = shifts.filter(shift => shift.id !== id);
                saveShifts(filteredShifts);
            }
            
            // Carregar notas salvas
            function loadNotes() {
                const savedNotes = localStorage.getItem('notes');
                const notes = savedNotes ? JSON.parse(savedNotes) : [];
                renderNotes(notes);
                updateNotesCount(notes.length);
            }
            
            // Renderizar notas no mosaico
            function renderNotes(notes) {
                notesMosaic.innerHTML = '';
                
                if (notes.length === 0) {
                    notesMosaic.innerHTML = '<p style="text-align: center; color: #7f8c8d; grid-column: 1/-1;">Nenhuma nota ainda. Clique em "Nota" para começar.</p>';
                    return;
                }
                
                notes = sortNotes(notes, currentSort, sortOrder);
                
                notes.forEach(note => {
                    const noteCard = document.createElement('div');
                    noteCard.className = `note-card note-${note.color}`;
                    noteCard.dataset.noteId = note.id;
                    
                    const noteTitle = document.createElement('div');
                    noteTitle.className = 'note-title';
                    noteTitle.textContent = note.title;
                    
                    const noteContent = document.createElement('div');
                    noteContent.className = 'note-content';
                    noteContent.textContent = note.content;
                    
                    const noteDate = document.createElement('div');
                    noteDate.className = 'note-date';
                    noteDate.textContent = formatDate(note.date);
                    
                    const noteDelete = document.createElement('button');
                    noteDelete.className = 'note-delete';
                    noteDelete.innerHTML = '×';
                    noteDelete.addEventListener('click', (e) => {
                        e.stopPropagation();
                        deleteNote(note.id);
                    });
                    
                    noteCard.appendChild(noteTitle);
                    noteCard.appendChild(noteContent);
                    noteCard.appendChild(noteDate);
                    noteCard.appendChild(noteDelete);
                    
                    noteCard.addEventListener('click', () => {
                        openNoteModal(note);
                    });
                    
                    notesMosaic.appendChild(noteCard);
                });
                
                initializeSortable();
            }
            
            // Função para ordenar notas
            function sortNotes(notes, sortBy, order) {
                const sortedNotes = [...notes];
                
                sortedNotes.sort((a, b) => {
                    let valueA, valueB;
                    
                    switch(sortBy) {
                        case 'date':
                            valueA = new Date(a.date);
                            valueB = new Date(b.date);
                            break;
                        case 'title':
                            valueA = a.title.toLowerCase();
                            valueB = b.title.toLowerCase();
                            break;
                        case 'color':
                            valueA = a.color;
                            valueB = b.color;
                            break;
                        default:
                            valueA = new Date(a.date);
                            valueB = new Date(b.date);
                    }
                    
                    if (valueA < valueB) return order === 'asc' ? -1 : 1;
                    if (valueA > valueB) return order === 'asc' ? 1 : -1;
                    return 0;
                });
                
                return sortedNotes;
            }
            
            // Inicializar arrastar e soltar para notas
            function initializeSortable() {
                if (typeof Sortable !== 'undefined') {
                    new Sortable(notesMosaic, {
                        animation: 150,
                        ghostClass: 'dragging',
                        onEnd: function(evt) {
                            const noteCards = notesMosaic.querySelectorAll('.note-card');
                            const newOrder = [];
                            
                            noteCards.forEach(card => {
                                const noteId = card.dataset.noteId;
                                newOrder.push(noteId);
                            });
                            
                            saveNotesOrder(newOrder);
                            showToast('Ordem das notas atualizada!');
                        }
                    });
                }
            }
            
            // Salvar ordem das notas
            function saveNotesOrder(order) {
                localStorage.setItem('notesOrder', JSON.stringify(order));
            }
            
            // Carregar ordem das notas
            function loadNotesOrder() {
                const savedOrder = localStorage.getItem('notesOrder');
                return savedOrder ? JSON.parse(savedOrder) : null;
            }
            
            // Formatar data para exibição
            function formatDate(dateString) {
                const date = new Date(dateString);
                return date.toLocaleDateString('pt-BR', {
                    day: '2-digit',
                    month: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }
            
            // Salvar notas
            function saveNotes(notes) {
                localStorage.setItem('notes', JSON.stringify(notes));
            }
            
            // Adicionar nova nota
            function addNote(title, content, color) {
                const notes = JSON.parse(localStorage.getItem('notes') || '[]');
                
                const newNote = {
                    id: Date.now().toString(),
                    title: title,
                    content: content,
                    color: color,
                    date: new Date().toISOString()
                };
                
                notes.push(newNote);
                saveNotes(notes);
                renderNotes(notes);
                updateNotesCount(notes.length);
                showToast('Nota adicionada com sucesso!');
                
                return notes;
            }
            
            // Atualizar nota existente
            function updateNote(id, title, content, color) {
                const notes = JSON.parse(localStorage.getItem('notes') || '[]');
                const index = notes.findIndex(note => note.id === id);
                
                if (index !== -1) {
                    notes[index].title = title;
                    notes[index].content = content;
                    notes[index].color = color;
                    saveNotes(notes);
                    renderNotes(notes);
                    showToast('Nota atualizada com sucesso!');
                }
            }
            
            // Excluir nota
            function deleteNote(id) {
                if (confirm('Tem certeza que deseja excluir esta nota?')) {
                    const notes = JSON.parse(localStorage.getItem('notes') || '[]');
                    const filteredNotes = notes.filter(note => note.id !== id);
                    
                    saveNotes(filteredNotes);
                    renderNotes(filteredNotes);
                    updateNotesCount(filteredNotes.length);
                    showToast('Nota excluída com sucesso!');
                }
            }
            
            // Limpar todas as notas
            function clearAllNotes() {
                if (confirm('Tem certeza que deseja limpar todas as notas?')) {
                    localStorage.removeItem('notes');
                    renderNotes([]);
                    updateNotesCount(0);
                    showToast('Todas as notas foram limpas!');
                }
            }
            
            // Limpar todos os dados (plantões e notas)
            function clearAllData() {
                if (confirm('Tem certeza que deseja limpar todos os dados? Esta ação não pode be desfeita.')) {
                    localStorage.removeItem('notes');
                    localStorage.removeItem('calendarPlantoes');
                    renderNotes([]);
                    updateNotesCount(0);
                    generateCalendar();
                    showToast('Todos os dados foram limpos!');
                    closeSettingsModal();
                }
            }
            
            // Função para exportar dados
            function exportData() {
                const plantoes = loadPlantoes();
                const notes = JSON.parse(localStorage.getItem('notes') || '[]');
                const shifts = loadShifts();
                
                const data = {
                    plantoes: plantoes,
                    notes: notes,
                    shifts: shifts,
                    exportDate: new Date().toISOString()
                };
                
                const dataStr = JSON.stringify(data, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                
                const exportFileDefaultName = `bloco-de-notas-dados-${new Date().toISOString().split('T')[0]}.json`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
                
                showToast('Dados exportados com sucesso!');
            }
            
            // Função para importar dados
            function importData() {
                importFileInput.click();
            }
            
            // Função para processar arquivo importado
            function processImportedFile(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        
                        if (!data.plantoes || !data.notes) {
                            throw new Error('Formato de arquivo inválido');
                        }
                        
                        if (confirm('Isso substituirá todos os seus dados atuais. Deseja continuar?')) {
                            savePlantoes(data.plantoes);
                            localStorage.setItem('notes', JSON.stringify(data.notes));
                            
                            if (data.shifts) {
                                saveShifts(data.shifts);
                            }
                            
                            generateCalendar();
                            loadNotes();
                            renderSettingsShiftsList();
                            renderShiftsSelector();
                            
                            showToast('Dados importados com sucesso!');
                        }
                    } catch (error) {
                        showToast('Erro ao importar dados: ' + error.message);
                    }
                };
                
                reader.readAsText(file);
                
                event.target.value = '';
            }
            
            // Atualizar contagem de notas
            function updateNotesCount(count) {
                notesCount.textContent = `${count} nota${count !== 1 ? 's' : ''}`;
            }
            
            // Abrir modal para visualizar nota
            function openNoteViewModal(note) {
                currentViewingNote = note;
                
                noteViewTitle.textContent = note.title;
                noteViewContentText.textContent = note.content;
                noteViewDate.textContent = formatDate(note.date);
                
                noteViewModal.style.display = 'flex';
            }
            
            // Abrir modal para adicionar/editar nota
            function openNoteModal(note = null) {
                noteColorOptions.forEach(option => {
                    option.classList.remove('selected');
                    if (option.dataset.color === 'yellow') {
                        option.classList.add('selected');
                    }
                });
                selectedNoteColor = 'yellow';
                
                if (note) {
                    noteModalTitle.textContent = 'Editar Nota';
                    noteIdInput.value = note.id;
                    noteTitleInput.value = note.title;
                    noteContentInput.value = note.content;
                    
                    noteModal.querySelector('.note-modal-content').classList.add('edit-mode');
                    
                    if (note.color) {
                        noteColorOptions.forEach(option => {
                            option.classList.remove('selected');
                            if (option.dataset.color === note.color) {
                                option.classList.add('selected');
                                selectedNoteColor = note.color;
                            }
                        });
                    }
                } else {
                    noteModalTitle.textContent = 'Adicionar Nota';
                    noteIdInput.value = '';
                    noteTitleInput.value = '';
                    noteContentInput.value = '';
                    
                    noteModal.querySelector('.note-modal-content').classList.remove('edit-mode');
                }
                
                noteModal.style.display = 'flex';
                
                setTimeout(() => {
                    noteTitleInput.focus();
                }, 300);
            }
            
            // Fechar modal de nota
            function closeNoteModal() {
                noteModal.style.display = 'none';
            }
            
            // Fechar modal de visualização de nota
            function closeNoteViewModal() {
                noteViewModal.style.display = 'none';
                currentViewingNote = null;
            }
            
            // Abrir modal para visualizar plantão
            function openPlantaoViewModal(plantao, dateString) {
                currentViewingPlantao = plantao;
                currentViewingPlantaoDate = dateString;
                
                const date = new Date(dateString);
                const formattedDate = date.toLocaleDateString('pt-BR');
                
                plantaoViewTitle.textContent = plantao.title;
                plantaoViewDescription.textContent = plantao.description || 'Sem descrição';
                plantaoViewTimeText.textContent = plantao.time || 'Todo o dia';
                plantaoViewDate.textContent = formattedDate;
                
                plantaoViewColor.className = `plantao-view-color plantao-${plantao.color || 'blue'}`;
                
                plantaoViewModal.style.display = 'flex';
            }
            
            // Abrir modal de configurações
            function openSettingsModal() {
                settingsModal.style.display = 'flex';
                renderSettingsShiftsList();
            }
            
            // Fechar modal de configurações
            function closeSettingsModal() {
                settingsModal.style.display = 'none';
            }
            
            // Carregar plantões salvos - CORRIGIDO
            function loadPlantoes() {
                const savedPlantoes = localStorage.getItem('calendarPlantoes');
                return savedPlantoes ? JSON.parse(savedPlantoes) : {};
            }
            
            // Salvar plantões - CORRIGIDO
            function savePlantoes(plantoes) {
                localStorage.setItem('calendarPlantoes', JSON.stringify(plantoes));
            }
            
            // Gerar ID único para plantões
            function generatePlantaoId() {
                return Date.now().toString(36) + Math.random().toString(36).substr(2);
            }
            
            // Obter plantões para uma data específica
            function getPlantoesForDate(dateString) {
                const plantoes = loadPlantoes();
                return plantoes[dateString] || [];
            }
            
            // Adicionar ou atualizar plantão
            function savePlantao(dateString, plantaoData) {
                const plantoes = loadPlantoes();
                if (!plantoes[dateString]) {
                    plantoes[dateString] = [];
                }
                
                if (plantaoData.id) {
                    const index = plantoes[dateString].findIndex(p => p.id === plantaoData.id);
                    if (index !== -1) {
                        plantoes[dateString][index] = plantaoData;
                    }
                } else {
                    plantaoData.id = generatePlantaoId();
                    plantoes[dateString].push(plantaoData);
                }
                
                plantoes[dateString].sort((a, b) => {
                    if (a.time && b.time) {
                        return a.time.localeCompare(b.time);
                    }
                    return 0;
                });
                
                savePlantoes(plantoes);
                return plantaoData;
            }
            
            // Criar plantões em dias alternados
            function createAlternateDayPlantoes(startDate, plantaoData, scaleType) {
                const plantoes = loadPlantoes();
                const start = new Date(startDate);
                const year = start.getFullYear();
                const month = start.getMonth();
                const startDay = start.getDate();
                
                const lastDay = new Date(year, month + 1, 0).getDate();
                
                let createdCount = 0;
                let dayPattern = [];
                
                switch(scaleType) {
                    case '12x24':
                        for (let day = startDay; day <= lastDay; day += 2) {
                            dayPattern.push(day);
                        }
                        break;
                    case '12x36':
                        for (let day = startDay; day <= lastDay; day += 2) {
                            dayPattern.push(day);
                        }
                        break;
                    case '24x72':
                        for (let day = startDay; day <= lastDay; day += 4) {
                            dayPattern.push(day);
                        }
                        break;
                    case 'odd':
                        let firstOdd = startDay % 2 === 1 ? startDay : startDay + 1;
                        for (let day = firstOdd; day <= lastDay; day += 2) {
                            dayPattern.push(day);
                        }
                        break;
                    case 'even':
                        let firstEven = startDay % 2 === 0 ? startDay : startDay + 1;
                        for (let day = firstEven; day <= lastDay; day += 2) {
                            dayPattern.push(day);
                        }
                        break;
                    case 'every3':
                        for (let day = startDay; day <= lastDay; day += 3) {
                            dayPattern.push(day);
                        }
                        break;
                    case 'every4':
                        for (let day = startDay; day <= lastDay; day += 4) {
                            dayPattern.push(day);
                        }
                        break;
                }
                
                dayPattern.forEach(day => {
                    const date = new Date(year, month, day);
                    const dateString = formatDateToYYYYMMDD(date);
                    
                    const dayPlantaoData = {
                        ...plantaoData,
                        id: generatePlantaoId()
                    };
                    
                    if (!plantoes[dateString]) {
                        plantoes[dateString] = [];
                    }
                    plantoes[dateString].push(dayPlantaoData);
                    createdCount++;
                });
                
                savePlantoes(plantoes);
                return createdCount;
            }
            
            // Excluir plantão
            function deletePlantao(dateString, plantaoId) {
                const plantoes = loadPlantoes();
                if (plantoes[dateString]) {
                    plantoes[dateString] = plantoes[dateString].filter(p => p.id !== plantaoId);
                    if (plantoes[dateString].length === 0) {
                        delete plantoes[dateString];
                    }
                    savePlantoes(plantoes);
                }
            }
            
            // Abrir modal para adicionar/editar plantão
            function openPlantaoModal(dateString, plantao = null) {
                const date = new Date(dateString);
                const formattedDate = date.toLocaleDateString('pt-BR');
                
                plantaoColorOptions.forEach(option => {
                    option.classList.remove('selected');
                    if (option.dataset.color === 'blue') {
                        option.classList.add('selected');
                    }
                });
                selectedPlantaoColor = 'blue';
                
                scaleOptions.forEach(option => {
                    option.classList.remove('selected');
                });
                selectedScaleType = null;
                customDaysSelector.style.display = 'none';
                
                alternateDayOptions.forEach(option => {
                    option.classList.remove('selected');
                });
                selectedAlternateDaysType = null;
                
                selectedShift = null;
                
                if (plantao) {
                    modalTitle.textContent = `Editar Plantão - ${formattedDate}`;
                    plantaoIdInput.value = plantao.id;
                    plantaoDatePickerInput.value = dateString;
                    plantaoTitleInput.value = plantao.title;
                    plantaoDescriptionInput.value = plantao.description || '';
                    plantaoTimeInput.value = plantao.time || '';
                    deletePlantaoBtn.style.display = 'block';
                    
                    plantaoModal.querySelector('.modal-content').classList.add('edit-mode');
                    
                    if (plantao.color) {
                        plantaoColorOptions.forEach(option => {
                            option.classList.remove('selected');
                            if (option.dataset.color === plantao.color) {
                                option.classList.add('selected');
                                selectedPlantaoColor = plantao.color;
                            }
                        });
                    }
                    
                    const shifts = loadShifts();
                    const matchingShift = shifts.find(shift => 
                        shift.name === plantao.title && 
                        shift.startTime === plantao.time
                    );
                    
                    if (matchingShift) {
                        selectedShift = matchingShift;
                        setTimeout(() => {
                            document.querySelectorAll('.shift-option').forEach(option => {
                                option.classList.remove('selected');
                                const shiftName = option.querySelector('.shift-option-name').textContent;
                                const shiftHours = option.querySelector('.shift-option-hours').textContent;
                                if (shiftName === matchingShift.name && shiftHours === `${matchingShift.startTime} - ${matchingShift.endTime}`) {
                                    option.classList.add('selected');
                                }
                            });
                        }, 300);
                    }
                } else {
                    modalTitle.textContent = `Adicionar Plantão - ${formattedDate}`;
                    plantaoIdInput.value = '';
                    plantaoDatePickerInput.value = dateString;
                    plantaoTitleInput.value = '';
                    plantaoDescriptionInput.value = '';
                    plantaoTimeInput.value = '';
                    deletePlantaoBtn.style.display = 'none';
                    
                    plantaoModal.querySelector('.modal-content').classList.remove('edit-mode');
                }
                
                plantaoDateInput.value = dateString;
                plantaoModal.style.display = 'flex';
                
                renderShiftsSelector();
                loadDayPlantoes(dateString);
                
                setTimeout(() => {
                    plantaoTitleInput.focus();
                }, 300);
            }
            
            // Abrir modal para adicionar plantão
            function openShiftModal(dateString) {
                const date = new Date(dateString);
                const formattedDate = date.toLocaleDateString('pt-BR');
                
                plantaoColorOptions.forEach(option => {
                    option.classList.remove('selected');
                    if (option.dataset.color === 'blue') {
                        option.classList.add('selected');
                    }
                });
                selectedPlantaoColor = 'blue';
                
                scaleOptions.forEach(option => {
                    option.classList.remove('selected');
                });
                selectedScaleType = null;
                customDaysSelector.style.display = 'none';
                
                alternateDayOptions.forEach(option => {
                    option.classList.remove('selected');
                });
                selectedAlternateDaysType = null;
                
                selectedShift = null;
                
                modalTitle.textContent = `Adicionar Plantão - ${formattedDate}`;
                plantaoIdInput.value = '';
                plantaoDatePickerInput.value = dateString;
                plantaoTitleInput.value = '';
                plantaoDescriptionInput.value = '';
                plantaoTimeInput.value = '';
                deletePlantaoBtn.style.display = 'none';
                
                plantaoModal.querySelector('.modal-content').classList.remove('edit-mode');
                
                plantaoDateInput.value = dateString;
                plantaoModal.style.display = 'flex';
                
                renderShiftsSelector();
                loadDayPlantoes(dateString);
                
                setTimeout(() => {
                    plantaoTitleInput.focus();
                }, 300);
            }
            
            // Carregar plantões do dia no modal
            function loadDayPlantoes(dateString) {
                const plantoes = getPlantoesForDate(dateString);
                plantaoList.innerHTML = '';
                
                if (plantoes.length === 0) {
                    plantaoList.innerHTML = '<p style="text-align: center; color: #7f8c8d; padding: 10px;">Nenhum plantão para este dia</p>';
                    return;
                }
                
                plantoes.forEach(plantao => {
                    const plantaoItem = document.createElement('div');
                    plantaoItem.className = `plantao-item plantao-${plantao.color || 'blue'}`;
                    
                    const plantaoInfo = document.createElement('div');
                    plantaoInfo.className = 'plantao-info';
                    
                    const plantaoTitle = document.createElement('div');
                    plantaoTitle.className = 'plantao-title';
                    plantaoTitle.textContent = plantao.title;
                    
                    const plantaoTime = document.createElement('div');
                    plantaoTime.className = 'plantao-time';
                    plantaoTime.textContent = plantao.time || 'Todo o dia';
                    
                    plantaoInfo.appendChild(plantaoTitle);
                    plantaoInfo.appendChild(plantaoTime);
                    
                    const plantaoActions = document.createElement('div');
                    plantaoActions.className = 'plantao-actions';
                    
                    const editBtn = document.createElement('button');
                    editBtn.className = 'plantao-action';
                    editBtn.innerHTML = '✏️';
                    editBtn.addEventListener('click', () => {
                        openPlantaoModal(dateString, plantao);
                    });
                    
                    const deleteBtn = document.createElement('button');
                    deleteBtn.className = 'plantao-action';
                    deleteBtn.innerHTML = '🗑️';
                    deleteBtn.addEventListener('click', () => {
                        if (confirm('Tem certeza que deseja excluir este plantão?')) {
                            deletePlantao(dateString, plantao.id);
                            generateCalendar();
                            loadDayPlantoes(dateString);
                            showToast('Plantão excluído com sucesso!');
                        }
                    });
                    
                    plantaoActions.appendChild(editBtn);
                    plantaoActions.appendChild(deleteBtn);
                    
                    plantaoItem.appendChild(plantaoInfo);
                    plantaoItem.appendChild(plantaoActions);
                    
                    plantaoList.appendChild(plantaoItem);
                });
            }
            
            // Fechar modal
            function closePlantaoModal() {
                plantaoModal.style.display = 'none';
            }
            
            // Fechar modal de visualização de plantão
            function closePlantaoViewModal() {
                plantaoViewModal.style.display = 'none';
                currentViewingPlantao = null;
                currentViewingPlantaoDate = null;
            }
            
            // Filtrar plantões por termo de busca
            function filterPlantoes(searchTerm) {
                const allPlantoes = loadPlantoes();
                const filtered = {};
                
                if (!searchTerm.trim()) {
                    return allPlantoes;
                }
                
                const term = searchTerm.toLowerCase();
                
                for (const dateStr in allPlantoes) {
                    if (allPlantoes.hasOwnProperty(dateStr)) {
                        const plantoesForDate = allPlantoes[dateStr];
                        const filteredPlantoes = plantoesForDate.filter(plantao => 
                            plantao.title.toLowerCase().includes(term) ||
                            (plantao.description && plantao.description.toLowerCase().includes(term))
                        );
                        
                        if (filteredPlantoes.length > 0) {
                            filtered[dateStr] = filteredPlantoes;
                        }
                    }
                }
                
                return filtered;
            }
            
            // Filtrar notas por termo de busca
            function filterNotes(notes, searchTerm) {
                if (!searchTerm.trim()) {
                    return notes;
                }
                
                const term = searchTerm.toLowerCase();
                
                return notes.filter(note => 
                    note.title.toLowerCase().includes(term) ||
                    note.content.toLowerCase().includes(term)
                );
            }
            
            // Atualizar paginação
            function updatePagination() {
                const totalPages = Math.ceil(totalDays / daysPerPage);
                const startDay = (currentPage - 1) * daysPerPage + 1;
                const endDay = Math.min(currentPage * daysPerPage, totalDays);
                
                paginationInfo.textContent = `Mostrando ${startDay}-${endDay} de ${totalDays} dias`;
                
                prevPageBtn.disabled = currentPage === 1;
                nextPageBtn.disabled = currentPage === totalPages;
            }
            
            // Gerar calendário com paginação
            function generateCalendar() {
                calendarBody.innerHTML = '';
                
                const firstDay = new Date(currentYear, currentMonth, 1);
                const lastDay = new Date(currentYear, currentMonth + 1, 0);
                const daysInMonth = lastDay.getDate();
                const firstDayOfWeek = firstDay.getDay();
                
                totalDays = daysInMonth;
                filteredPlantoes = filterPlantoes(plantaoSearchInput.value);
                
                const startDay = (currentPage - 1) * daysPerPage + 1;
                const endDay = Math.min(currentPage * daysPerPage, daysInMonth);
                
                let html = '';
                for (let i = 0; i < firstDayOfWeek; i++) {
                    html += '<td></td>';
                }
                
                for (let day = 1; day <= daysInMonth; day++) {
                    if (day < startDay || day > endDay) {
                        html += '<td></td>';
                        
                        if ((firstDayOfWeek + day) % 7 === 0) {
                            html += '</tr><tr>';
                        }
                        continue;
                    }
                    
                    const date = new Date(currentYear, currentMonth, day);
                    const dateString = formatDateToYYYYMMDD(date);
                    const today = new Date();
                    const isToday = (day === today.getDate() && currentMonth === today.getMonth() && currentYear === today.getFullYear());
                    
                    const dayPlantoes = filteredPlantoes[dateString] || [];
                    
                    html += `<td data-date="${dateString}">
                        <div class="day-number ${isToday ? 'today' : ''}">${day}</div>`;
                    
                    dayPlantoes.slice(0, 3).forEach(plantao => {
                        html += `<div class="plantao plantao-${plantao.color || 'blue'}" data-plantao-id="${plantao.id}">${plantao.title}</div>`;
                    });
                    
                    if (dayPlantoes.length > 3) {
                        html += `<div class="plantao">+${dayPlantoes.length - 3}</div>`;
                    }
                    
                    html += '</td>';
                    
                    if ((firstDayOfWeek + day) % 7 === 0) {
                        html += '</tr><tr>';
                    }
                }
                
                const remainingCells = 7 - ((firstDayOfWeek + daysInMonth) % 7);
                if (remainingCells < 7) {
                    for (let i = 0; i < remainingCells; i++) {
                        html += '<td></td>';
                    }
                }
                
                calendarTitle.textContent = `${monthNames[currentMonth]} ${currentYear}`;
                
                calendarBody.innerHTML = `<tr>${html}</tr>`;
                
                updatePagination();
                
                document.querySelectorAll('#calendar td[data-date]').forEach(cell => {
                    cell.addEventListener('click', function(e) {
                        if (e.target.classList.contains('plantao')) {
                            const dateString = this.getAttribute('data-date');
                            const plantaoId = e.target.getAttribute('data-plantao-id');
                            const plantoes = getPlantoesForDate(dateString);
                            const plantao = plantoes.find(p => p.id === plantaoId);
                            
                            if (plantao) {
                                openPlantaoModal(dateString, plantao);
                            }
                        } else {
                            const dateString = this.getAttribute('data-date');
                            openPlantaoModal(dateString);
                        }
                    });
                });
            }
            
            // Função para filtrar plantões por período - CORRIGIDA
            function filterPlantoesByPeriod(plantoes, period, month = null, year = null) {
                const now = new Date();
                let startDate, endDate;
                
                const useMonth = month !== null ? month : now.getMonth();
                const useYear = year !== null ? year : now.getFullYear();
                
                switch(period) {
                    case 'month':
                        startDate = new Date(useYear, useMonth, 1);
                        endDate = new Date(useYear, useMonth + 1, 0);
                        endDate.setHours(23, 59, 59, 999);
                        break;
                    case 'last-month':
                        startDate = new Date(useYear, useMonth - 1, 1);
                        endDate = new Date(useYear, useMonth, 0);
                        endDate.setHours(23, 59, 59, 999);
                        break;
                    case 'quarter':
                        const quarterStartMonth = Math.floor(useMonth / 3) * 3;
                        startDate = new Date(useYear, quarterStartMonth, 1);
                        endDate = new Date(useYear, quarterStartMonth + 3, 0);
                        endDate.setHours(23, 59, 59, 999);
                        break;
                    case 'semester':
                        const semesterStartMonth = Math.floor(useMonth / 6) * 6;
                        startDate = new Date(useYear, semesterStartMonth, 1);
                        endDate = new Date(useYear, semesterStartMonth + 6, 0);
                        endDate.setHours(23, 59, 59, 999);
                        break;
                    case 'year':
                        startDate = new Date(useYear, 0, 1);
                        endDate = new Date(useYear, 11, 31);
                        endDate.setHours(23, 59, 59, 999);
                        break;
                    case 'all':
                        return plantoes;
                    default:
                        startDate = new Date(useYear, useMonth, 1);
                        endDate = new Date(useYear, useMonth + 1, 0);
                        endDate.setHours(23, 59, 59, 999);
                }
                
                console.log(`Filtrando plantões de ${startDate.toISOString()} até ${endDate.toISOString()}`);
                
                const filteredPlantoes = {};
                for (const dateStr in plantoes) {
                    if (plantoes.hasOwnProperty(dateStr)) {
                        const plantaoDate = new Date(dateStr);
                        if (plantaoDate >= startDate && plantaoDate <= endDate) {
                            filteredPlantoes[dateStr] = plantoes[dateStr];
                        }
                    }
                }
                
                return filteredPlantoes;
            }
            
            // Função para validar valores dos plantões
            function validateShiftValues() {
                const shifts = loadShifts();
                let invalidShifts = [];
                
                shifts.forEach(shift => {
                    if (!shift.value || isNaN(parseCurrency(shift.value))) {
                        invalidShifts.push(shift.name);
                    }
                });
                
                if (invalidShifts.length > 0) {
                    showToast(`Valores inválidos nos plantões: ${invalidShifts.join(', ')}`, 5000);
                    return false;
                }
                return true;
            }
            
            // Função para analisar os plantões - CORRIGIDA
            function analyzePlantoes() {
                if (!validateShiftValues()) {
                    return null;
                }
                
                const allPlantoes = loadPlantoes();
                const shifts = loadShifts();
                
                // Obter o mês e ano atuais
                const now = new Date();
                let month = now.getMonth();
                let year = now.getFullYear();
                
                // Ajustar mês e ano com base no período selecionado
                if (periodFilter.value === 'last-month') {
                    month--;
                    if (month < 0) {
                        month = 11;
                        year--;
                    }
                }
                
                const plantoes = filterPlantoesByPeriod(allPlantoes, periodFilter.value, month, year);
                
                const analysisData = {
                    byType: {},
                    byMonth: {},
                    byWeekday: Array(7).fill(0),
                    valuesByMonth: {},
                    totalValue: 0,
                    totalShifts: 0,
                    averageValue: 0
                };
                
                console.log('Analisando plantões:', plantoes);
                console.log('Mês/Ano do calendário:', currentMonth, currentYear);

                for (const dateStr in plantoes) {
                    if (plantoes.hasOwnProperty(dateStr)) {
                        const date = new Date(dateStr);
                        const monthYear = `${date.getMonth() + 1}/${date.getFullYear()}`;
                        const weekday = date.getDay();
                        
                        plantoes[dateStr].forEach(plantao => {
                            analysisData.totalShifts++;
                            
                            if (!analysisData.byType[plantao.title]) {
                                analysisData.byType[plantao.title] = 0;
                            }
                            analysisData.byType[plantao.title]++;
                            
                            if (!analysisData.byMonth[monthYear]) {
                                analysisData.byMonth[monthYear] = 0;
                            }
                            analysisData.byMonth[monthYear]++;
                            
                            analysisData.byWeekday[weekday]++;
                            
                            let shiftValue = 0;
                            
                            const predefinedShift = shifts.find(s => s.name === plantao.title);
                            if (predefinedShift && predefinedShift.value) {
                                shiftValue = parseCurrency(predefinedShift.value);
                                console.log(`Plantão: ${plantao.title}, Valor: ${shiftValue}`);
                            }
                            
                            analysisData.totalValue += shiftValue;
                            
                            if (!analysisData.valuesByMonth[monthYear]) {
                                analysisData.valuesByMonth[monthYear] = 0;
                            }
                            analysisData.valuesByMonth[monthYear] += shiftValue;
                        });
                    }
                }
                
                analysisData.averageValue = analysisData.totalShifts > 0 
                    ? analysisData.totalValue / analysisData.totalShifts 
                    : 0;
                
                console.log('Dados de análise:', analysisData);
                
                return analysisData;
            }

            // Função para atualizar o resumo
            function updateSummary(analysisData) {
                if (!analysisData) {
                    analyticsSummary.innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: #e74c3c;">Erro ao calcular valores. Verifique os valores dos plantões.</p>';
                    return;
                }
                
                analyticsSummary.innerHTML = `
                    <div class="summary-card">
                        <div class="summary-label">Total de Plantões</div>
                        <div class="summary-value">${analysisData.totalShifts}</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-label">Valor Total</div>
                        <div class="summary-value">${formatCurrency(analysisData.totalValue)}</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-label">Valor Médio</div>
                        <div class="summary-value">${formatCurrency(analysisData.averageValue)}</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-label">Período</div>
                        <div class="summary-value">${periodFilter.options[periodFilter.selectedIndex].text}</div>
                    </div>
                `;
            }

            // Função para gerar os gráficos
            function generateCharts(analysisData) {
                if (!analysisData) {
                    return;
                }
                
                destroyCharts();
                
                const chartType = chartTypeFilter.value;
                
                const shiftsByTypeCtx = document.getElementById('shifts-by-type-chart').getContext('2d');
                shiftsByTypeChart = new Chart(shiftsByTypeCtx, {
                    type: chartType === 'pie' ? 'pie' : 'bar',
                    data: {
                        labels: Object.keys(analysisData.byType),
                        datasets: [{
                            label: 'Plantões por Tipo',
                            data: Object.values(analysisData.byType),
                            backgroundColor: [
                                '#3498db', '#2ecc71', '#e74c3c', '#f39c12', 
                                '#9b59b6', '#1abc9c', '#34495e', '#d35400'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'top',
                            },
                            title: {
                                display: true,
                                text: 'Plantões por Tipo'
                            }
                        }
                    }
                });
                
                const valuesByMonthCtx = document.getElementById('values-by-month-chart').getContext('2d');
                valuesByMonthChart = new Chart(valuesByMonthCtx, {
                    type: chartType === 'pie' ? 'pie' : 'bar',
                    data: {
                        labels: Object.keys(analysisData.valuesByMonth),
                        datasets: [{
                            label: 'Valor (R$)',
                            data: Object.values(analysisData.valuesByMonth),
                            backgroundColor: 'rgba(46, 204, 113, 0.7)',
                            borderColor: 'rgba(46, 204, 113, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'top',
                            },
                            title: {
                                display: true,
                                text: 'Valores por Mês'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Valor (R$)'
                                }
                            }
                        }
                    }
                });
                
                const weekdays = ['Domingo', 'Segunda', 'Terça', 'Quarta', 'Quinta', 'Sexta', 'Sábado'];
                const shiftsByWeekdayCtx = document.getElementById('shifts-by-weekday-chart').getContext('2d');
                shiftsByWeekdayChart = new Chart(shiftsByWeekdayCtx, {
                    type: chartType === 'pie' ? 'pie' : 'bar',
                    data: {
                        labels: weekdays,
                        datasets: [{
                            label: 'Plantões',
                            data: analysisData.byWeekday,
                            backgroundColor: 'rgba(52, 152, 219, 0.7)',
                            borderColor: 'rgba(52, 152, 219, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'top',
                            },
                            title: {
                                display: true,
                                text: 'Distribuição por Dia da Semana'
                            }
                        }
                    }
                });
                
                const valuesEvolutionCtx = document.getElementById('values-evolution-chart').getContext('2d');
                
                const sortedMonths = Object.keys(analysisData.valuesByMonth).sort((a, b) => {
                    const [monthA, yearA] = a.split('/').map(Number);
                    const [monthB, yearB] = b.split('/').map(Number);
                    return yearA - yearB || monthA - monthB;
                });
                
                const valuesByMonthSorted = sortedMonths.map(month => analysisData.valuesByMonth[month]);
                
                valuesEvolutionChart = new Chart(valuesEvolutionCtx, {
                    type: 'line',
                    data: {
                        labels: sortedMonths,
                        datasets: [{
                            label: 'Evolução de Valores (R$)',
                            data: valuesByMonthSorted,
                            backgroundColor: 'rgba(241, 196, 15, 0.2)',
                            borderColor: 'rgba(241, 196, 15, 1)',
                            borderWidth: 2,
                            pointBackgroundColor: 'rgba(241, 196, 15, 1)',
                            tension: 0.3
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'top',
                            },
                            title: {
                                display: true,
                                text: 'Evolução de Valores por Mês'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Valor (R$)'
                                }
                            }
                        }
                    }
                });
            }

            // Função principal para gerar toda a análise
            function generateAnalytics() {
                const analysisData = analyzePlantoes();
                updateSummary(analysisData);
                generateCharts(analysisData);
            }
            
            // Event listeners
            prevMonthBtn.addEventListener('click', function() {
                currentMonth--;
                if (currentMonth < 0) {
                    currentMonth = 11;
                    currentYear--;
                }
                currentPage = 1;
                generateCalendar();
            });
            
            nextMonthBtn.addEventListener('click', function() {
                currentMonth++;
                if (currentMonth > 11) {
                    currentMonth = 0;
                    currentYear++;
                }
                currentPage = 1;
                generateCalendar();
            });
            
            prevPageBtn.addEventListener('click', function() {
                if (currentPage > 1) {
                    currentPage--;
                    generateCalendar();
                }
            });
            
            nextPageBtn.addEventListener('click', function() {
                const totalPages = Math.ceil(totalDays / daysPerPage);
                if (currentPage < totalPages) {
                    currentPage++;
                    generateCalendar();
                }
            });
            
            plantaoSearchInput.addEventListener('input', function() {
                currentPage = 1;
                generateCalendar();
            });
            
            notesSearchInput.addEventListener('input', function() {
                const searchTerm = this.value;
                const notes = JSON.parse(localStorage.getItem('notes') || '[]');
                const filteredNotes = filterNotes(notes, searchTerm);
                renderNotes(filteredNotes);
                updateNotesCount(filteredNotes.length);
            });
            
            sortDateBtn.addEventListener('click', function() {
                if (currentSort === 'date') {
                    sortOrder = sortOrder === 'asc' ? 'desc' : 'asc';
                } else {
                    currentSort = 'date';
                    sortOrder = 'desc';
                }
                updateSortButtons();
                const notes = JSON.parse(localStorage.getItem('notes') || '[]');
                renderNotes(notes);
            });
            
            sortTitleBtn.addEventListener('click', function() {
                if (currentSort === 'title') {
                    sortOrder = sortOrder === 'asc' ? 'desc' : 'asc';
                } else {
                    currentSort = 'title';
                    sortOrder = 'asc';
                }
                updateSortButtons();
                const notes = JSON.parse(localStorage.getItem('notes') || '[]');
                renderNotes(notes);
            });
            
            sortColorBtn.addEventListener('click', function() {
                if (currentSort === 'color') {
                    sortOrder = sortOrder === 'asc' ? 'desc' : 'asc';
                } else {
                    currentSort = 'color';
                    sortOrder = 'asc';
                }
                updateSortButtons();
                const notes = JSON.parse(localStorage.getItem('notes') || '[]');
                renderNotes(notes);
            });
            
            function updateSortButtons() {
                document.querySelectorAll('.sort-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                let activeBtn;
                switch(currentSort) {
                    case 'date':
                        activeBtn = sortDateBtn;
                        break;
                    case 'title':
                        activeBtn = sortTitleBtn;
                        break;
                    case 'color':
                        activeBtn = sortColorBtn;
                        break;
                }
                
                if (activeBtn) {
                    activeBtn.classList.add('active');
                    activeBtn.textContent = activeBtn.dataset.sort === 'date' ? 
                        `Data ${sortOrder === 'asc' ? '↑' : '↓'}` :
                        activeBtn.dataset.sort === 'title' ? 
                        `Título ${sortOrder === 'asc' ? '↑' : '↓'}` :
                        `Cor ${sortOrder === 'asc' ? '↑' : '↓'}`;
                }
            }
            
            fabBtn.addEventListener('click', function() {
                fabMenu.classList.toggle('show');
                this.textContent = fabMenu.classList.contains('show') ? '×' : '👆🏻';
            });
            
            document.addEventListener('click', function(e) {
                if (!fabBtn.contains(e.target) && !fabMenu.contains(e.target)) {
                    fabMenu.classList.remove('show');
                    fabBtn.textContent = '👆🏻';
                }
            });
            
            homeBtn.addEventListener('click', function() {
                window.scrollTo({ top: 0, behavior: 'smooth' });
                fabMenu.classList.remove('show');
                fabBtn.textContent = '👆🏻';
            });
            
            addPlantaoBtn.addEventListener('click', function() {
                const today = formatDateToYYYYMMDD(new Date());
                openShiftModal(today);
                fabMenu.classList.remove('show');
                fabBtn.textContent = '👆🏻';
            });
            
            addNoteBtn.addEventListener('click', function() {
                openNoteModal();
                fabMenu.classList.remove('show');
                fabBtn.textContent = '👆🏻';
            });
            
            settingsBtn.addEventListener('click', function() {
                openSettingsModal();
                fabMenu.classList.remove('show');
                fabBtn.textContent = '👆🏻';
            });
            
            analyticsBtn.addEventListener('click', function() {
                document.getElementById('analytics-section').scrollIntoView({ behavior: 'smooth' });
                if (analyticsSection.classList.contains('section-hidden')) {
                    toggleAnalyticsSection();
                }
                fabMenu.classList.remove('show');
                fabBtn.textContent = '👆🏻';
            });
            
            clearNotesBtn.addEventListener('click', function() {
                clearAllNotes();
            });
            
            toggleNotesBtn.addEventListener('click', toggleNotesSection);
            toggleAnalyticsBtn.addEventListener('click', toggleAnalyticsSection);
            
            plantaoColorOptions.forEach(option => {
                option.addEventListener('click', function() {
                    plantaoColorOptions.forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedPlantaoColor = this.dataset.color;
                });
            });
            
            noteColorOptions.forEach(option => {
                option.addEventListener('click', function() {
                    noteColorOptions.forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedNoteColor = this.dataset.color;
                });
            });
            
            alternateDayOptions.forEach(option => {
                option.addEventListener('click', function() {
                    if (this.classList.contains('selected')) {
                        this.classList.remove('selected');
                        selectedAlternateDaysType = null;
                    } else {
                        alternateDayOptions.forEach(opt => opt.classList.remove('selected'));
                        this.classList.add('selected');
                        selectedAlternateDaysType = this.dataset.type;
                    }
                });
            });
            
            scaleOptions.forEach(option => {
                option.addEventListener('click', function() {
                    scaleOptions.forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedScaleType = this.dataset.type;
                    
                    if (selectedScaleType === 'custom') {
                        customDaysSelector.style.display = 'block';
                    } else {
                        customDaysSelector.style.display = 'none';
                        alternateDayOptions.forEach(opt => opt.classList.remove('selected'));
                        selectedAlternateDaysType = null;
                    }
                });
            });
            
            plantaoForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const dateString = plantaoDatePickerInput.value;
                const plantaoId = plantaoIdInput.value;
                const plantaoData = {
                    id: plantaoId || null,
                    title: plantaoTitleInput.value,
                    description: plantaoDescriptionInput.value,
                    time: plantaoTimeInput.value,
                    color: selectedPlantaoColor
                };
                
                let scaleType = null;
                if (selectedScaleType === 'custom' && selectedAlternateDaysType) {
                    scaleType = selectedAlternateDaysType;
                } else if (selectedScaleType && selectedScaleType !== 'custom') {
                    scaleType = selectedScaleType;
                }
                
                if (scaleType) {
                    const createdCount = createAlternateDayPlantoes(dateString, plantaoData, scaleType);
                    generateCalendar();
                    loadDayPlantoes(dateString);
                    
                    let scaleName = '';
                    switch(scaleType) {
                        case '12x24': scaleName = '12x24'; break;
                        case '12x36': scaleName = '12x36'; break;
                        case '24x72': scaleName = '24x72'; break;
                        case 'odd': scaleName = 'dias ímpares'; break;
                        case 'even': scaleName = 'dias pares'; break;
                        case 'every3': scaleName = 'a cada 3 dias'; break;
                        case 'every4': scaleName = 'a cada 4 dias'; break;
                    }
                    
                    showToast(`${createdCount} plantões criados no padrão ${scaleName}!`);
                } else {
                    savePlantao(dateString, plantaoData);
                    generateCalendar();
                    loadDayPlantoes(dateString);
                    if (plantaoId) {
                        showToast('Plantão atualizado com sucesso!');
                    } else {
                        showToast('Plantão adicionado com sucesso!');
                    }
                }
                
                closePlantaoModal();
            });
            
            deletePlantaoBtn.addEventListener('click', function() {
                if (confirm('Tem certeza que deseja excluir este plantão?')) {
                    const dateString = plantaoDatePickerInput.value;
                    const plantaoId = plantaoIdInput.value;
                    
                    deletePlantao(dateString, plantaoId);
                    generateCalendar();
                    loadDayPlantoes(dateString);
                    showToast('Plantão excluído com sucesso!');
                    closePlantaoModal();
                }
            });
            
            closeModalBtn.addEventListener('click', function() {
                closePlantaoModal();
            });
            
            plantaoModal.addEventListener('click', function(e) {
                if (e.target === plantaoModal) {
                    closePlantaoModal();
                }
            });
            
            noteForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const noteId = noteIdInput.value;
                const noteTitle = noteTitleInput.value;
                const noteContent = noteContentInput.value;
                
                if (noteId) {
                    updateNote(noteId, noteTitle, noteContent, selectedNoteColor);
                } else {
                    addNote(noteTitle, noteContent, selectedNoteColor);
                }
                
                closeNoteModal();
            });
            
            closeNoteModalBtn.addEventListener('click', function() {
                closeNoteModal();
            });
            
            noteModal.addEventListener('click', function(e) {
                if (e.target === noteModal) {
                    closeNoteModal();
                }
            });
            
            closeNoteViewModalBtn.addEventListener('click', function() {
                closeNoteViewModal();
            });
            
            noteViewModal.addEventListener('click', function(e) {
                if (e.target === noteViewModal) {
                    closeNoteViewModal();
                }
            });
            
            editNoteViewBtn.addEventListener('click', function() {
                if (currentViewingNote) {
                    closeNoteViewModal();
                    setTimeout(() => {
                        openNoteModal(currentViewingNote);
                    }, 300);
                }
            });
            
            deleteNoteViewBtn.addEventListener('click', function() {
                if (currentViewingNote) {
                    if (confirm('Tem certeza que deseja excluir esta nota?')) {
                        deleteNote(currentViewingNote.id);
                        closeNoteViewModal();
                    }
                }
            });
            
            closePlantaoViewModalBtn.addEventListener('click', function() {
                closePlantaoViewModal();
            });
            
            plantaoViewModal.addEventListener('click', function(e) {
                if (e.target === plantaoViewModal) {
                    closePlantaoViewModal();
                }
            });
            
            newPlantaoViewBtn.addEventListener('click', function() {
                closePlantaoViewModal();
                setTimeout(() => {
                    const today = formatDateToYYYYMMDD(new Date());
                    openPlantaoModal(today);
                }, 300);
            });
            
            editPlantaoViewBtn.addEventListener('click', function() {
                if (currentViewingPlantao && currentViewingPlantaoDate) {
                    closePlantaoViewModal();
                    setTimeout(() => {
                        openPlantaoModal(currentViewingPlantaoDate, currentViewingPlantao);
                    }, 300);
                }
            });
            
            deletePlantaoViewBtn.addEventListener('click', function() {
                if (currentViewingPlantao && currentViewingPlantaoDate) {
                    if (confirm('Tem certeza que deseja excluir este plantão?')) {
                        deletePlantao(currentViewingPlantaoDate, currentViewingPlantao.id);
                        generateCalendar();
                        closePlantaoViewModal();
                        showToast('Plantão excluído com sucesso!');
                    }
                }
            });
            
            closeSettingsModalBtn.addEventListener('click', function() {
                closeSettingsModal();
            });
            
            settingsModal.addEventListener('click', function(e) {
                if (e.target === settingsModal) {
                    closeSettingsModal();
                }
            });
            
            clearAllDataBtn.addEventListener('click', function() {
                clearAllData();
            });
            
            exportDataBtn.addEventListener('click', function() {
                exportData();
            });
            
            importDataBtn.addEventListener('click', function() {
                importData();
            });
            
            importFileInput.addEventListener('change', function(e) {
                processImportedFile(e);
            });
            
            addNewShiftBtn.addEventListener('click', function() {
                addShiftForm.style.display = 'block';
                addNewShiftBtn.style.display = 'none';
                editingShiftId = null;
                newShiftName.value = '';
                newShiftStart.value = '';
                newShiftEnd.value = '';
                newShiftValue.value = '';
            });
            
            saveNewShiftBtn.addEventListener('click', function() {
                const name = newShiftName.value.trim();
                const startTime = newShiftStart.value;
                const endTime = newShiftEnd.value;
                const value = newShiftValue.value.trim();
                
                if (!name || !startTime || !endTime || !value) {
                    showToast('Preencha todos os campos!');
                    return;
                }
                
                if (editingShiftId) {
                    updateShift(editingShiftId, name, startTime, endTime, value);
                } else {
                    addShift(name, startTime, endTime, value);
                }
                
                renderSettingsShiftsList();
                renderShiftsSelector();
                
                addShiftForm.style.display = 'none';
                addNewShiftBtn.style.display = 'block';
                
                showToast(editingShiftId ? 'Plantão atualizado com sucesso!' : 'Plantão adicionado com sucesso!');
            });
            
            cancelNewShiftBtn.addEventListener('click', function() {
                addShiftForm.style.display = 'none';
                addNewShiftBtn.style.display = 'block';
            });
            
            applyFiltersBtn.addEventListener('click', generateAnalytics);
            recalculateBtn.addEventListener('click', generateAnalytics);
            
            // Inicializar
            generateCalendar();
            loadNotes();
            renderSettingsShiftsList();
            loadSectionPreferences();
            
            if (!analyticsSection.classList.contains('section-hidden')) {
                generateAnalytics();
            }
            
            updateSortButtons();
        });
    </script>
</body>
</html>
