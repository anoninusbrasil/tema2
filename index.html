<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendário de Plantões</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #6a40bf;
            --secondary-color: #ff9e40;
            --accent-color: #47b881;
            --background-color: #f8f5ff;
            --card-color: #ffffff;
            --text-color: #2d2a32;
            --light-text: #7c7a80;
            --border-color: #e5e2ec;
            
            --sd-color: #4BA0FF;
            --sn-color: #D5A755;
            --dn-color: #AC00FF;
            --troca-color: #A9FF00;
            --extra-sd-color: #4BA0FF;
            --extra-sn-color: #D5A755;
            --extra-dn-color: #38B800;
            --lefe-sd-color: #4BA0FF;
            --lefe-sn-color: #D5A755;
            --lefe-dn-color: #FF0100;
            --today-color: #ffeb3b;
            --today-text-color: #000;
            
            --tab-active: #6a40bf;
            --tab-inactive: #e5e2ec;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 10px;
            touch-action: manipulation;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 100%;
            margin: 0;
            padding: 10px;
            background-color: var(--card-color);
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }
        
        h1, h2, h3 {
            color: var(--primary-color);
            margin-bottom: 16px;
        }
        
        h1 {
            text-align: center;
            font-size: 1.8rem;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 20px;
        }
        
        /* --- Sistema de Abas --- */
        .tabs {
            display: flex;
            margin-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }
        
        .tabs::-webkit-scrollbar {
            display: none;
        }
        
        .tab {
            padding: 8px 12px;
            cursor: pointer;
            background: var(--tab-inactive);
            border-radius: 6px 6px 0 0;
            margin-right: 4px;
            transition: all 0.3s ease;
            white-space: nowrap;
            font-size: 0.85rem;
            font-weight: bold;
            flex-shrink: 0;
            min-height: 36px;
            display: flex;
            align-items: center;
        }
        
        .tab.active {
            background: var(--tab-active);
            color: white;
        }
        
        .tab-content {
            display: none;
            padding: 10px;
            background: var(--card-color);
            border-radius: 0 0 8px 8px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* --- Cores dos Plantões --- */
        .sd, .legenda .sd-bg { background-color: var(--sd-color); }
        .sn, .legenda .sn-bg { background-color: var(--sn-color); }
        .dn, .legenda .dn-bg { background-color: var(--dn-color); }
        .troca, .legenda .troca-bg { background-color: var(--troca-color); }
        .extra-sd, .legenda .extra-sd-bg { background-color: var(--extra-sd-color); }
        .extra-sn, .legenda .extra-sn-bg { background-color: var(--extra-sn-color); }
        .extra-dn, .legenda .extra-dn-bg { background-color: var(--extra-dn-color); }
        .lefe-sd, .legenda .lefe-sd-bg { background-color: var(--lefe-sd-color); }
        .lefe-sn, .legenda .lefe-sn-bg { background-color: var(--lefe-sn-color); }
        .lefe-dn, .legenda .lefe-dn-bg { background-color: var(--lefe-dn-color); }
        
        /* Dia atual */
        .today {
            background-color: var(--today-color) !important;
            color: var(--today-text-color) !important;
        }
        .today .day-number {
            font-weight: bold;
            color: #000;
        }
        
        /* --- Tabela do Calendário --- */
        .calendario-mes {
            width: 100%;
            overflow: hidden;
        }
        
        .calendario-container {
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
            margin: 0;
            padding: 0;
            width: 100%;
        }
        
        .calendario {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            table-layout: fixed;
        }
        
        .calendario caption {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 12px;
            color: var(--primary-color);
            padding: 8px;
        }
        
        .calendario th, .calendario td {
            border: 1px solid var(--border-color);
            padding: 12px 8px;
            text-align: center;
            vertical-align: top;
            width: calc(100% / 7);
        }
        
        .calendario th {
            background-color: #f2f2f2;
            font-weight: bold;
            font-size: 0.9rem;
            color: var(--primary-color);
            padding: 10px 5px;
        }
        
        .calendario td {
            height: 90px;
            position: relative;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .calendario td:active {
            background-color: rgba(106, 64, 191, 0.1);
        }
        
        .calendario .day-number {
            font-weight: bold;
            font-size: 0.9rem;
            color: var(--text-color);
            margin-bottom: 4px;
        }
        
        .calendario .plantao-info {
            font-size: 0.7rem;
            font-weight: bold;
            color: white;
            padding: 3px;
            border-radius: 4px;
            display: block;
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            width: 100%;
        }
        
        /* Células vazias ou de outros meses */
        .calendario .other-month {
            background-color: #fafafa;
            color: #ccc;
        }
        
        .calendario .continuation {
            font-style: italic;
            font-size: 0.7rem;
            color: #777;
        }

        /* --- Seção de Resumo --- */
        #resumo {
            background-color: #f9f9f9;
            border-left: 4px solid var(--primary-color);
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 20px;
            min-width: auto;
        }
        
        #resumo h2 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        
        #resumo .resumo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 10px;
            margin-bottom: 10px;
        }
        
        #resumo .resumo-item {
            background-color: white;
            border-radius: 8px;
            padding: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s;
        }
        
        #resumo .resumo-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        #resumo .resumo-item h3 {
            color: var(--primary-color);
            font-size: 1rem;
            margin-bottom: 8px;
        }
        
        #resumo .resumo-item p {
            font-size: 0.95rem;
            line-height: 1.6;
            margin: 0;
        }
        
        #resumo .total-geral {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--accent-color);
            text-align: center;
            margin-top: 10px;
            padding: 10px;
            background-color: rgba(71, 184, 129, 0.1);
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        
        #resumo .total-acumulado {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--primary-color);
            text-align: center;
            margin-top: 10px;
            padding: 10px;
            background-color: rgba(106, 64, 191, 0.1);
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        
        /* --- Legenda --- */
        .legenda {
            margin-bottom: 20px;
            padding: 10px;
            background-color: var(--card-color);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            min-width: auto;
        }
        
        .legenda h2 {
            color: var(--primary-color);
            margin-bottom: 10px;
            text-align: center;
        }
        
        .legenda-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 10px;
        }
        
        .legenda-item {
            display: flex;
            align-items: center;
            padding: 8px;
            background-color: rgba(106, 64, 191, 0.05);
            border-radius: 8px;
            transition: transform 0.2s;
        }
        
        .legenda-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .legenda-item strong {
            display: inline-block;
            padding: 8px 12px;
            color: white;
            border-radius: 6px;
            margin-right: 12px;
            min-width: 60px;
            text-align: center;
        }
        
        .legenda-item span {
            flex: 1;
        }
        
        .legenda-instrucoes {
            margin-top: 10px;
            text-align: center;
            font-style: italic;
            color: var(--light-text);
        }
        
        /* --- Rodapé do Calendário com Legendas --- */
        .calendario-legendas {
            margin-top: 10px;
            padding: 10px;
            background-color: rgba(106, 64, 191, 0.05);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }
        
        .calendario-legendas h3 {
            color: var(--primary-color);
            margin-bottom: 8px;
            font-size: 1rem;
            font-weight: bold;
            text-align: center;
        }
        
        .legendas-lista {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 8px;
        }
        
        .legenda-item-calendario {
            background-color: white;
            border-radius: 6px;
            padding: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .legenda-item-calendario:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .legenda-dia {
            font-weight: bold;
            color: var(--primary-color);
            min-width: 40px;
            text-align: center;
            background-color: rgba(106, 64, 191, 0.1);
            padding: 6px;
            border-radius: 4px;
        }
        
        .legenda-conteudo {
            flex: 1;
        }
        
        .legenda-tipo {
            font-weight: bold;
            margin-bottom: 4px;
        }
        
        .legenda-texto {
            font-size: 0.9rem;
            color: var(--text-color);
            font-weight: bold;
        }
        
        .sem-legendas {
            text-align: center;
            color: var(--light-text);
            font-style: italic;
            padding: 10px;
        }
        
        /* --- Controles --- */
        .calendario-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
            padding: 10px;
            background-color: rgba(106, 64, 191, 0.05);
            border-radius: 8px;
            flex-wrap: wrap;
        }
        
        .calendario-controls .control-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .calendario-controls label {
            font-weight: bold;
            color: var(--primary-color);
            white-space: nowrap;
        }
        
        .calendario-controls select {
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background-color: var(--card-color);
            font-size: 1rem;
            color: var(--text-color);
            transition: all 0.3s ease;
            min-height: 40px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%236a40bf' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 14px;
            padding-right: 35px;
            appearance: none;
        }
        
        /* Botão Flutuante */
        .floating-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(106, 64, 191, 0.25);
            cursor: pointer;
            z-index: 1000;
            transition: all 0.3s ease;
            font-size: 1.5rem;
        }
        
        .floating-button:active {
            transform: scale(0.95);
            box-shadow: 0 2px 8px rgba(106, 64, 191, 0.35);
        }
        
        .floating-menu {
            position: fixed;
            bottom: 90px;
            right: 20px;
            background-color: var(--card-color);
            border-radius: 10px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
            padding: 10px;
            display: none;
            flex-direction: column;
            gap: 8px;
            z-index: 999;
            width: 200px;
        }
        
        .floating-menu button {
            padding: 10px;
            border: none;
            border-radius: 6px;
            background-color: var(--primary-color);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
            font-size: 0.95rem;
            min-height: 40px;
        }
        
        .floating-menu button:active {
            background-color: #5835a0;
        }
        
        /* Modal para exportar/importar */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 10px;
            overflow-y: auto;
        }
        
        .modal-content {
            background-color: var(--card-color);
            padding: 10px;
            border-radius: 12px;
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }
        
        .modal h2 {
            color: var(--primary-color);
            margin-bottom: 10px;
            text-align: center;
            font-size: 1.4rem;
        }
        
        .modal textarea {
            width: 100%;
            height: 200px;
            margin: 8px 0;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            resize: vertical;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }
        
        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 10px;
        }
        
        .modal-buttons button {
            padding: 10px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s;
            font-size: 0.9rem;
            min-height: 40px;
        }
        
        .modal-buttons button:first-child {
            background-color: var(--accent-color);
            color: white;
        }
        
        .modal-buttons button:last-child {
            background-color: #e2e2e2;
            color: var(--text-color);
        }
        
        /* Modal de personalização de cores */
        .color-picker {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }
        
        .color-picker label {
            width: 120px;
            font-weight: bold;
            color: var(--text-color);
            font-size: 0.9rem;
            margin-bottom: 5px;
        }
        
        .color-picker input[type="color"] {
            width: 50px;
            height: 40px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            margin-right: 10px;
            cursor: pointer;
        }
        
        .btn-cor-padrao {
            padding: 8px 10px;
            background-color: #e2e2e2;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85rem;
            min-height: 36px;
        }
        
        /* Modal de valores dos plantões */
        .valores-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .valor-input {
            display: flex;
            flex-direction: column;
            margin-bottom: 10px;
        }
        
        .valor-input label {
            font-weight: bold;
            color: var(--text-color);
            font-size: 0.9rem;
            margin-bottom: 5px;
        }
        
        .valor-input input {
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 0.9rem;
            min-height: 40px;
        }
        
        /* Modal de nomes dos plantões */
        .nomes-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .nome-input {
            display: flex;
            flex-direction: column;
            margin-bottom: 10px;
        }
        
        .nome-input label {
            font-weight: bold;
            color: var(--text-color);
            font-size: 0.9rem;
            margin-bottom: 5px;
        }
        
        .nome-input input {
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 0.9rem;
            min-height: 40px;
        }
        
        /* Lista de plantões no modal */
        .plantao-item {
            display: flex;
            flex-direction: column;
            padding: 8px;
            border-bottom: 1px solid var(--border-color);
            border-radius: 6px;
            margin-bottom: 6px;
            background-color: rgba(106, 64, 191, 0.05);
        }
        
        .plantao-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .plantao-item button {
            background-color: #e74c3c;
            color: white;
            border: none;
            padding: 8px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85rem;
            min-height: 36px;
        }
        
        .plantao-legenda {
            width: 100%;
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 0.9rem;
        }
        
        /* Botões para adicionar plantão */
        .btn-tipo-plantao {
            padding: 10px;
            border: none;
            border-radius: 6px;
            background-color: var(--primary-color);
            color: white;
            cursor: pointer;
            text-align: left;
            transition: all 0.2s;
            font-size: 0.9rem;
            min-height: 40px;
        }
        
        .btn-tipo-plantao:active {
            background-color: #5835a0;
        }
        
        /* Botão para salvar legendas */
        .btn-salvar-legendas {
            margin-top: 10px;
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: 10px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.2s;
            min-height: 40px;
        }
        
        .btn-salvar-legendas:hover {
            background-color: #3da870;
        }
        
        .btn-salvar-legendas:active {
            transform: scale(0.98);
        }
        
        /* Estilos para a nova funcionalidade de troca de plantão */
        .troca-plantao-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .troca-input {
            display: flex;
            flex-direction: column;
        }
        
        .troca-input label {
            font-weight: bold;
            color: var(--text-color);
            margin-bottom: 5px;
        }
        
        .troca-input input, .troca-input select {
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 0.9rem;
        }
        
        .descricao-troca-preview {
            background-color: rgba(106, 64, 191, 0.05);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .descricao-troca-preview h3 {
            margin-bottom: 10px;
            color: var(--primary-color);
        }
        
        .descricao-preview-container {
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }
        
        .descricao-preview-texto {
            background-color: white;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 12px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            white-space: pre-wrap;
            word-break: break-word;
            flex: 1;
        }
        
        /* Estilos para o modo de edição */
        .descricao-edit-container {
            margin-top: 10px;
            display: none;
            transition: all 0.3s ease;
        }
        
        .descricao-edit-container.editando {
            background-color: rgba(106, 64, 191, 0.05);
            border-radius: 8px;
            padding: 15px;
            border: 2px solid var(--primary-color);
        }
        
        .descricao-edit-textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            resize: vertical;
            min-height: 100px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            transition: border-color 0.3s ease;
        }
        
        .descricao-edit-textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(106, 64, 191, 0.2);
        }
        
        .descricao-edit-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 10px;
        }
        
        .descricao-edit-buttons button {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        
        .btn-salvar-edicao {
            background-color: var(--accent-color);
            color: white;
        }
        
        .btn-salvar-edicao:hover {
            background-color: #3da870;
        }
        
        .btn-cancelar-edicao {
            background-color: #e2e2e2;
            color: var(--text-color);
        }
        
        .btn-cancelar-edicao:hover {
            background-color: #d0d0d0;
        }
        
        /* Feedback visual para o botão de editar */
        .btn-editar-descricao {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.2rem;
            color: var(--primary-color);
            padding: 8px;
            border-radius: 4px;
            transition: all 0.2s ease;
        }
        
        .btn-editar-descricao:hover {
            background-color: rgba(106, 64, 191, 0.1);
            transform: scale(1.1);
        }
        
        /* Indicador visual quando está em modo de edição */
        .descricao-troca-preview {
            position: relative;
        }
        
        .descricao-troca-preview::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            border: 2px dashed var(--primary-color);
            border-radius: 6px;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }
        
        .descricao-troca-preview.editando::after {
            opacity: 1;
        }
        
        /* Estilos para a nova funcionalidade de descrição automática */
        .config-descricao-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .config-input {
            display: flex;
            flex-direction: column;
        }
        
        .config-input label {
            font-weight: bold;
            color: var(--text-color);
            margin-bottom: 5px;
        }
        
        .config-input input, .config-input select {
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 0.9rem;
        }
        
        .exemplo-descricao {
            background-color: rgba(106, 64, 191, 0.05);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .exemplo-descricao h3 {
            margin-bottom: 10px;
            color: var(--primary-color);
        }
        
        .exemplo-texto {
            background-color: white;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 12px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            white-space: pre-wrap;
            word-break: break-word;
        }
        
        .descricao-gerada {
            background-color: white;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 12px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            white-space: pre-wrap;
            word-break: break-word;
            margin-bottom: 10px;
        }
        
        /* Notificação */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: var(--accent-color);
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 2000;
            display: flex;
            align-items: center;
            gap: 10px;
            transform: translateX(150%);
            transition: transform 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification i {
            font-size: 1.2rem;
        }
        
        /* Responsividade */
        @media screen and (max-width: 1400px) {
            .container {
                max-width: 100%;
                padding: 10px;
            }
        }
        
        @media screen and (max-width: 1200px) {
            .container {
                max-width: 100%;
                padding: 10px;
            }
            
            .calendario th, .calendario td {
                padding: 10px 6px;
            }
            
            .calendario td {
                height: 85px;
            }
        }
        
        @media screen and (max-width: 992px) {
            .calendario th, .calendario td {
                padding: 8px 5px;
                font-size: 0.9rem;
            }
            
            .calendario td {
                height: 80px;
            }
            
            .calendario .plantao-info {
                font-size: 0.65rem;
                padding: 2px;
            }
        }
        
        @media screen and (max-width: 768px) {
            body {
                padding: 8px;
            }
            
            .container {
                padding: 10px;
            }
            
            h1 {
                font-size: 1.6rem;
            }
            
            .legenda-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
            
            .calendario {
                font-size: 0.9rem;
            }
            
            .calendario caption {
                font-size: 1.2rem;
            }
            
            .calendario th, .calendario td {
                padding: 6px 3px;
                font-size: 0.8rem;
            }
            
            .calendario td {
                height: 70px;
            }
            
            .calendario .day-number {
                font-size: 0.85rem;
            }
            
            .calendario .plantao-info {
                font-size: 0.6rem;
                padding: 1px;
            }
            
            #resumo p {
                font-size: 0.85rem;
            }
            
            #resumo .total-geral, #resumo .total-acumulado {
                font-size: 1.1rem;
            }
            
            .calendario-controls {
                flex-direction: row;
                gap: 10px;
                justify-content: center;
            }
            
            .calendario-controls .control-group {
                flex: 1;
                max-width: 45%;
            }
            
            .floating-menu {
                width: 180px;
                right: 15px;
                bottom: 80px;
            }
            
            .floating-button {
                width: 55px;
                height: 55px;
                right: 15px;
                bottom: 15px;
            }
            
            .tab {
                padding: 6px 10px;
                font-size: 0.8rem;
            }
            
            .modal-content {
                padding: 10px;
            }
            
            .modal h2 {
                font-size: 1.3rem;
            }
            
            .valores-grid, .nomes-grid {
                grid-template-columns: 1fr;
            }
            
            .legendas-lista {
                grid-template-columns: 1fr;
            }
            
            .troca-plantao-grid, .config-descricao-grid {
                grid-template-columns: 1fr;
            }
            
            .descricao-preview-texto, .exemplo-texto, .descricao-gerada {
                font-size: 0.8rem;
            }
        }
        
        @media screen and (max-width: 480px) {
            .container {
                padding: 8px;
            }
            
            h1 {
                font-size: 1.4rem;
            }
            
            .calendario {
                font-size: 0.8rem;
            }
            
            .calendario td {
                height: 65px;
            }
            
            .calendario .plantao-info {
                font-size: 0.6rem;
                padding: 1px;
            }
            
            .floating-button {
                bottom: 12px;
                right: 12px;
                width: 50px;
                height: 50px;
                font-size: 1.3rem;
            }
            
            .floating-menu {
                bottom: 72px;
                right: 12px;
                width: 170px;
                padding: 8px;
            }
            
            .floating-menu button {
                padding: 8px;
                font-size: 0.85rem;
            }
            
            .tab {
                padding: 5px 8px;
                font-size: 0.75rem;
            }
            
            .modal-content {
                padding: 8px;
            }
            
            .modal h2 {
                font-size: 1.2rem;
            }
            
            .modal-buttons {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .modal-buttons button {
                flex: 1;
                justify-content: center;
                margin-bottom: 5px;
            }
            
            .nome-input input {
                width: 100%;
            }
            
            /* Melhorias para a legenda em celulares */
            .legenda {
                min-width: auto;
                padding: 8px;
            }
            
            .legenda-grid {
                grid-template-columns: 1fr;
                gap: 8px;
            }
            
            .legenda-item {
                padding: 6px;
            }
            
            .legenda-item strong {
                min-width: 50px;
                padding: 6px 8px;
                font-size: 0.85rem;
            }
            
            .legenda-item span {
                font-size: 0.85rem;
            }
            
            .legenda h2 {
                font-size: 1rem;
                margin-bottom: 8px;
            }
            
            .legenda-instrucoes {
                font-size: 0.8rem;
                margin-top: 8px;
            }
            
            .calendario-legendas h3 {
                font-size: 0.9rem;
            }
            
            .legenda-item-calendario {
                flex-direction: column;
                align-items: flex-start;
                gap: 6px;
            }
            
            .legenda-dia {
                min-width: auto;
                width: 100%;
                text-align: center;
            }
        }
    </style>
</head>
<body>

    <div class="container">
        <h1><i class="fas fa-calendar-alt"></i> Calendário de Plantões</h1>
        
        <div class="tabs">
            <div class="tab active" data-tab="calendario">Calendário</div>
            <div class="tab" data-tab="legenda">Legenda</div>
            <div class="tab" data-tab="resumo">Resumo</div>
        </div>
        
        <div class="tab-content active" id="calendario-tab">
            <section id="calendario-mes">
                <!-- O calendário será gerado aqui pelo JavaScript -->
            </section>
            
            <div class="calendario-controls">
                <div class="control-group">
                    <label for="mes-selecionado">Mês:</label>
                    <select id="mes-selecionado">
                        <option value="0">Janeiro</option>
                        <option value="1">Fevereiro</option>
                        <option value="2">Março</option>
                        <option value="3">Abril</option>
                        <option value="4">Maio</option>
                        <option value="5" selected>Junho</option>
                        <option value="6">Julho</option>
                        <option value="7">Agosto</option>
                        <option value="8">Setembro</option>
                        <option value="9">Outubro</option>
                        <option value="10">Novembro</option>
                        <option value="11">Dezembro</option>
                    </select>
                </div>
                  
                <div class="control-group">
                    <label for="ano-selecionado">&nbsp;&nbsp;&nbsp;&nbsp; &thinsp;&nbsp;&nbsp;Ano:</label>
                    <select id="ano-selecionado">
                        <option value="2024" selected>2024</option>
                        <option value="2025">2025</option>
                        <option value="2026">2026</option>
                        <option value="2027">2027</option>
                        <option value="2028">2028</option>
                        <option value="2029">2029</option>
                        <option value="2030">2030</option>
                    </select>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="legenda-tab">
            <section class="legenda">
                <h2><i class="fas fa-info-circle"></i> Legenda dos Plantões</h2>
                <div class="legenda-grid">
                    <div class="legenda-item">
                        <strong class="sd-bg">SD</strong>
                        <span>Plantão Diurno (12h) - R$ 100,00</span>
                    </div>
                    <div class="legenda-item">
                        <strong class="sn-bg">SN</strong>
                        <span>Plantão Noturno (12h) - R$ 100,00</span>
                    </div>
                    <div class="legenda-item">
                        <strong class="dn-bg">DN</strong>
                        <span>Plantão Dia/Noite (24h) - R$ 200,00</span>
                    </div>
                    <div class="legenda-item">
                        <strong class="extra-sd-bg">Extra SD</strong>
                        <span>Plantão Extra Diurno - R$ 100,00</span>
                    </div>
                    <div class="legenda-item">
                        <strong class="extra-sn-bg">Extra SN</strong>
                        <span>Plantão Extra Noturno - R$ 100,00</span>
                    </div>
                    <div class="legenda-item">
                        <strong class="extra-dn-bg">Extra DN</strong>
                        <span>Plantão Extra Dia/Noite - R$ 200,00</span>
                    </div>
                    <div class="legenda-item">
                        <strong class="lefe-sd-bg">Lefe Dia</strong>
                        <span>Plantão Lefe Diurno - R$ 100,00</span>
                    </div>
                    <div class="legenda-item">
                        <strong class="lefe-sn-bg">Lefe Noite</strong>
                        <span>Plantão Lefe Noturno - R$ 100,00</span>
                    </div>
                    <div class="legenda-item">
                        <strong class="lefe-dn-bg">Lefe DN</strong>
                        <span>Plantão Lefe Dia/Noite - R$ 250,00</span>
                    </div>
                    <div class="legenda-item">
                        <strong class="troca-bg">Troca</strong>
                        <span>Plantão trocado</span>
                    </div>
                </div>
                <div class="legenda-instrucoes">
                    <p><i class="fas fa-mouse-pointer"></i> Clique em um dia para adicionar/remover plantões</p>
                    <p><i class="fas fa-mouse-pointer"></i> Clique com o botão direito para limpar todos os plantões do dia</p>
                </div>
            </section>
        </div>
        
        <div class="tab-content" id="resumo-tab">
            <section id="resumo">
                <h2><i class="fas fa-calculator"></i> Resumo e Cálculo do Mês</h2>
                <div class="resumo-grid">
                    <div class="resumo-item">
                        <h3>Plantões SD</h3>
                        <p id="total-sd">
                            <strong>Total:</strong> 0 &nbsp; (0 x R$ 100,00 = <strong>R$ 0,00</strong>)
                        </p>
                    </div>
                    <div class="resumo-item">
                        <h3>Plantões SN</h3>
                        <p id="total-sn">
                            <strong>Total:</strong> 0 &nbsp; (0 x R$ 100,00 = <strong>R$ 0,00</strong>)
                        </p>
                    </div>
                    <div class="resumo-item">
                        <h3>Plantões DN</h3>
                        <p id="total-dn">
                            <strong>Total:</strong> 0 &nbsp; (0 x R$ 200,00 = <strong>R$ 0,00</strong>)
                        </p>
                    </div>
                    <div class="resumo-item">
                        <h3>Plantões Extra SD</h3>
                        <p id="total-extra-sd">
                            <strong>Total:</strong> 0 &nbsp; (0 x R$ 100,00 = <strong>R$ 0,00</strong>)
                        </p>
                    </div>
                    <div class="resumo-item">
                        <h3>Plantões Extra SN</h3>
                        <p id="total-extra-sn">
                            <strong>Total:</strong> 0 &nbsp; (0 x R$ 100,00 = <strong>R$ 0,00</strong>)
                        </p>
                    </div>
                    <div class="resumo-item">
                        <h3>Plantões Extra DN</h3>
                        <p id="total-extra-dn">
                            <strong>Total:</strong> 0 &nbsp; (0 x R$ 200,00 = <strong>R$ 0,00</strong>)
                        </p>
                    </div>
                    <div class="resumo-item">
                        <h3>Plantões Lefe Dia</h3>
                        <p id="total-lefe-sd">
                            <strong>Total:</strong> 0 &nbsp; (0 x R$ 100,00 = <strong>R$ 0,00</strong>)
                        </p>
                    </div>
                    <div class="resumo-item">
                        <h3>Plantões Lefe Noite</h3>
                        <p id="total-lefe-sn">
                            <strong>Total:</strong> 0 &nbsp; (0 x R$ 100,00 = <strong>R$ 0,00</strong>)
                        </p>
                    </div>
                    <div class="resumo-item">
                        <h3>Plantões Lefe DN</h3>
                        <p id="total-lefe-dn">
                            <strong>Total:</strong> 0 &nbsp; (0 x R$ 250,00 = <strong>R$ 0,00</strong>)
                        </p>
                    </div>
                </div>
                <div class="total-geral" id="total-geral">
                    <i class="fas fa-money-bill-wave"></i> Valor Total a Receber: R$ 0,00
                </div>
                <div class="total-acumulado" id="total-acumulado">
                    <i class="fas fa-chart-line"></i> Valor Total Acumulado: R$ 0,00
                </div>
            </section>
        </div>
    </div>
    
    <!-- Botão Flutuante e Menu -->
    <div class="floating-button" id="config-button">
        <i class="fas fa-cog"></i>
    </div>
    
    <div class="floating-menu" id="config-menu">
        <button id="btn-exportar"><i class="fas fa-file-export"></i> Exportar Dados</button>
        <button id="btn-importar"><i class="fas fa-file-import"></i> Importar Dados</button>
        <button id="btn-cores"><i class="fas fa-palette"></i> Personalizar Cores</button>
        <button id="btn-valores"><i class="fas fa-money-bill"></i> Alterar Valores</button>
        <button id="btn-nomes"><i class="fas fa-font"></i> Alterar Nomes</button>
        <button id="btn-config-descricao"><i class="fas fa-file-alt"></i> Configurar Descrição</button>
        <button id="btn-troca-plantao"><i class="fas fa-exchange-alt"></i> Troca de Plantão</button>
    </div>
    
    <!-- Modal para exportar/importar -->
    <div class="modal" id="modal-dados">
        <div class="modal-content">
            <h2 id="modal-titulo"><i class="fas fa-file-export"></i> Exportar Dados</h2>
            <textarea id="dados-texto" placeholder="Dados de configuração aparecerão aqui..."></textarea>
            <div class="modal-buttons">
                <button id="btn-copiar"><i class="fas fa-copy"></i> Copiar</button>
                <button id="btn-fechar-modal"><i class="fas fa-times"></i> Fechar</button>
                <button id="btn-aplicar-dados" style="display:none;"><i class="fas fa-check"></i> Aplicar Dados</button>
            </div>
        </div>
    </div>
    
    <!-- Modal para personalizar cores -->
    <div class="modal" id="modal-cores">
        <div class="modal-content">
            <h2><i class="fas fa-palette"></i> Personalizar Cores dos Plantões</h2>
            
            <div class="color-picker">
                <label for="cor-sd">Plantão SD:</label>
                <input type="color" id="cor-sd" value="#4BA0FF">
                <button class="btn-cor-padrao" data-tipo="sd">Padrão</button>
            </div>
            
            <div class="color-picker">
                <label for="cor-sn">Plantão SN:</label>
                <input type="color" id="cor-sn" value="#D5A755">
                <button class="btn-cor-padrao" data-tipo="sn">Padrão</button>
            </div>
            
            <div class="color-picker">
                <label for="cor-dn">Plantão DN:</label>
                <input type="color" id="cor-dn" value="#AC00FF">
                <button class="btn-cor-padrao" data-tipo="dn">Padrão</button>
            </div>
            
            <div class="color-picker">
                <label for="cor-extra-sd">Extra SD:</label>
                <input type="color" id="cor-extra-sd" value="#4BA0FF">
                <button class="btn-cor-padrao" data-tipo="extra-sd">Padrão</button>
            </div>
            
            <div class="color-picker">
                <label for="cor-extra-sn">Extra SN:</label>
                <input type="color" id="cor-extra-sn" value="#D5A755">
                <button class="btn-cor-padrao" data-tipo="extra-sn">Padrão</button>
            </div>
            
            <div class="color-picker">
                <label for="cor-extra-dn">Extra DN:</label>
                <input type="color" id="cor-extra-dn" value="#38B800">
                <button class="btn-cor-padrao" data-tipo="extra-dn">Padrão</button>
            </div>
            
            <div class="color-picker">
                <label for="cor-lefe-sd">Lefe Dia:</label>
                <input type="color" id="cor-lefe-sd" value="#4BA0FF">
                <button class="btn-cor-padrao" data-tipo="lefe-sd">Padrão</button>
            </div>
            
            <div class="color-picker">
                <label for="cor-lefe-sn">Lefe Noite:</label>
                <input type="color" id="cor-lefe-sn" value="#D5A755">
                <button class="btn-cor-padrao" data-tipo="lefe-sn">Padrão</button>
            </div>
            
            <div class="color-picker">
                <label for="cor-lefe-dn">Lefe DN:</label>
                <input type="color" id="cor-lefe-dn" value="#FF0100">
                <button class="btn-cor-padrao" data-tipo="lefe-dn">Padrão</button>
            </div>
            
            <div class="color-picker">
                <label for="cor-troca">Troca:</label>
                <input type="color" id="cor-troca" value="#A9FF00">
                <button class="btn-cor-padrao" data-tipo="troca">Padrão</button>
            </div>
            
            <div class="color-picker">
                <label for="cor-hoje">Dia Atual:</label>
                <input type="color" id="cor-hoje" value="#ffeb3b">
                <button class="btn-cor-padrao" data-tipo="hoje">Padrão</button>
            </div>
            
            <div class="modal-buttons">
                <button id="btn-aplicar-cores"><i class="fas fa-check"></i> Aplicar Cores</button>
                <button id="btn-fechar-cores"><i class="fas fa-times"></i> Fechar</button>
            </div>
        </div>
    </div>
    
    <!-- Modal para alterar valores -->
    <div class="modal" id="modal-valores">
        <div class="modal-content">
            <h2><i class="fas fa-money-bill"></i> Alterar Valores dos Plantões</h2>
            
            <div class="valores-grid">
                <div class="valor-input">
                    <label for="valor-sd">Plantão SD</label>
                    <input type="number" id="valor-sd" value="100" min="0" step="10">
                </div>
                
                <div class="valor-input">
                    <label for="valor-sn">Plantão SN</label>
                    <input type="number" id="valor-sn" value="100" min="0" step="10">
                </div>
                
                <div class="valor-input">
                    <label for="valor-dn">Plantão DN</label>
                    <input type="number" id="valor-dn" value="200" min="0" step="10">
                </div>
                
                <div class="valor-input">
                    <label for="valor-extra-sd">Extra SD</label>
                    <input type="number" id="valor-extra-sd" value="100" min="0" step="10">
                </div>
                
                <div class="valor-input">
                    <label for="valor-extra-sn">Extra SN</label>
                    <input type="number" id="valor-extra-sn" value="100" min="0" step="10">
                </div>
                
                <div class="valor-input">
                    <label for="valor-extra-dn">Extra DN</label>
                    <input type="number" id="valor-extra-dn" value="200" min="0" step="10">
                </div>
                
                <div class="valor-input">
                    <label for="valor-lefe-sd">Lefe Dia</label>
                    <input type="number" id="valor-lefe-sd" value="100" min="0" step="10">
                </div>
                
                <div class="valor-input">
                    <label for="valor-lefe-sn">Lefe Noite</label>
                    <input type="number" id="valor-lefe-sn" value="100" min="0" step="10">
                </div>
                
                <div class="valor-input">
                    <label for="valor-lefe-dn">Lefe DN</label>
                    <input type="number" id="valor-lefe-dn" value="250" min="0" step="10">
                </div>
            </div>
            
            <div class="modal-buttons">
                <button id="btn-aplicar-valores"><i class="fas fa-check"></i> Aplicar Valores</button>
                <button id="btn-fechar-valores"><i class="fas fa-times"></i> Fechar</button>
            </div>
        </div>
    </div>
    
    <!-- Modal para alterar nomes -->
    <div class="modal" id="modal-nomes">
        <div class="modal-content">
            <h2><i class="fas fa-font"></i> Alterar Nomes dos Plantões</h2>
            
            <div class="nomes-grid">
                <div class="nome-input">
                    <label for="nome-sd">Plantão SD</label>
                    <input type="text" id="nome-sd" value="SD" maxlength="20">
                </div>
                
                <div class="nome-input">
                    <label for="nome-sn">Plantão SN</label>
                    <input type="text" id="nome-sn" value="SN" maxlength="20">
                </div>
                
                <div class="nome-input">
                    <label for="nome-dn">Plantão DN</label>
                    <input type="text" id="nome-dn" value="DN" maxlength="20">
                </div>
                
                <div class="nome-input">
                    <label for="nome-extra-sd">Extra SD</label>
                    <input type="text" id="nome-extra-sd" value="Extra SD" maxlength="20">
                </div>
                
                <div class="nome-input">
                    <label for="nome-extra-sn">Extra SN</label>
                    <input type="text" id="nome-extra-sn" value="Extra SN" maxlength="20">
                </div>
                
                <div class="nome-input">
                    <label for="nome-extra-dn">Extra DN</label>
                    <input type="text" id="nome-extra-dn" value="Extra DN" maxlength="20">
                </div>
                
                <div class="nome-input">
                    <label for="nome-lefe-sd">Lefe Dia</label>
                    <input type="text" id="nome-lefe-sd" value="Lefe Dia" maxlength="20">
                </div>
                
                <div class="nome-input">
                    <label for="nome-lefe-sn">Lefe Noite</label>
                    <input type="text" id="nome-lefe-sn" value="Lefe Noite" maxlength="20">
                </div>
                
                <div class="nome-input">
                    <label for="nome-lefe-dn">Lefe DN</label>
                    <input type="text" id="nome-lefe-dn" value="Lefe DN" maxlength="20">
                </div>
                
                <div class="nome-input">
                    <label for="nome-troca">Troca</label>
                    <input type="text" id="nome-troca" value="Troca" maxlength="20">
                </div>
            </div>
            
            <div class="modal-buttons">
                <button id="btn-aplicar-nomes"><i class="fas fa-check"></i> Aplicar Nomes</button>
                <button id="btn-fechar-nomes"><i class="fas fa-times"></i> Fechar</button>
            </div>
        </div>
    </div>
    
    <!-- Modal para configurar descrição -->
    <div class="modal" id="modal-config-descricao">
        <div class="modal-content">
            <h2><i class="fas fa-file-alt"></i> Configurar Descrição Automática</h2>
            
            <div class="config-descricao-grid">
                <div class="config-input">
                    <label for="hospital">Hospital/Local</label>
                    <input type="text" id="hospital" value="HRL" maxlength="20">
                </div>
                
                <div class="config-input">
                    <label for="condutor">Condutor</label>
                    <input type="text" id="condutor" value="Anderson" maxlength="30">
                </div>
                
                <div class="config-input">
                    <label for="modelo-descricao">Modelo de Descrição</label>
                    <select id="modelo-descricao">
                        <option value="troca">Troca de plantão</option>
                        <option value="simples">Plantão simples</option>
                    </select>
                </div>
            </div>
            
            <div class="exemplo-descricao">
                <h3>Exemplo de como ficará:</h3>
                <div class="exemplo-texto" id="exemplo-descricao">🔁 Plantão trocado: Lefe SN 📅 2/09 ➝ Lefe SD 📅 16/09 🙋🏻‍♂️ Condutor: Anderson</div>
            </div>
            
            <div class="modal-buttons">
                <button id="btn-aplicar-config-descricao"><i class="fas fa-check"></i> Aplicar Configuração</button>
                <button id="btn-fechar-config-descricao"><i class="fas fa-times"></i> Fechar</button>
            </div>
        </div>
    </div>
    
    <!-- Modal para troca de plantão -->
    <div class="modal" id="modal-troca-plantao">
        <div class="modal-content">
            <h2><i class="fas fa-exchange-alt"></i> Registrar Troca de Plantão</h2>
            
            <div class="troca-plantao-grid">
                <div class="troca-input">
                    <label for="dia-original">Dia Original (será trocado)</label>
                    <input type="date" id="dia-original">
                </div>
                
                <div class="troca-input">
                    <label for="dia-troca">Dia da Troca (receberá o plantão)</label>
                    <input type="date" id="dia-troca">
                </div>
                
                <div class="troca-input">
                    <label for="tipo-plantao-troca">Tipo de Plantão</label>
                    <select id="tipo-plantao-troca">
                        <option value="0">SD - Plantão Diurno</option>
                        <option value="1">SN - Plantão Noturno</option>
                        <option value="2">DN - Plantão Dia/Noite</option>
                        <option value="3">Extra SD - Plantão Extra Diurno</option>
                        <option value="4">Extra SN - Plantão Extra Noturno</option>
                        <option value="5">Extra DN - Plantão Extra Dia/Noite</option>
                        <option value="7">Lefe Dia - Plantão Lefe Diurno</option>
                        <option value="8">Lefe Noite - Plantão Lefe Noturno</option>
                        <option value="9">Lefe DN - Plantão Lefe Dia/Noite</option>
                    </select>
                </div>
            </div>
            
            <div class="descricao-troca-preview">
                <h3>Descrição da Troca</h3>
                <div class="descricao-preview-container">
                    <div class="descricao-preview-texto" id="descricao-troca-preview">SD 12hs 🙋 Condutor: Anderson 🔁 Troca de plantão: SD 📅 21/09 ➝ SD 📅 30/10</div>
                    <button class="btn-editar-descricao" id="btn-editar-descricao-troca" title="Editar descrição">
                        <i class="fas fa-edit"></i>
                    </button>
                </div>
                <div class="descricao-edit-container" id="descricao-edit-container">
                    <textarea class="descricao-edit-textarea" id="descricao-edit-textarea"></textarea>
                    <div class="descricao-edit-buttons">
                        <button class="btn-salvar-edicao" id="btn-salvar-edicao-troca">Salvar</button>
                        <button class="btn-cancelar-edicao" id="btn-cancelar-edicao-troca">Cancelar</button>
                    </div>
                </div>
            </div>
            
            <div class="modal-buttons">
                <button id="btn-executar-troca"><i class="fas fa-check"></i> Executar Troca</button>
                <button id="btn-fechar-troca"><i class="fas fa-times"></i> Fechar</button>
            </div>
        </div>
    </div>
    
    <!-- Modal para adicionar/remover plantões -->
    <div class="modal" id="modal-plantao">
        <div class="modal-content">
            <h2 id="modal-plantao-titulo"><i class="fas fa-calendar-plus"></i> Plantões do Dia <span id="dia-selecionado"></span></h2>
            
            <div id="plantoes-existente">
                <h3><i class="fas fa-list"></i> Plantões Atuais</h3>
                <div id="lista-plantoes"></div>
                <button id="btn-salvar-legendas" class="btn-salvar-legendas">
                    <i class="fas fa-save"></i> Salvar Legendas
                </button>
            </div>
            
            <div id="adicionar-plantao">
                <h3><i class="fas fa-plus-circle"></i> Adicionar Plantão</h3>
                <div style="display: flex; flex-direction: column; gap: 8px; margin: 10px 0;">
                    <button class="btn-tipo-plantao" data-tipo="sd">Plantão Diurno (<span class="nome-sd">SD</span>) - R$ <span class="valor-sd">100,00</span></button>
                    <button class="btn-tipo-plantao" data-tipo="sn">Plantão Noturno (<span class="nome-sn">SN</span>) - R$ <span class="valor-sn">100,00</span></button>
                    <button class="btn-tipo-plantao" data-tipo="dn">Plantão Dia/Noite (<span class="nome-dn">DN</span>) - R$ <span class="valor-dn">200,00</span></button>
                    <button class="btn-tipo-plantao" data-tipo="extra-sd">Extra Dia (<span class="nome-extra-sd">Extra SD</span>) - R$ <span class="valor-extra-sd">100,00</span></button>
                    <button class="btn-tipo-plantao" data-tipo="extra-sn">Extra Noite (<span class="nome-extra-sn">Extra SN</span>) - R$ <span class="valor-extra-sn">100,00</span></button>
                    <button class="btn-tipo-plantao" data-tipo="extra-dn">Extra Dia/Noite (<span class="nome-extra-dn">Extra DN</span>) - R$ <span class="valor-extra-dn">200,00</span></button>
                    <button class="btn-tipo-plantao" data-tipo="lefe-sd">Lefe Dia (<span class="nome-lefe-sd">Lefe Dia</span>) - R$ <span class="valor-lefe-sd">100,00</span></button>
                    <button class="btn-tipo-plantao" data-tipo="lefe-sn">Lefe Noite (<span class="nome-lefe-sn">Lefe Noite</span>) - R$ <span class="valor-lefe-sn">100,00</span></button>
                    <button class="btn-tipo-plantao" data-tipo="lefe-dn">Lefe Dia/Noite (<span class="nome-lefe-dn">Lefe DN</span>) - R$ <span class="valor-lefe-dn">250,00</span></button>
                    <button class="btn-tipo-plantao" data-tipo="troca">Troca (sem plantão)</button>
                </div>
            </div>
            
            <div id="gerar-descricao">
                <h3><i class="fas fa-magic"></i> Gerar Descrição Automática</h3>
                <div style="margin: 10px 0;">
                    <div class="descricao-gerada" id="descricao-gerada" style="display: none;">SD 12hs 🙋 Condutor: Anderson 🔁 Troca de plantão: SD 📅 21/09 ➝ SD 📅 30/10</div>
                    <div style="display: flex; gap: 10px; margin-top: 10px;">
                        <button id="btn-gerar-descricao" class="btn-tipo-plantao">
                            <i class="fas fa-magic"></i> Gerar Descrição
                        </button>
                        <button id="btn-copiar-descricao" class="btn-tipo-plantao" style="display: none;">
                            <i class="fas fa-copy"></i> Copiar Descrição
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="modal-buttons">
                <button id="btn-limpar-tudo" style="background-color: #e74c3c;"><i class="fas fa-trash"></i> Limpar Todos os Plantões</button>
                <button id="btn-fechar-plantao"><i class="fas fa-times"></i> Fechar</button>
            </div>
        </div>
    </div>

    <!-- Notificação -->
    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notification-message">Operação realizada com sucesso!</span>
    </div>

<script>
    // Função de depuração
    function debugLog(message) {
        console.log(`[DEBUG] ${message}`);
    }

    // Função para formatar valores monetários
    function formatarMoeda(valor) {
        return valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
    }

    // Função para mostrar notificação
    function showNotification(message, duration = 3000) {
        const notification = document.getElementById('notification');
        const notificationMessage = document.getElementById('notification-message');
        
        notificationMessage.textContent = message;
        notification.classList.add('show');
        
        setTimeout(() => {
            notification.classList.remove('show');
        }, duration);
    }

    // Dados globais
    let calendarioData = {};
    const tiposPlantao = ['sd', 'sn', 'dn', 'extra-sd', 'extra-sn', 'extra-dn', 'troca', 'lefe-sd', 'lefe-sn', 'lefe-dn'];
    let labelsPlantao = {
        'sd': 'SD',
        'sn': 'SN',
        'dn': 'DN',
        'extra-sd': 'Extra SD',
        'extra-sn': 'Extra SN',
        'extra-dn': 'Extra DN',
        'troca': 'Troca',
        'lefe-sd': 'Lefe Dia',
        'lefe-sn': 'Lefe Noite',
        'lefe-dn': 'Lefe DN'
    };
    let valoresPlantao = {
        'sd': 100,
        'sn': 100,
        'dn': 200,
        'extra-sd': 100,
        'extra-sn': 100,
        'extra-dn': 200,
        'troca': 0,
        'lefe-sd': 100,
        'lefe-sn': 100,
        'lefe-dn': 250
    };
    
    // Variáveis para controle do dia selecionado
    let diaSelecionado = null;
    let mesSelecionadoGlobal = null;
    let anoSelecionadoGlobal = null;
    
    // Variáveis para configuração de descrição
    let configDescricao = {
        hospital: 'HRL',
        condutor: 'Anderson',
        modelo: 'troca'
    };
    
    // Data atual
    const dataAtual = new Date();
    const diaAtual = dataAtual.getDate();
    const mesAtual = dataAtual.getMonth();
    const anoAtual = dataAtual.getFullYear();
    
    // Inicialização
    document.addEventListener('DOMContentLoaded', function() {
        debugLog("Iniciando aplicação");
        
        try {
            // Configurar o mês e ano atual
            document.getElementById('mes-selecionado').value = mesAtual;
            document.getElementById('ano-selecionado').value = anoAtual;
            
            // Carregar dados salvos se existirem
            carregarDadosSalvos();
            
            // Carregar cores personalizadas se existirem
            carregarCoresPersonalizadas();
            
            // Carregar valores personalizados se existirem
            carregarValoresPersonalizados();
            
            // Carregar nomes personalizados se existirem
            carregarNomesPersonalizados();
            
            // Carregar configuração de descrição
            carregarConfigDescricao();
            
            // Gerar calendário inicial
            gerarCalendario(mesAtual, anoAtual);
            
            // Configurar event listeners para abas
            configurarAbas();
            
            // Configurar todos os event listeners
            configurarEventListeners();
            
            // Atualizar os valores exibidos nos botões
            atualizarValoresExibidos();
            atualizarNomesExibidos();
            
            debugLog("Aplicação inicializada com sucesso");
        } catch (error) {
            console.error("Erro durante a inicialização:", error);
        }
    });
    
    // Função para configurar as abas
    function configurarAbas() {
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function() {
                // Remover a classe active de todas as abas
                document.querySelectorAll('.tab').forEach(t => {
                    t.classList.remove('active');
                });
                
                // Adicionar a classe active à aba clicada
                this.classList.add('active');
                
                // Esconder todos os conteúdos de abas
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                
                // Mostrar o conteúdo da aba clicada
                const tabId = this.getAttribute('data-tab');
                const tabContent = document.getElementById(`${tabId}-tab`);
                if (tabContent) {
                    tabContent.classList.add('active');
                } else {
                    debugLog(`Aba ${tabId} não encontrada`);
                }
            });
        });
    }
    
    // Função para configurar todos os event listeners
    function configurarEventListeners() {
        // Seletores de mês e ano
        const mesSelecionadoElement = document.getElementById('mes-selecionado');
        const anoSelecionadoElement = document.getElementById('ano-selecionado');
        
        if (mesSelecionadoElement) {
            mesSelecionadoElement.addEventListener('change', function() {
                const mes = parseInt(this.value);
                const ano = parseInt(document.getElementById('ano-selecionado').value);
                gerarCalendario(mes, ano);
            });
        }
        
        if (anoSelecionadoElement) {
            anoSelecionadoElement.addEventListener('change', function() {
                const mes = parseInt(document.getElementById('mes-selecionado').value);
                const ano = parseInt(this.value);
                gerarCalendario(mes, ano);
            });
        }
        
        // Botão flutuante de configuração
        const configButton = document.getElementById('config-button');
        if (configButton) {
            configButton.addEventListener('click', function(e) {
                e.preventDefault();
                const menu = document.getElementById('config-menu');
                if (menu) {
                    menu.style.display = menu.style.display === 'flex' ? 'none' : 'flex';
                }
            });
        }
        
        // Botões do menu flutuante
        const btnExportar = document.getElementById('btn-exportar');
        if (btnExportar) {
            btnExportar.addEventListener('click', exportarDados);
        }
        
        const btnImportar = document.getElementById('btn-importar');
        if (btnImportar) {
            btnImportar.addEventListener('click', importarDados);
        }
        
        const btnCores = document.getElementById('btn-cores');
        if (btnCores) {
            btnCores.addEventListener('click', personalizarCores);
        }
        
        const btnValores = document.getElementById('btn-valores');
        if (btnValores) {
            btnValores.addEventListener('click', personalizarValores);
        }
        
        const btnNomes = document.getElementById('btn-nomes');
        if (btnNomes) {
            btnNomes.addEventListener('click', personalizarNomes);
        }
        
        const btnConfigDescricao = document.getElementById('btn-config-descricao');
        if (btnConfigDescricao) {
            btnConfigDescricao.addEventListener('click', configurarDescricao);
        }
        
        const btnTrocaPlantao = document.getElementById('btn-troca-plantao');
        if (btnTrocaPlantao) {
            btnTrocaPlantao.addEventListener('click', abrirModalTrocaPlantao);
        }
        
        // Botões dos modais
        const btnCopiar = document.getElementById('btn-copiar');
        if (btnCopiar) {
            btnCopiar.addEventListener('click', copiarTexto);
        }
        
        const btnFecharModal = document.getElementById('btn-fechar-modal');
        if (btnFecharModal) {
            btnFecharModal.addEventListener('click', fecharModal);
        }
        
        const btnAplicarDados = document.getElementById('btn-aplicar-dados');
        if (btnAplicarDados) {
            btnAplicarDados.addEventListener('click', aplicarDadosImportados);
        }
        
        // Event listeners para modal de cores
        const btnAplicarCores = document.getElementById('btn-aplicar-cores');
        if (btnAplicarCores) {
            btnAplicarCores.addEventListener('click', aplicarCoresPersonalizadas);
        }
        
        const btnFecharCores = document.getElementById('btn-fechar-cores');
        if (btnFecharCores) {
            btnFecharCores.addEventListener('click', function() {
                document.getElementById('modal-cores').style.display = 'none';
            });
        }
        
        // Event listeners para modal de valores
        const btnAplicarValores = document.getElementById('btn-aplicar-valores');
        if (btnAplicarValores) {
            btnAplicarValores.addEventListener('click', aplicarValoresPersonalizados);
        }
        
        const btnFecharValores = document.getElementById('btn-fechar-valores');
        if (btnFecharValores) {
            btnFecharValores.addEventListener('click', function() {
                document.getElementById('modal-valores').style.display = 'none';
            });
        }
        
        // Event listeners para modal de nomes
        const btnAplicarNomes = document.getElementById('btn-aplicar-nomes');
        if (btnAplicarNomes) {
            btnAplicarNomes.addEventListener('click', aplicarNomesPersonalizados);
        }
        
        const btnFecharNomes = document.getElementById('btn-fechar-nomes');
        if (btnFecharNomes) {
            btnFecharNomes.addEventListener('click', function() {
                document.getElementById('modal-nomes').style.display = 'none';
            });
        }
        
        // Event listeners para modal de configuração de descrição
        const btnAplicarConfigDescricao = document.getElementById('btn-aplicar-config-descricao');
        if (btnAplicarConfigDescricao) {
            btnAplicarConfigDescricao.addEventListener('click', aplicarConfigDescricao);
        }
        
        const btnFecharConfigDescricao = document.getElementById('btn-fechar-config-descricao');
        if (btnFecharConfigDescricao) {
            btnFecharConfigDescricao.addEventListener('click', function() {
                document.getElementById('modal-config-descricao').style.display = 'none';
            });
        }
        
        // Event listeners para os inputs do modal de configuração de descrição
        const hospitalInput = document.getElementById('hospital');
        if (hospitalInput) {
            hospitalInput.addEventListener('input', atualizarExemploDescricao);
        }
        
        const condutorInput = document.getElementById('condutor');
        if (condutorInput) {
            condutorInput.addEventListener('input', atualizarExemploDescricao);
        }
        
        const modeloSelect = document.getElementById('modelo-descricao');
        if (modeloSelect) {
            modeloSelect.addEventListener('change', atualizarExemploDescricao);
        }
        
        // Event listeners para modal de troca de plantão
        const btnExecutarTroca = document.getElementById('btn-executar-troca');
        if (btnExecutarTroca) {
            btnExecutarTroca.addEventListener('click', executarTrocaPlantao);
        }
        
        const btnFecharTroca = document.getElementById('btn-fechar-troca');
        if (btnFecharTroca) {
            btnFecharTroca.addEventListener('click', function() {
                document.getElementById('modal-troca-plantao').style.display = 'none';
            });
        }
        
        // Event listeners para atualizar a preview da descrição da troca
        const diaOriginal = document.getElementById('dia-original');
        if (diaOriginal) {
            diaOriginal.addEventListener('change', atualizarPreviewTroca);
        }
        
        const diaTroca = document.getElementById('dia-troca');
        if (diaTroca) {
            diaTroca.addEventListener('change', atualizarPreviewTroca);
        }
        
        const tipoPlantaoTroca = document.getElementById('tipo-plantao-troca');
        if (tipoPlantaoTroca) {
            tipoPlantaoTroca.addEventListener('change', atualizarPreviewTroca);
        }
        
        // Event listeners para edição de descrição da troca
        const btnEditarDescricaoTroca = document.getElementById('btn-editar-descricao-troca');
        if (btnEditarDescricaoTroca) {
            btnEditarDescricaoTroca.addEventListener('click', entrarModoEdicao);
        }
        
        const btnSalvarEdicaoTroca = document.getElementById('btn-salvar-edicao-troca');
        if (btnSalvarEdicaoTroca) {
            btnSalvarEdicaoTroca.addEventListener('click', function() {
                sairModoEdicao(true); // true = salvar
            });
        }
        
        const btnCancelarEdicaoTroca = document.getElementById('btn-cancelar-edicao-troca');
        if (btnCancelarEdicaoTroca) {
            btnCancelarEdicaoTroca.addEventListener('click', function() {
                sairModoEdicao(false); // false = cancelar
            });
        }
        
        // Botões para gerar e copiar descrição
        const btnGerarDescricao = document.getElementById('btn-gerar-descricao');
        if (btnGerarDescricao) {
            btnGerarDescricao.addEventListener('click', gerarDescricaoPlantao);
        }
        
        const btnCopiarDescricao = document.getElementById('btn-copiar-descricao');
        if (btnCopiarDescricao) {
            btnCopiarDescricao.addEventListener('click', copiarDescricaoGerada);
        }
        
        // Event listeners para botões de cor padrão
        document.querySelectorAll('.btn-cor-padrao').forEach(btn => {
            btn.addEventListener('click', function(e) {
                e.preventDefault();
                const tipo = this.getAttribute('data-tipo');
                const corPadrao = {
                    'sd': '#4BA0FF',
                    'sn': '#D5A755',
                    'dn': '#AC00FF',
                    'extra-sd': '#4BA0FF',
                    'extra-sn': '#D5A755',
                    'extra-dn': '#38B800',
                    'lefe-sd': '#4BA0FF',
                    'lefe-sn': '#D5A755',
                    'lefe-dn': '#FF0100',
                    'troca': '#A9FF00',
                    'hoje': '#ffeb3b'
                }[tipo];
                
                const inputCor = document.getElementById(`cor-${tipo}`);
                if (inputCor) {
                    inputCor.value = corPadrao;
                }
            });
        });
        
        // Botão limpar tudo
        const btnLimparTudo = document.getElementById('btn-limpar-tudo');
        if (btnLimparTudo) {
            btnLimparTudo.addEventListener('click', limparPlantoesDia);
        }
        
        // Botão fechar plantão
        const btnFecharPlantao = document.getElementById('btn-fechar-plantao');
        if (btnFecharPlantao) {
            btnFecharPlantao.addEventListener('click', function() {
                document.getElementById('modal-plantao').style.display = 'none';
            });
        }
        
        // Fechar menu flutuante ao clicar fora dele
        document.addEventListener('click', function(e) {
            const configButton = document.getElementById('config-button');
            const configMenu = document.getElementById('config-menu');
            
            if (configButton && configMenu && !configButton.contains(e.target) && !configMenu.contains(e.target)) {
                configMenu.style.display = 'none';
            }
        });
        
        // Fechar modais ao clicar fora deles
        document.addEventListener('click', function(e) {
            const modais = document.querySelectorAll('.modal');
            modais.forEach(modal => {
                if (e.target === modal) {
                    modal.style.display = 'none';
                }
            });
        });
        
        // Event listeners para botões de adicionar plantão (usando delegação)
        document.addEventListener('click', function(e) {
            // Botões de adicionar plantão
            if (e.target.classList.contains('btn-tipo-plantao') || e.target.closest('.btn-tipo-plantao')) {
                e.preventDefault();
                const btn = e.target.classList.contains('btn-tipo-plantao') ? e.target : e.target.closest('.btn-tipo-plantao');
                const tipo = btn.getAttribute('data-tipo');
                adicionarPlantao(tipo);
            }
            
            // Botões de remover plantão (gerados dinamicamente)
            if (e.target.classList.contains('btn-remover-plantao') || e.target.closest('.btn-remover-plantao')) {
                e.preventDefault();
                const btn = e.target.classList.contains('btn-remover-plantao') ? e.target : e.target.closest('.btn-remover-plantao');
                const index = parseInt(btn.getAttribute('data-index'));
                removerPlantao(index);
            }
            
            // Botão para salvar legendas
            if (e.target.id === 'btn-salvar-legendas' || e.target.closest('#btn-salvar-legendas')) {
                e.preventDefault();
                
                // Salva os dados (que já são salvos automaticamente, mas para garantir)
                salvarDados();
                
                // Exibe notificação de sucesso
                showNotification("Legendas salvas com sucesso!");
                
                // Atualiza o calendário para refletir as alterações
                gerarCalendario(mesSelecionadoGlobal, anoSelecionadoGlobal);
            }
        });
        
        // Event listener para campos de legenda (usando delegação)
        document.addEventListener('input', function(e) {
            if (e.target.classList.contains('plantao-legenda')) {
                const index = parseInt(e.target.getAttribute('data-index'));
                const chave = `${mesSelecionadoGlobal}-${anoSelecionadoGlobal}`;
                
                // Garantir que o array de legendas exista
                if (!calendarioData[chave][diaSelecionado].legendas) {
                    calendarioData[chave][diaSelecionado].legendas = [];
                }
                
                // Garantir que o array tenha o tamanho correto
                while (calendarioData[chave][diaSelecionado].legendas.length <= index) {
                    calendarioData[chave][diaSelecionado].legendas.push('');
                }
                
                calendarioData[chave][diaSelecionado].legendas[index] = e.target.value;
                salvarDados();
                gerarCalendario(mesSelecionadoGlobal, anoSelecionadoGlobal);
            }
        });
    }
    
    // Função para gerar o calendário
    function gerarCalendario(mes, ano) {
        debugLog(`Gerando calendário para ${mes}/${ano}`);
        mesSelecionadoGlobal = mes;
        anoSelecionadoGlobal = ano;
        
        const sectionCalendario = document.getElementById('calendario-mes');
        if (!sectionCalendario) {
            console.error("Elemento calendario-mes não encontrado!");
            return;
        }
        
        const primeiroDia = new Date(ano, mes, 1);
        const ultimoDia = new Date(ano, mes + 1, 0);
        const diasNoMes = ultimoDia.getDate();
        const primeiroDiaSemana = primeiroDia.getDay();
        
        const nomesMeses = [
            "Janeiro", "Fevereiro", "Março", "Abril", "Maio", "Junho",
            "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"
        ];
        
        // Inicializar a chave para este mês/ano se não existir
        const chaveMes = `${mes}-${ano}`;
        if (!calendarioData[chaveMes]) {
            calendarioData[chaveMes] = {};
            debugLog(`Criando nova entrada para ${chaveMes}`);
        }
        
        debugLog(`Dados para ${chaveMes}: ${JSON.stringify(calendarioData[chaveMes])}`);
        
        let tabelaHTML = `
            <div class="calendario-container">
                <table class="calendario">
                    <caption>${nomesMeses[mes]} ${ano}</caption>
                    <thead>
                        <tr>
                            <th>DOM</th>
                            <th>SEG</th>
                            <th>TER</th>
                            <th>QUA</th>
                            <th>QUI</th>
                            <th>SEX</th>
                            <th>SÁB</th>
                        </tr>
                    </thead>
                    <tbody>`;
        
        let dia = 1;
        
        // Gerar as semanas
        for (let i = 0; i < 6; i++) {
            if (dia > diasNoMes) break;
            
            tabelaHTML += '<tr>';
            
            for (let j = 0; j < 7; j++) {
                if ((i === 0 && j < primeiroDiaSemana) || dia > diasNoMes) {
                    tabelaHTML += '<td class="other-month"></td>';
                } else {
                    const diaInfo = calendarioData[chaveMes][dia] || { tipo: [], legendas: [] };
                    const tipos = diaInfo.tipo || [];
                    const legendas = diaInfo.legendas || [];
                    
                    debugLog(`Processando dia ${dia}: tipos=${JSON.stringify(tipos)}, legendas=${JSON.stringify(legendas)}`);
                    
                    const isToday = (dia === diaAtual && mes === mesAtual && ano === anoAtual);
                    const todayClass = isToday ? ' today' : '';
                    
                    tabelaHTML += `
                        <td data-dia="${dia}" data-mes="${mes}" data-ano="${ano}" class="${todayClass}">
                            <div class="day-number">${dia}</div>`;
                    
                    // Adicionar os plantões do dia
                    tipos.forEach((tipo, index) => {
                        if (tipo >= 0 && tipo < tiposPlantao.length) {
                            const classe = tiposPlantao[tipo];
                            const label = labelsPlantao[tiposPlantao[tipo]];
                            const legenda = (legendas && legendas[index]) ? ` - ${legendas[index]}` : '';
                            tabelaHTML += `<span class="plantao-info ${classe}">${label}${legenda}</span>`;
                            debugLog(`Adicionando plantão: tipo=${tipo}, classe=${classe}, label=${label}, legenda=${legenda}`);
                        }
                    });
                    
                    tabelaHTML += `</td>`;
                    dia++;
                }
            }
            
            tabelaHTML += '</tr>';
        }
        
        tabelaHTML += `
                    </tbody>
                </table>
            </div>`;
        
        // Adicionar seção de legendas personalizadas
        tabelaHTML += `<div class="calendario-legendas" id="calendario-legendas">
            <h3><i class="fas fa-sticky-note"></i> Legendas Personalizadas do Mês</h3>
            <div class="legendas-lista" id="legendas-lista"></div>
        </div>`;
        
        sectionCalendario.innerHTML = tabelaHTML;
        debugLog("Calendário gerado com sucesso");
        
        // Adicionar event listeners para os dias
        const diasCalendario = sectionCalendario.querySelectorAll('td[data-dia]');
        diasCalendario.forEach(celula => {
            celula.addEventListener('click', function() {
                const dia = parseInt(this.getAttribute('data-dia'));
                const mes = parseInt(this.getAttribute('data-mes'));
                const ano = parseInt(this.getAttribute('data-ano'));
                debugLog(`Clique no dia ${dia}/${mes+1}/${ano}`);
                abrirModalPlantao(dia, mes, ano);
            });
            
            celula.addEventListener('contextmenu', function(e) {
                e.preventDefault();
                const dia = parseInt(this.getAttribute('data-dia'));
                const mes = parseInt(this.getAttribute('data-mes'));
                const ano = parseInt(this.getAttribute('data-ano'));
                debugLog(`Clique direito no dia ${dia}/${mes+1}/${ano}`);
                
                const chave = `${mes}-${ano}`;
                if (calendarioData[chave] && calendarioData[chave][dia]) {
                    calendarioData[chave][dia].tipo = [];
                    calendarioData[chave][dia].legendas = [];
                    salvarDados();
                    gerarCalendario(mes, ano);
                    calcularTotais(mes, ano);
                    showNotification("Plantões do dia removidos com sucesso!");
                }
            });
        });
        
        // Atualizar resumo
        const resumoH2 = document.querySelector('#resumo h2');
        if (resumoH2) {
            resumoH2.textContent = `Resumo e Cálculo do Mês (${nomesMeses[mes]} ${ano})`;
        }
        calcularTotais(mes, ano);
        
        // Gerar lista de legendas personalizadas
        gerarListaLegendas(mes, ano);
        
        // Aplicar cores personalizadas
        aplicarCoresCSS();
    }
    
    // Função para gerar a lista de legendas personalizadas
    function gerarListaLegendas(mes, ano) {
        const legendasLista = document.getElementById('legendas-lista');
        if (!legendasLista) {
            debugLog("Elemento legendas-lista não encontrado");
            return;
        }
        
        const chaveMes = `${mes}-${ano}`;
        const dadosMes = calendarioData[chaveMes] || {};
        
        let legendasHTML = '';
        let temLegendas = false;
        
        // Iterar sobre todos os dias do mês
        for (let dia = 1; dia <= 31; dia++) {
            if (dadosMes[dia]) {
                const diaInfo = dadosMes[dia];
                const tipos = diaInfo.tipo || [];
                const legendas = diaInfo.legendas || [];
                
                // Verificar se há legendas personalizadas neste dia
                tipos.forEach((tipo, index) => {
                    if (tipo >= 0 && tipo < tiposPlantao.length && legendas[index] && legendas[index].trim() !== '') {
                        temLegendas = true;
                        const tipoNome = labelsPlantao[tiposPlantao[tipo]];
                        const legendaTexto = legendas[index];
                        
                        legendasHTML += `
                            <div class="legenda-item-calendario">
                                <div class="legenda-dia">${dia}</div>
                                <div class="legenda-conteudo">
                                    <div class="legenda-tipo ${tiposPlantao[tipo]}">${tipoNome}</div>
                                    <div class="legenda-texto">${legendaTexto}</div>
                                </div>
                            </div>
                        `;
                    }
                });
            }
        }
        
        if (temLegendas) {
            legendasLista.innerHTML = legendasHTML;
        } else {
            legendasLista.innerHTML = '<div class="sem-legendas">Nenhuma legenda personalizada cadastrada neste mês.</div>';
        }
    }
    
    // Função para abrir modal de plantão
    function abrirModalPlantao(dia, mes, ano) {
        debugLog(`Abrindo modal para o dia ${dia}/${mes+1}/${ano}`);
        diaSelecionado = dia;
        mesSelecionadoGlobal = mes;
        anoSelecionadoGlobal = ano;
        
        const diaSelecionadoElement = document.getElementById('dia-selecionado');
        if (diaSelecionadoElement) {
            diaSelecionadoElement.textContent = `${dia}/${mes + 1}/${ano}`;
        }
        
        // Preencher a lista de plantões existentes
        const listaPlantoes = document.getElementById('lista-plantoes');
        if (!listaPlantoes) {
            debugLog("Elemento lista-plantoes não encontrado");
            return;
        }
        
        listaPlantoes.innerHTML = '';
        
        const chave = `${mes}-${ano}`;
        const diaInfo = calendarioData[chave] && calendarioData[chave][dia];
        const tipos = diaInfo ? diaInfo.tipo : [];
        const legendas = diaInfo && diaInfo.legendas ? diaInfo.legendas : [];
        
        if (tipos.length > 0) {
            tipos.forEach((tipoIndex, index) => {
                if (tipoIndex >= 0 && tipoIndex < tiposPlantao.length) {
                    const tipo = tiposPlantao[tipoIndex];
                    const label = labelsPlantao[tipo];
                    const legenda = (legendas && legendas[index]) ? legendas[index] : '';
                    
                    const plantaoItem = document.createElement('div');
                    plantaoItem.className = 'plantao-item';
                    plantaoItem.innerHTML = `
                        <div class="plantao-item-header">
                            <span>${label}</span>
                            <button class="btn-remover-plantao" data-index="${index}"><i class="fas fa-trash"></i> Remover</button>
                        </div>
                        <input type="text" class="plantao-legenda" data-index="${index}" value="${legenda}" placeholder="Adicionar legenda personalizada...">
                    `;
                    listaPlantoes.appendChild(plantaoItem);
                }
            });
        } else {
            listaPlantoes.innerHTML = '<p>Nenhum plantão cadastrado para este dia.</p>';
        }
        
        // Esconder a descrição gerada anteriormente
        const descricaoGerada = document.getElementById('descricao-gerada');
        if (descricaoGerada) {
            descricaoGerada.style.display = 'none';
        }
        
        const btnCopiarDescricao = document.getElementById('btn-copiar-descricao');
        if (btnCopiarDescricao) {
            btnCopiarDescricao.style.display = 'none';
        }
        
        const modalPlantao = document.getElementById('modal-plantao');
        if (modalPlantao) {
            modalPlantao.style.display = 'flex';
        }
    }
    
    // Função para adicionar plantão
    function adicionarPlantao(tipo) {
        if (diaSelecionado === null) {
            debugLog("Nenhum dia selecionado");
            return;
        }
        
        debugLog(`Adicionando plantão do tipo ${tipo}`);
        const chave = `${mesSelecionadoGlobal}-${anoSelecionadoGlobal}`;
        const tipoIndex = tiposPlantao.indexOf(tipo);
        
        if (tipoIndex === -1) {
            debugLog(`Tipo de plantão inválido: ${tipo}`);
            return;
        }
        
        if (!calendarioData[chave]) {
            calendarioData[chave] = {};
        }
        
        if (!calendarioData[chave][diaSelecionado]) {
            calendarioData[chave][diaSelecionado] = { tipo: [], legendas: [] };
        }
        
        // Garantir que o array de legendas exista e tenha o mesmo tamanho que o array de tipos
        if (!calendarioData[chave][diaSelecionado].legendas) {
            calendarioData[chave][diaSelecionado].legendas = [];
        }
        
        // Adicionar o tipo se não existir
        if (!calendarioData[chave][diaSelecionado].tipo.includes(tipoIndex)) {
            calendarioData[chave][diaSelecionado].tipo.push(tipoIndex);
            calendarioData[chave][diaSelecionado].legendas.push(''); // Legenda vazia inicialmente
            salvarDados();
            gerarCalendario(mesSelecionadoGlobal, anoSelecionadoGlobal);
            calcularTotais(mesSelecionadoGlobal, anoSelecionadoGlobal);
            
            const modalPlantao = document.getElementById('modal-plantao');
            if (modalPlantao) {
                modalPlantao.style.display = 'none';
            }
            
            showNotification(`Plantão ${labelsPlantao[tipo]} adicionado com sucesso!`);
        } else {
            debugLog(`Plantão do tipo ${tipo} já existe neste dia`);
            showNotification(`Este plantão já está cadastrado para este dia!`, 4000);
        }
    }
    
    // Função para remover um plantão específico
    function removerPlantao(index) {
        if (diaSelecionado === null) return;
        
        const chave = `${mesSelecionadoGlobal}-${anoSelecionadoGlobal}`;
        if (calendarioData[chave] && calendarioData[chave][diaSelecionado]) {
            const tipoRemovido = calendarioData[chave][diaSelecionado].tipo[index];
            calendarioData[chave][diaSelecionado].tipo.splice(index, 1);
            
            // Remover legenda correspondente se existir
            if (calendarioData[chave][diaSelecionado].legendas) {
                calendarioData[chave][diaSelecionado].legendas.splice(index, 1);
            }
            
            salvarDados();
            
            // Atualizar a lista de plantões no modal
            abrirModalPlantao(diaSelecionado, mesSelecionadoGlobal, anoSelecionadoGlobal);
            
            // Atualizar o calendário and totais
            gerarCalendario(mesSelecionadoGlobal, anoSelecionadoGlobal);
            calcularTotais(mesSelecionadoGlobal, anoSelecionadoGlobal);
            
            showNotification(`Plantão ${labelsPlantao[tiposPlantao[tipoRemovido]]} removido com sucesso!`);
        }
    }
    
    // Função para limpar todos os plantões de um dia
    function limparPlantoesDia() {
        if (diaSelecionado === null) return;
        
        const chave = `${mesSelecionadoGlobal}-${anoSelecionadoGlobal}`;
        if (calendarioData[chave] && calendarioData[chave][diaSelecionado]) {
            calendarioData[chave][diaSelecionado].tipo = [];
            calendarioData[chave][diaSelecionado].legendas = [];
            salvarDados();
            gerarCalendario(mesSelecionadoGlobal, anoSelecionadoGlobal);
            calcularTotais(mesSelecionadoGlobal, anoSelecionadoGlobal);
            
            const modalPlantao = document.getElementById('modal-plantao');
            if (modalPlantao) {
                modalPlantao.style.display = 'none';
            }
            
            showNotification("Todos os plantões do dia foram removidos!");
        }
    }
    
    // Função para calcular o total acumulado dos meses passados
    function calcularTotalAcumulado() {
        const mesAtual = new Date().getMonth();
        const anoAtual = new Date().getFullYear();
        let totalAcumulado = 0;
        
        // Iterar sobre todos os meses do ano atual até o mês anterior ao atual
        for (let mes = 0; mes < mesAtual; mes++) {
            const chaveMes = `${mes}-${anoAtual}`;
            const dadosMes = calendarioData[chaveMes] || {};
            
            // Contadores para este mês
            let countSD = 0;
            let countSN = 0;
            let countDN = 0;
            let countExtraSD = 0;
            let countExtraSN = 0;
            let countExtraDN = 0;
            let countLefeSD = 0;
            let countLefeSN = 0;
            let countLefeDN = 0;
            
            // Contar plantões deste mês
            Object.keys(dadosMes).forEach(dia => {
                const tipos = dadosMes[dia].tipo || [];
                
                tipos.forEach(tipo => {
                    if (tipo === 0) countSD++;           
                    else if (tipo === 1) countSN++;      
                    else if (tipo === 2) countDN++;      
                    else if (tipo === 3) countExtraSD++; 
                    else if (tipo === 4) countExtraSN++; 
                    else if (tipo === 5) countExtraDN++; 
                    else if (tipo === 7) countLefeSD++;  
                    else if (tipo === 8) countLefeSN++;  
                    else if (tipo === 9) countLefeDN++;  
                });
            });
            
            // Calcula valores deste mês
            const valorSD = countSD * valoresPlantao.sd;
            const valorSN = countSN * valoresPlantao.sn;
            const valorDN = countDN * valoresPlantao.dn;
            const valorExtraSD = countExtraSD * valoresPlantao['extra-sd'];
            const valorExtraSN = countExtraSN * valoresPlantao['extra-sn'];
            const valorExtraDN = countExtraDN * valoresPlantao['extra-dn'];
            const valorLefeSD = countLefeSD * valoresPlantao['lefe-sd'];
            const valorLefeSN = countLefeSN * valoresPlantao['lefe-sn'];
            const valorLefeDN = countLefeDN * valoresPlantao['lefe-dn'];
            
            // Adiciona ao total acumulado
            totalAcumulado += valorSD + valorSN + valorDN + valorExtraSD + valorExtraSN + valorExtraDN + valorLefeSD + valorLefeSN + valorLefeDN;
        }
        
        return totalAcumulado;
    }
    
    // Função para calcular totais
    function calcularTotais(mes, ano) {
        debugLog(`Calculando totais para ${mes}/${ano}`);
        const chaveMes = `${mes}-${ano}`;
        const dadosMes = calendarioData[chaveMes] || {};
        
        // Contadores
        let countSD = 0;
        let countSN = 0;
        let countDN = 0;
        let countExtraSD = 0;
        let countExtraSN = 0;
        let countExtraDN = 0;
        let countLefeSD = 0;
        let countLefeSN = 0;
        let countLefeDN = 0;
        
        // Contar plantões
        Object.keys(dadosMes).forEach(dia => {
            const tipos = dadosMes[dia].tipo || [];
            
            tipos.forEach(tipo => {
                if (tipo === 0) countSD++;           
                else if (tipo === 1) countSN++;      
                else if (tipo === 2) countDN++;      
                else if (tipo === 3) countExtraSD++; 
                else if (tipo === 4) countExtraSN++; 
                else if (tipo === 5) countExtraDN++; 
                else if (tipo === 7) countLefeSD++;  
                else if (tipo === 8) countLefeSN++;  
                else if (tipo === 9) countLefeDN++;  
            });
        });
        
        // Calcula valores
        const valorSD = countSD * valoresPlantao.sd;
        const valorSN = countSN * valoresPlantao.sn;
        const valorDN = countDN * valoresPlantao.dn;
        const valorExtraSD = countExtraSD * valoresPlantao['extra-sd'];
        const valorExtraSN = countExtraSN * valoresPlantao['extra-sn'];
        const valorExtraDN = countExtraDN * valoresPlantao['extra-dn'];
        const valorLefeSD = countLefeSD * valoresPlantao['lefe-sd'];
        const valorLefeSN = countLefeSN * valoresPlantao['lefe-sn'];
        const valorLefeDN = countLefeDN * valoresPlantao['lefe-dn'];
        const totalGeral = valorSD + valorSN + valorDN + valorExtraSD + valorExtraSN + valorExtraDN + valorLefeSD + valorLefeSN + valorLefeDN;
        
        // Atualiza o HTML do resumo
        const totalSdElement = document.getElementById('total-sd');
        if (totalSdElement) {
            totalSdElement.innerHTML = 
                `<strong>Total:</strong> ${countSD} &nbsp; (${countSD} x ${formatarMoeda(valoresPlantao.sd)} = <strong>${formatarMoeda(valorSD)}</strong>)`;
        }
        
        const totalSnElement = document.getElementById('total-sn');
        if (totalSnElement) {
            totalSnElement.innerHTML = 
                `<strong>Total:</strong> ${countSN} &nbsp; (${countSN} x ${formatarMoeda(valoresPlantao.sn)} = <strong>${formatarMoeda(valorSN)}</strong>)`;
        }
        
        const totalDnElement = document.getElementById('total-dn');
        if (totalDnElement) {
            totalDnElement.innerHTML = 
                `<strong>Total:</strong> ${countDN} &nbsp; (${countDN} x ${formatarMoeda(valoresPlantao.dn)} = <strong>${formatarMoeda(valorDN)}</strong>)`;
        }
        
        const totalExtraSdElement = document.getElementById('total-extra-sd');
        if (totalExtraSdElement) {
            totalExtraSdElement.innerHTML = 
                `<strong>Total:</strong> ${countExtraSD} &nbsp; (${countExtraSD} x ${formatarMoeda(valoresPlantao['extra-sd'])} = <strong>${formatarMoeda(valorExtraSD)}</strong>)`;
        }
        
        const totalExtraSnElement = document.getElementById('total-extra-sn');
        if (totalExtraSnElement) {
            totalExtraSnElement.innerHTML = 
                `<strong>Total:</strong> ${countExtraSN} &nbsp; (${countExtraSN} x ${formatarMoeda(valoresPlantao['extra-sn'])} = <strong>${formatarMoeda(valorExtraSN)}</strong>)`;
        }
        
        const totalExtraDnElement = document.getElementById('total-extra-dn');
        if (totalExtraDnElement) {
            totalExtraDnElement.innerHTML = 
                `<strong>Total:</strong> ${countExtraDN} &nbsp; (${countExtraDN} x ${formatarMoeda(valoresPlantao['extra-dn'])} = <strong>${formatarMoeda(valorExtraDN)}</strong>)`;
        }
        
        const totalLefeSdElement = document.getElementById('total-lefe-sd');
        if (totalLefeSdElement) {
            totalLefeSdElement.innerHTML = 
                `<strong>Total:</strong> ${countLefeSD} &nbsp; (${countLefeSD} x ${formatarMoeda(valoresPlantao['lefe-sd'])} = <strong>${formatarMoeda(valorLefeSD)}</strong>)`;
        }
        
        const totalLefeSnElement = document.getElementById('total-lefe-sn');
        if (totalLefeSnElement) {
            totalLefeSnElement.innerHTML = 
                `<strong>Total:</strong> ${countLefeSN} &nbsp; (${countLefeSN} x ${formatarMoeda(valoresPlantao['lefe-sn'])} = <strong>${formatarMoeda(valorLefeSN)}</strong>)`;
        }
        
        const totalLefeDnElement = document.getElementById('total-lefe-dn');
        if (totalLefeDnElement) {
            totalLefeDnElement.innerHTML = 
                `<strong>Total:</strong> ${countLefeDN} &nbsp; (${countLefeDN} x ${formatarMoeda(valoresPlantao['lefe-dn'])} = <strong>${formatarMoeda(valorLefeDN)}</strong>)`;
        }
        
        // Atualizar o elemento HTML com o total do mês
        const totalGeralElement = document.getElementById('total-geral');
        if (totalGeralElement) {
            const nomesMeses = [
                "Janeiro", "Fevereiro", "Março", "Abril", "Maio", "Junho",
                "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"
            ];
            totalGeralElement.innerHTML = 
                `<i class="fas fa-money-bill-wave"></i> Valor Total a Receber (${nomesMeses[mes]} ${ano}): ${formatarMoeda(totalGeral)}`;
        }
        
        // Calcular e atualizar o total acumulado
        const totalAcumulado = calcularTotalAcumulado();
        const totalAcumuladoElement = document.getElementById('total-acumulado');
        if (totalAcumuladoElement) {
            const nomesMeses = [
                "Janeiro", "Fevereiro", "Março", "Abril", "Maio", "Junho",
                "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"
            ];
            const mesAnterior = mesAtual > 0 ? mesAtual - 1 : 11; // Se for janeiro, o anterior é dezembro
            const anoAnterior = mesAtual > 0 ? anoAtual : anoAtual - 1;
            
            totalAcumuladoElement.innerHTML = 
                `<i class="fas fa-chart-line"></i> Valor Total Acumulado (até ${nomesMeses[mesAnterior]} ${anoAnterior}): ${formatarMoeda(totalAcumulado)}`;
        }
        
        debugLog("Totais calculados com sucesso");
    }
    
    // Funções para salvar e carregar dados
    function salvarDados() {
        try {
            const dadosCompletos = {
                calendario: calendarioData,
                valores: valoresPlantao,
                nomes: labelsPlantao
            };
            localStorage.setItem('calendarioPlantao', JSON.stringify(dadosCompletos));
            debugLog("Dados salvos com sucesso");
            debugLog("Dados salvos: " + JSON.stringify(dadosCompletos, null, 2));
        } catch (error) {
            console.error("Erro ao salvar dados:", error);
            debugLog("Erro ao salvar dados: " + error.message);
        }
    }
    
    function carregarDadosSalvos() {
        try {
            const dados = localStorage.getItem('calendarioPlantao');
            if (dados) {
                const dadosCompletos = JSON.parse(dados);
                calendarioData = dadosCompletos.calendario || {};
                
                debugLog("Dados carregados: " + JSON.stringify(dadosCompletos, null, 2));
                
                // Garantir que cada entrada tenha o campo legendas
                Object.keys(calendarioData).forEach(chave => {
                    Object.keys(calendarioData[chave]).forEach(dia => {
                        if (!calendarioData[chave][dia].legendas) {
                            calendarioData[chave][dia].legendas = [];
                        }
                        // Garantir que o array de legendas tenha o mesmo tamanho que o array de tipos
                        if (calendarioData[chave][dia].tipo) {
                            while (calendarioData[chave][dia].legendas.length < calendarioData[chave][dia].tipo.length) {
                                calendarioData[chave][dia].legendas.push('');
                            }
                        }
                    });
                });
                
                if (dadosCompletos.valores) {
                    valoresPlantao = dadosCompletos.valores;
                }
                
                if (dadosCompletos.nomes) {
                    labelsPlantao = dadosCompletos.nomes;
                }
                debugLog("Dados carregados com sucesso");
            } else {
                debugLog("Nenhum dado encontrado no localStorage");
            }
        } catch (error) {
            console.error("Erro ao carregar dados:", error);
            debugLog("Erro ao carregar dados: " + error.message);
        }
    }
    
    // Funções para personalizar cores
    function personalizarCores() {
        // Preencher os valores atuais
        const corSd = document.getElementById('cor-sd');
        if (corSd) corSd.value = getComputedStyle(document.documentElement).getPropertyValue('--sd-color').trim();
        
        const corSn = document.getElementById('cor-sn');
        if (corSn) corSn.value = getComputedStyle(document.documentElement).getPropertyValue('--sn-color').trim();
        
        const corDn = document.getElementById('cor-dn');
        if (corDn) corDn.value = getComputedStyle(document.documentElement).getPropertyValue('--dn-color').trim();
        
        const corExtraSd = document.getElementById('cor-extra-sd');
        if (corExtraSd) corExtraSd.value = getComputedStyle(document.documentElement).getPropertyValue('--extra-sd-color').trim();
        
        const corExtraSn = document.getElementById('cor-extra-sn');
        if (corExtraSn) corExtraSn.value = getComputedStyle(document.documentElement).getPropertyValue('--extra-sn-color').trim();
        
        const corExtraDn = document.getElementById('cor-extra-dn');
        if (corExtraDn) corExtraDn.value = getComputedStyle(document.documentElement).getPropertyValue('--extra-dn-color').trim();
        
        const corLefeSd = document.getElementById('cor-lefe-sd');
        if (corLefeSd) corLefeSd.value = getComputedStyle(document.documentElement).getPropertyValue('--lefe-sd-color').trim();
        
        const corLefeSn = document.getElementById('cor-lefe-sn');
        if (corLefeSn) corLefeSn.value = getComputedStyle(document.documentElement).getPropertyValue('--lefe-sn-color').trim();
        
        const corLefeDn = document.getElementById('cor-lefe-dn');
        if (corLefeDn) corLefeDn.value = getComputedStyle(document.documentElement).getPropertyValue('--lefe-dn-color').trim();
        
        const cortroca = document.getElementById('cor-troca');
        if (cortroca) cortroca.value = getComputedStyle(document.documentElement).getPropertyValue('--troca-color').trim();
        
        const corHoje = document.getElementById('cor-hoje');
        if (corHoje) corHoje.value = getComputedStyle(document.documentElement).getPropertyValue('--today-color').trim();
        
        const modalCores = document.getElementById('modal-cores');
        if (modalCores) {
            modalCores.style.display = 'flex';
        }
    }
    
    function aplicarCoresPersonalizadas() {
        const corSD = document.getElementById('cor-sd')?.value;
        const corSN = document.getElementById('cor-sn')?.value;
        const corDN = document.getElementById('cor-dn')?.value;
        const corExtraSD = document.getElementById('cor-extra-sd')?.value;
        const corExtraSN = document.getElementById('cor-extra-sn')?.value;
        const corExtraDN = document.getElementById('cor-extra-dn')?.value;
        const corLefeSD = document.getElementById('cor-lefe-sd')?.value;
        const corLefeSN = document.getElementById('cor-lefe-sn')?.value;
        const corLefeDN = document.getElementById('cor-lefe-dn')?.value;
        const cortroca = document.getElementById('cor-troca')?.value;
        const corHoje = document.getElementById('cor-hoje')?.value;
        
        // Salvar cores no localStorage
        try {
            localStorage.setItem('coresPlantao', JSON.stringify({
                sd: corSD,
                sn: corSN,
                dn: corDN,
                'extra-sd': corExtraSD,
                'extra-sn': corExtraSN,
                'extra-dn': corExtraDN,
                'lefe-sd': corLefeSD,
                'lefe-sn': corLefeSN,
                'lefe-dn': corLefeDN,
                troca: cortroca,
                hoje: corHoje
            }));
            debugLog("Cores salvas com sucesso");
        } catch (error) {
            console.error("Erro ao salvar cores:", error);
        }
        
        // Aplicar cores
        aplicarCoresCSS();
        
        const modalCores = document.getElementById('modal-cores');
        if (modalCores) {
            modalCores.style.display = 'none';
        }
        
        showNotification("Cores personalizadas aplicadas com sucesso!");
    }
    
    function carregarCoresPersonalizadas() {
        try {
            const coresSalvas = localStorage.getItem('coresPlantao');
            if (coresSalvas) {
                const cores = JSON.parse(coresSalvas);
                if (cores.sd) document.documentElement.style.setProperty('--sd-color', cores.sd);
                if (cores.sn) document.documentElement.style.setProperty('--sn-color', cores.sn);
                if (cores.dn) document.documentElement.style.setProperty('--dn-color', cores.dn);
                if (cores['extra-sd']) document.documentElement.style.setProperty('--extra-sd-color', cores['extra-sd']);
                if (cores['extra-sn']) document.documentElement.style.setProperty('--extra-sn-color', cores['extra-sn']);
                if (cores['extra-dn']) document.documentElement.style.setProperty('--extra-dn-color', cores['extra-dn']);
                if (cores['lefe-sd']) document.documentElement.style.setProperty('--lefe-sd-color', cores['lefe-sd']);
                if (cores['lefe-sn']) document.documentElement.style.setProperty('--lefe-sn-color', cores['lefe-sn']);
                if (cores['lefe-dn']) document.documentElement.style.setProperty('--lefe-dn-color', cores['lefe-dn']);
                if (cores.troca) document.documentElement.style.setProperty('--troca-color', cores.troca);
                if (cores.hoje) document.documentElement.style.setProperty('--today-color', cores.hoje);
                debugLog("Cores carregadas com sucesso");
            }
        } catch (error) {
            console.error("Erro ao carregar cores:", error);
        }
    }
    
    function aplicarCoresCSS() {
        debugLog("Aplicando cores CSS");
        
        // Verificar se as cores estão definidas
        const corSD = getComputedStyle(document.documentElement).getPropertyValue('--sd-color').trim();
        const corSN = getComputedStyle(document.documentElement).getPropertyValue('--sn-color').trim();
        const corDN = getComputedStyle(document.documentElement).getPropertyValue('--dn-color').trim();
        const corExtraSD = getComputedStyle(document.documentElement).getPropertyValue('--extra-sd-color').trim();
        const corExtraSN = getComputedStyle(document.documentElement).getPropertyValue('--extra-sn-color').trim();
        const corExtraDN = getComputedStyle(document.documentElement).getPropertyValue('--extra-dn-color').trim();
        const corLefeSD = getComputedStyle(document.documentElement).getPropertyValue('--lefe-sd-color').trim();
        const corLefeSN = getComputedStyle(document.documentElement).getPropertyValue('--lefe-sn-color').trim();
        const corLefeDN = getComputedStyle(document.documentElement).getPropertyValue('--lefe-dn-color').trim();
        const cortroca = getComputedStyle(document.documentElement).getPropertyValue('--troca-color').trim();
        const corHoje = getComputedStyle(document.documentElement).getPropertyValue('--today-color').trim();
        
        debugLog(`Cor SD: ${corSD}`);
        debugLog(`Cor SN: ${corSN}`);
        debugLog(`Cor DN: ${corDN}`);
        debugLog(`Cor Extra SD: ${corExtraSD}`);
        debugLog(`Cor Extra SN: ${corExtraSN}`);
        debugLog(`Cor Extra DN: ${corExtraDN}`);
        debugLog(`Cor Lefe SD: ${corLefeSD}`);
        debugLog(`Cor Lefe SN: ${corLefeSN}`);
        debugLog(`Cor Lefe DN: ${corLefeDN}`);
        debugLog(`Cor Troca: ${cortroca}`);
        debugLog(`Cor Hoje: ${corHoje}`);
        
        // Aplicar as cores CSS personalizadas a todos os elementos
        const styles = `
            .sd, .legenda .sd-bg { background-color: var(--sd-color) !important; }
            .sn, .legenda .sn-bg { background-color: var(--sn-color) !important; }
            .dn, .legenda .dn-bg { background-color: var(--dn-color) !important; }
            .extra-sd, .legenda .extra-sd-bg { background-color: var(--extra-sd-color) !important; }
            .extra-sn, .legenda .extra-sn-bg { background-color: var(--extra-sn-color) !important; }
            .extra-dn, .legenda .extra-dn-bg { background-color: var(--extra-dn-color) !important; }
            .lefe-sd, .legenda .lefe-sd-bg { background-color: var(--lefe-sd-color) !important; }
            .lefe-sn, .legenda .lefe-sn-bg { background-color: var(--lefe-sn-color) !important; }
            .lefe-dn, .legenda .lefe-dn-bg { background-color: var(--lefe-dn-color) !important; }
            .troca, .legenda .troca-bg { background-color: var(--troca-color) !important; }
            .today { background-color: var(--today-color) !important; color: var(--today-text-color) !important; }
        `;
        
        let styleSheet = document.getElementById('dynamic-styles');
        if (!styleSheet) {
            styleSheet = document.createElement('style');
            styleSheet.id = 'dynamic-styles';
            document.head.appendChild(styleSheet);
        }
        styleSheet.textContent = styles;
        
        debugLog("Cores CSS aplicadas");
    }
    
    // Funções para personalizar valores
    function personalizarValores() {
        // Preencher os valores atuais
        const valorSd = document.getElementById('valor-sd');
        if (valorSd) valorSd.value = valoresPlantao.sd;
        
        const valorSn = document.getElementById('valor-sn');
        if (valorSn) valorSn.value = valoresPlantao.sn;
        
        const valorDn = document.getElementById('valor-dn');
        if (valorDn) valorDn.value = valoresPlantao.dn;
        
        const valorExtraSd = document.getElementById('valor-extra-sd');
        if (valorExtraSd) valorExtraSd.value = valoresPlantao['extra-sd'];
        
        const valorExtraSn = document.getElementById('valor-extra-sn');
        if (valorExtraSn) valorExtraSn.value = valoresPlantao['extra-sn'];
        
        const valorExtraDn = document.getElementById('valor-extra-dn');
        if (valorExtraDn) valorExtraDn.value = valoresPlantao['extra-dn'];
        
        const valorLefeSd = document.getElementById('valor-lefe-sd');
        if (valorLefeSd) valorLefeSd.value = valoresPlantao['lefe-sd'];
        
        const valorLefeSn = document.getElementById('valor-lefe-sn');
        if (valorLefeSn) valorLefeSn.value = valoresPlantao['lefe-sn'];
        
        const valorLefeDn = document.getElementById('valor-lefe-dn');
        if (valorLefeDn) valorLefeDn.value = valoresPlantao['lefe-dn'];
        
        const modalValores = document.getElementById('modal-valores');
        if (modalValores) {
            modalValores.style.display = 'flex';
        }
    }
    
    function aplicarValoresPersonalizados() {
        const valorSd = document.getElementById('valor-sd');
        if (valorSd) valoresPlantao.sd = parseFloat(valorSd.value) || 100;
        
        const valorSn = document.getElementById('valor-sn');
        if (valorSn) valoresPlantao.sn = parseFloat(valorSn.value) || 100;
        
        const valorDn = document.getElementById('valor-dn');
        if (valorDn) valoresPlantao.dn = parseFloat(valorDn.value) || 200;
        
        const valorExtraSd = document.getElementById('valor-extra-sd');
        if (valorExtraSd) valoresPlantao['extra-sd'] = parseFloat(valorExtraSd.value) || 100;
        
        const valorExtraSn = document.getElementById('valor-extra-sn');
        if (valorExtraSn) valoresPlantao['extra-sn'] = parseFloat(valorExtraSn.value) || 100;
        
        const valorExtraDn = document.getElementById('valor-extra-dn');
        if (valorExtraDn) valoresPlantao['extra-dn'] = parseFloat(valorExtraDn.value) || 200;
        
        const valorLefeSd = document.getElementById('valor-lefe-sd');
        if (valorLefeSd) valoresPlantao['lefe-sd'] = parseFloat(valorLefeSd.value) || 100;
        
        const valorLefeSn = document.getElementById('valor-lefe-sn');
        if (valorLefeSn) valoresPlantao['lefe-sn'] = parseFloat(valorLefeSn.value) || 100;
        
        const valorLefeDn = document.getElementById('valor-lefe-dn');
        if (valorLefeDn) valoresPlantao['lefe-dn'] = parseFloat(valorLefeDn.value) || 250;
        
        // Salvar dados
        salvarDados();
        
        // Atualizar valores exibidos
        atualizarValoresExibidos();
        
        // Recalcular totais
        calcularTotais(mesSelecionadoGlobal, anoSelecionadoGlobal);
        
        const modalValores = document.getElementById('modal-valores');
        if (modalValores) {
            modalValores.style.display = 'none';
        }
        
        showNotification("Valores atualizados com sucesso!");
    }
    
    function carregarValoresPersonalizados() {
        // Os valores já são carregados pelo carregarDadosSalvos()
    }
    
    // Funções para personalizar nomes
    function personalizarNomes() {
        // Preencher os valores atuais
        const nomeSd = document.getElementById('nome-sd');
        if (nomeSd) nomeSd.value = labelsPlantao.sd;
        
        const nomeSn = document.getElementById('nome-sn');
        if (nomeSn) nomeSn.value = labelsPlantao.sn;
        
        const nomeDn = document.getElementById('nome-dn');
        if (nomeDn) nomeDn.value = labelsPlantao.dn;
        
        const nomeExtraSd = document.getElementById('nome-extra-sd');
        if (nomeExtraSd) nomeExtraSd.value = labelsPlantao['extra-sd'];
        
        const nomeExtraSn = document.getElementById('nome-extra-sn');
        if (nomeExtraSn) nomeExtraSn.value = labelsPlantao['extra-sn'];
        
        const nomeExtraDn = document.getElementById('nome-extra-dn');
        if (nomeExtraDn) nomeExtraDn.value = labelsPlantao['extra-dn'];
        
        const nomeLefeSd = document.getElementById('nome-lefe-sd');
        if (nomeLefeSd) nomeLefeSd.value = labelsPlantao['lefe-sd'];
        
        const nomeLefeSn = document.getElementById('nome-lefe-sn');
        if (nomeLefeSn) nomeLefeSn.value = labelsPlantao['lefe-sn'];
        
        const nomeLefeDn = document.getElementById('nome-lefe-dn');
        if (nomeLefeDn) nomeLefeDn.value = labelsPlantao['lefe-dn'];
        
        const nometroca = document.getElementById('nome-troca');
        if (nometroca) nometroca.value = labelsPlantao.troca;
        
        const modalNomes = document.getElementById('modal-nomes');
        if (modalNomes) {
            modalNomes.style.display = 'flex';
        }
    }
    
    function aplicarNomesPersonalizados() {
        const nomeSd = document.getElementById('nome-sd');
        if (nomeSd) labelsPlantao.sd = nomeSd.value || 'SD';
        
        const nomeSn = document.getElementById('nome-sn');
        if (nomeSn) labelsPlantao.sn = nomeSn.value || 'SN';
        
        const nomeDn = document.getElementById('nome-dn');
        if (nomeDn) labelsPlantao.dn = nomeDn.value || 'DN';
        
        const nomeExtraSd = document.getElementById('nome-extra-sd');
        if (nomeExtraSd) labelsPlantao['extra-sd'] = nomeExtraSd.value || 'Extra SD';
        
        const nomeExtraSn = document.getElementById('nome-extra-sn');
        if (nomeExtraSn) labelsPlantao['extra-sn'] = nomeExtraSn.value || 'Extra SN';
        
        const nomeExtraDn = document.getElementById('nome-extra-dn');
        if (nomeExtraDn) labelsPlantao['extra-dn'] = nomeExtraDn.value || 'Extra DN';
        
        const nomeLefeSd = document.getElementById('nome-lefe-sd');
        if (nomeLefeSd) labelsPlantao['lefe-sd'] = nomeLefeSd.value || 'Lefe Dia';
        
        const nomeLefeSn = document.getElementById('nome-lefe-sn');
        if (nomeLefeSn) labelsPlantao['lefe-sn'] = nomeLefeSn.value || 'Lefe Noite';
        
        const nomeLefeDn = document.getElementById('nome-lefe-dn');
        if (nomeLefeDn) labelsPlantao['lefe-dn'] = nomeLefeDn.value || 'Lefe DN';
        
        const nometroca = document.getElementById('nome-troca');
        if (nometroca) labelsPlantao.troca = nometroca.value || 'Troca';
        
        // Salvar dados
        salvarDados();
        
        // Atualizar nomes exibidos
        atualizarNomesExibidos();
        
        // Atualizar calendário
        gerarCalendario(mesSelecionadoGlobal, anoSelecionadoGlobal);
        
        const modalNomes = document.getElementById('modal-nomes');
        if (modalNomes) {
            modalNomes.style.display = 'none';
        }
        
        showNotification("Nomes atualizados com sucesso!");
    }
    
    function carregarNomesPersonalizados() {
        // Os nomes já são carregados pelo carregarDadosSalvos()
    }
    
    function atualizarValoresExibidos() {
        // Atualizar os valores exibidos nos botões do modal de plantão
        document.querySelectorAll('.valor-sd').forEach(el => {
            el.textContent = formatarMoeda(valoresPlantao.sd);
        });
        document.querySelectorAll('.valor-sn').forEach(el => {
            el.textContent = formatarMoeda(valoresPlantao.sn);
        });
        document.querySelectorAll('.valor-dn').forEach(el => {
            el.textContent = formatarMoeda(valoresPlantao.dn);
        });
        document.querySelectorAll('.valor-extra-sd').forEach(el => {
            el.textContent = formatarMoeda(valoresPlantao['extra-sd']);
        });
        document.querySelectorAll('.valor-extra-sn').forEach(el => {
            el.textContent = formatarMoeda(valoresPlantao['extra-sn']);
        });
        document.querySelectorAll('.valor-extra-dn').forEach(el => {
            el.textContent = formatarMoeda(valoresPlantao['extra-dn']);
        });
        document.querySelectorAll('.valor-lefe-sd').forEach(el => {
            el.textContent = formatarMoeda(valoresPlantao['lefe-sd']);
        });
        document.querySelectorAll('.valor-lefe-sn').forEach(el => {
            el.textContent = formatarMoeda(valoresPlantao['lefe-sn']);
        });
        document.querySelectorAll('.valor-lefe-dn').forEach(el => {
            el.textContent = formatarMoeda(valoresPlantao['lefe-dn']);
        });
        
        // Atualizar a legenda
        const legendaItems = document.querySelectorAll('.legenda-item span');
        if (legendaItems.length >= 10) {
            legendaItems[0].textContent = `Plantão Diurno (12h) - ${formatarMoeda(valoresPlantao.sd)}`;
            legendaItems[1].textContent = `Plantão Noturno (12h) - ${formatarMoeda(valoresPlantao.sn)}`;
            legendaItems[2].textContent = `Plantão Dia/Noite (24h) - ${formatarMoeda(valoresPlantao.dn)}`;
            legendaItems[3].textContent = `Plantão Extra Diurno - ${formatarMoeda(valoresPlantao['extra-sd'])}`;
            legendaItems[4].textContent = `Plantão Extra Noturno - ${formatarMoeda(valoresPlantao['extra-sn'])}`;
            legendaItems[5].textContent = `Plantão Extra Dia/Noite - ${formatarMoeda(valoresPlantao['extra-dn'])}`;
            legendaItems[6].textContent = `Plantão Lefe Diurno - ${formatarMoeda(valoresPlantao['lefe-sd'])}`;
            legendaItems[7].textContent = `Plantão Lefe Noturno - ${formatarMoeda(valoresPlantao['lefe-sn'])}`;
            legendaItems[8].textContent = `Plantão Lefe Dia/Noite - ${formatarMoeda(valoresPlantao['lefe-dn'])}`;
        }
    }
    
    function atualizarNomesExibidos() {
        // Atualizar os nomes exibidos nos botões do modal de plantão
        document.querySelectorAll('.nome-sd').forEach(el => {
            el.textContent = labelsPlantao.sd;
        });
        document.querySelectorAll('.nome-sn').forEach(el => {
            el.textContent = labelsPlantao.sn;
        });
        document.querySelectorAll('.nome-dn').forEach(el => {
            el.textContent = labelsPlantao.dn;
        });
        document.querySelectorAll('.nome-extra-sd').forEach(el => {
            el.textContent = labelsPlantao['extra-sd'];
        });
        document.querySelectorAll('.nome-extra-sn').forEach(el => {
            el.textContent = labelsPlantao['extra-sn'];
        });
        document.querySelectorAll('.nome-extra-dn').forEach(el => {
            el.textContent = labelsPlantao['extra-dn'];
        });
        document.querySelectorAll('.nome-lefe-sd').forEach(el => {
            el.textContent = labelsPlantao['lefe-sd'];
        });
        document.querySelectorAll('.nome-lefe-sn').forEach(el => {
            el.textContent = labelsPlantao['lefe-sn'];
        });
        document.querySelectorAll('.nome-lefe-dn').forEach(el => {
            el.textContent = labelsPlantao['lefe-dn'];
        });
        
        // Atualizar a legenda
        const legendaItems = document.querySelectorAll('.legenda-item strong');
        if (legendaItems.length >= 10) {
            legendaItems[0].textContent = labelsPlantao.sd;
            legendaItems[1].textContent = labelsPlantao.sn;
            legendaItems[2].textContent = labelsPlantao.dn;
            legendaItems[3].textContent = labelsPlantao['extra-sd'];
            legendaItems[4].textContent = labelsPlantao['extra-sn'];
            legendaItems[5].textContent = labelsPlantao['extra-dn'];
            legendaItems[6].textContent = labelsPlantao['lefe-sd'];
            legendaItems[7].textContent = labelsPlantao['lefe-sn'];
            legendaItems[8].textContent = labelsPlantao['lefe-dn'];
            legendaItems[9].textContent = labelsPlantao.troca;
        }
    }
    
    // Funções para configurar descrição
    function configurarDescricao() {
        // Preencher os valores atuais
        const hospitalInput = document.getElementById('hospital');
        if (hospitalInput) hospitalInput.value = configDescricao.hospital;
        
        const condutorInput = document.getElementById('condutor');
        if (condutorInput) condutorInput.value = configDescricao.condutor;
        
        const modeloSelect = document.getElementById('modelo-descricao');
        if (modeloSelect) modeloSelect.value = configDescricao.modelo;
        
        // Atualizar o exemplo
        atualizarExemploDescricao();
        
        const modalConfigDescricao = document.getElementById('modal-config-descricao');
        if (modalConfigDescricao) {
            modalConfigDescricao.style.display = 'flex';
        }
    }
    
    function atualizarExemploDescricao() {
        const hospital = document.getElementById('hospital')?.value || 'HRL';
        const condutor = document.getElementById('condutor')?.value || 'Anderson';
        const modelo = document.getElementById('modelo-descricao')?.value || 'troca';
        
        let exemplo = '';
        
        if (modelo === 'troca') {
            exemplo = `🔁 Troca de plantão: Lefe SN 📅 2/09 ➝ Lefe SD 📅 16/09 🙋🏻‍♂️ Condutor: ${condutor}`;
        } else {
            exemplo = `Lefe SN 📅 2/09 ➝ Lefe SD 📅 16/09 🙋🏻‍♂️ Condutor: ${condutor}`;
        }
        
        const exemploElement = document.getElementById('exemplo-descricao');
        if (exemploElement) {
            exemploElement.textContent = exemplo;
        }
    }
    
    function aplicarConfigDescricao() {
        const hospital = document.getElementById('hospital')?.value || 'HRL';
        const condutor = document.getElementById('condutor')?.value || 'Anderson';
        const modelo = document.getElementById('modelo-descricao')?.value || 'troca';
        
        configDescricao = {
            hospital: hospital,
            condutor: condutor,
            modelo: modelo
        };
        
        // Salvar no localStorage
        try {
            localStorage.setItem('configDescricao', JSON.stringify(configDescricao));
            debugLog("Configuração de descrição salva com sucesso");
        } catch (error) {
            console.error("Erro ao salvar configuração de descrição:", error);
        }
        
        const modalConfigDescricao = document.getElementById('modal-config-descricao');
        if (modalConfigDescricao) {
            modalConfigDescricao.style.display = 'none';
        }
        
        showNotification("Configuração de descrição aplicada com sucesso!");
    }
    
    function carregarConfigDescricao() {
        try {
            const configSalva = localStorage.getItem('configDescricao');
            if (configSalva) {
                configDescricao = JSON.parse(configSalva);
                debugLog("Configuração de descrição carregada com sucesso");
            }
        } catch (error) {
            console.error("Erro ao carregar configuração de descrição:", error);
        }
    }
    
    // Função para gerar a descrição do plantão
    function gerarDescricaoPlantao() {
        if (diaSelecionado === null) return;
        
        const chave = `${mesSelecionadoGlobal}-${anoSelecionadoGlobal}`;
        const diaInfo = calendarioData[chave] && calendarioData[chave][diaSelecionado];
        const tipos = diaInfo ? diaInfo.tipo : [];
        
        if (tipos.length === 0) {
            showNotification("Adicione pelo menos um plantão para gerar a descrição!");
            return;
        }
        
        // Pegar o primeiro tipo de plantão do dia
        const tipoIndex = tipos[0];
        if (tipoIndex === undefined || tipoIndex < 0 || tipoIndex >= tiposPlantao.length) {
            showNotification("Tipo de plantão inválido!");
            return;
        }
        
        const tipo = tiposPlantao[tipoIndex];
        const label = labelsPlantao[tipo];
        
        // Formatar a data do dia
        const dataDia = new Date(anoSelecionadoGlobal, mesSelecionadoGlobal, diaSelecionado);
        const dataFormatada = `${dataDia.getDate()}/${(dataDia.getMonth() + 1).toString().padStart(2, '0')}`;
        
        // Determinar a duração do plantão
        let duracao = '12hs';
        if (tipo === 'dn' || tipo === 'extra-dn' || tipo === 'lefe-dn') {
            duracao = '24hs';
        }
        
        let descricao = '';
        
        if (configDescricao.modelo === 'troca') {
            // Formato de troca de plantão
            // Para este exemplo, vamos usar uma data futura fixa (30/10)
            descricao = `${label} 📅 ${dataFormatada} ➝ ${label} 📅 30/10 🙋🏻‍♂️ Condutor: ${configDescricao.condutor}`;
        } else {
            // Formato simples
            descricao = `${label} 📅 ${dataFormatada} 🙋🏻‍♂️ Condutor: ${configDescricao.condutor}`;
        }
        
        const descricaoGeradaElement = document.getElementById('descricao-gerada');
        if (descricaoGeradaElement) {
            descricaoGeradaElement.textContent = descricao;
            descricaoGeradaElement.style.display = 'block';
        }
        
        const btnCopiarDescricao = document.getElementById('btn-copiar-descricao');
        if (btnCopiarDescricao) {
            btnCopiarDescricao.style.display = 'block';
        }
    }
    
    // Função para copiar a descrição gerada
    function copiarDescricaoGerada() {
        try {
            const descricaoGeradaElement = document.getElementById('descricao-gerada');
            if (!descricaoGeradaElement) {
                throw new Error("Elemento descricao-gerada não encontrado");
            }
            
            const descricao = descricaoGeradaElement.textContent;
            
            // Usar a API de clipboard moderna se disponível
            if (navigator.clipboard) {
                navigator.clipboard.writeText(descricao)
                    .then(() => {
                        showNotification('Descrição copiada para a área de transferência!');
                    })
                    .catch(err => {
                        console.error('Erro ao copiar texto: ', err);
                        // Fallback para método antigo
                        fallbackCopyTextToClipboard(descricao);
                    });
            } else {
                // Fallback para navegadores mais antigos
                fallbackCopyTextToClipboard(descricao);
            }
        } catch (error) {
            console.error("Erro ao copiar descrição:", error);
            showNotification("Erro ao copiar descrição!", 4000);
        }
    }
    
    // Função de fallback para copiar texto
    function fallbackCopyTextToClipboard(text) {
        const textArea = document.createElement("textarea");
        textArea.value = text;
        
        // Evitar rolagem até o fundo
        textArea.style.top = "0";
        textArea.style.left = "0";
        textArea.style.position = "fixed";
        
        document.body.appendChild(textArea);
        textArea.focus();
        textArea.select();
        
        try {
            const successful = document.execCommand('copy');
            const msg = successful ? 'Descrição copiada para a área de transferência!' : 'Não foi possível copiar a descrição';
            showNotification(msg);
        } catch (err) {
            console.error('Erro ao copiar texto: ', err);
            showNotification("Erro ao copiar descrição!", 4000);
        }
        
        document.body.removeChild(textArea);
    }
    
    // Função para atualizar a preview da descrição da troca
    function atualizarPreviewTroca() {
        const diaOriginal = document.getElementById('dia-original')?.value;
        const diaTroca = document.getElementById('dia-troca')?.value;
        const tipoPlantaoIndex = parseInt(document.getElementById('tipo-plantao-troca')?.value || '0');
        
        if (!diaOriginal || !diaTroca) {
            const previewElement = document.getElementById('descricao-troca-preview');
            if (previewElement) {
                previewElement.textContent = 'Selecione os dias e o tipo de plantão';
            }
            return;
        }
        
        // CORREÇÃO: Extrair componentes da data diretamente da string
        const [anoOriginal, mesOriginalStr, diaOriginalStr] = diaOriginal.split('-');
        const [anoTroca, mesTrocaStr, diaTrocaStr] = diaTroca.split('-');
        
        // Converter para números
        const mesOriginal = parseInt(mesOriginalStr) - 1;
        const diaOriginalNum = parseInt(diaOriginalStr);
        
        const mesTroca = parseInt(mesTrocaStr) - 1;
        const diaTrocaNum = parseInt(diaTrocaStr);
        
        // Obter o tipo de plantão
        const tipoPlantao = tiposPlantao[tipoPlantaoIndex];
        const labelPlantao = labelsPlantao[tipoPlantao];
        
        // Formatar as datas
        const dataOriginalFormatada = `${diaOriginalNum}/${(mesOriginal + 1).toString().padStart(2, '0')}`;
        const dataTrocaFormatada = `${diaTrocaNum}/${(mesTroca + 1).toString().padStart(2, '0')}`;
        
        // Determinar a duração do plantão
        let duracao = '12hs';
        if (tipoPlantao === 'dn' || tipoPlantao === 'extra-dn' || tipoPlantao === 'lefe-dn') {
            duracao = '24hs';
        }
        
        // Gerar a descrição conforme o modelo configurado
        let descricao = '';
        if (configDescricao.modelo === 'troca') {
            descricao = `🔁 Plantão trocado: ${labelPlantao} 📅 ${dataOriginalFormatada} ➝ ${labelPlantao} 📅 ${dataTrocaFormatada} 🙋🏻‍♂️ Condutor: ${configDescricao.condutor}`;
        } else {
            descricao = `${labelPlantao} 📅 ${dataOriginalFormatada} ➝ ${labelPlantao} 📅 ${dataTrocaFormatada} 🙋🏻‍♂️ Condutor: ${configDescricao.condutor}`;
        }
        
        const previewElement = document.getElementById('descricao-troca-preview');
        if (previewElement) {
            previewElement.textContent = descricao;
        }
    }
    
    // Funções para troca de plantão
    function abrirModalTrocaPlantao() {
        // Limpar os campos
        const diaOriginal = document.getElementById('dia-original');
        const diaTroca = document.getElementById('dia-troca');
        
        if (diaOriginal) diaOriginal.value = '';
        if (diaTroca) diaTroca.value = '';
        
        // Atualizar a preview
        atualizarPreviewTroca();
        
        const modalTrocaPlantao = document.getElementById('modal-troca-plantao');
        if (modalTrocaPlantao) {
            modalTrocaPlantao.style.display = 'flex';
        }
    }
    
    // Função para entrar no modo de edição
    function entrarModoEdicao() {
        const descricaoPreview = document.getElementById('descricao-troca-preview');
        const descricaoEditContainer = document.getElementById('descricao-edit-container');
        const descricaoEditTextarea = document.getElementById('descricao-edit-textarea');
        const btnEditarDescricao = document.getElementById('btn-editar-descricao-troca');
        
        if (descricaoPreview && descricaoEditContainer && descricaoEditTextarea) {
            // Preencher o textarea com o texto atual
            descricaoEditTextarea.value = descricaoPreview.textContent;
            
            // Mostrar o editor e esconder a visualização
            descricaoPreview.style.display = 'none';
            btnEditarDescricao.style.display = 'none';
            descricaoEditContainer.style.display = 'block';
            
            // Adicionar classe para indicar modo de edição
            descricaoEditContainer.classList.add('editando');
            
            // Adicionar classe para indicar que está editando
            descricaoPreview.classList.add('editando');
            
            // Focar no textarea
            descricaoEditTextarea.focus();
            descricaoEditTextarea.select();
            
            debugLog("Entrou no modo de edição da descrição da troca");
        }
    }
    
    // Função para sair do modo de edição
    function sairModoEdicao(salvar = false) {
        const descricaoPreview = document.getElementById('descricao-troca-preview');
        const descricaoEditContainer = document.getElementById('descricao-edit-container');
        const descricaoEditTextarea = document.getElementById('descricao-edit-textarea');
        const btnEditarDescricao = document.getElementById('btn-editar-descricao-troca');
        
        if (descricaoPreview && descricaoEditContainer && descricaoEditTextarea) {
            if (salvar) {
                // Atualizar o texto da preview
                descricaoPreview.textContent = descricaoEditTextarea.value;
                debugLog("Descrição da troca salva: " + descricaoEditTextarea.value);
            }
            
            // Esconder o editor e mostrar a visualização
            descricaoEditContainer.style.display = 'none';
            descricaoPreview.style.display = 'block';
            btnEditarDescricao.style.display = 'block';
            
            // Remover classe de modo de edição
            descricaoEditContainer.classList.remove('editando');
            descricaoPreview.classList.remove('editando');
            
            debugLog("Saiu do modo de edição da descrição da troca");
        }
    }
    
    // Função para verificar se está em modo de edição
    function estaEmModoEdicao() {
        const descricaoEditContainer = document.getElementById('descricao-edit-container');
        return descricaoEditContainer && 
               descricaoEditContainer.classList.contains('editando') && 
               descricaoEditContainer.style.display !== 'none';
    }
    
    function executarTrocaPlantao() {
        debugLog("Iniciando execução da troca de plantão");
        
        const diaOriginal = document.getElementById('dia-original')?.value;
        const diaTroca = document.getElementById('dia-troca')?.value;
        const tipoPlantaoIndex = parseInt(document.getElementById('tipo-plantao-troca')?.value || '0');
        
        debugLog(`Dia original: ${diaOriginal}, Dia troca: ${diaTroca}, Tipo: ${tipoPlantaoIndex}`);
        
        if (!diaOriginal || !diaTroca) {
            showNotification('Selecione ambos os dias para a troca!', 4000);
            return;
        }
        
        // Extrair componentes da data
        const [anoOriginal, mesOriginalStr, diaOriginalStr] = diaOriginal.split('-');
        const [anoTroca, mesTrocaStr, diaTrocaStr] = diaTroca.split('-');
        
        // Converter para números
        const mesOriginal = parseInt(mesOriginalStr) - 1;
        const diaOriginalNum = parseInt(diaOriginalStr);
        const anoOriginalNum = parseInt(anoOriginal);
        
        const mesTroca = parseInt(mesTrocaStr) - 1;
        const diaTrocaNum = parseInt(diaTrocaStr);
        const anoTrocaNum = parseInt(anoTroca);
        
        debugLog(`Data original: ${diaOriginalNum}/${mesOriginal+1}/${anoOriginalNum}`);
        debugLog(`Data troca: ${diaTrocaNum}/${mesTroca+1}/${anoTrocaNum}`);
        
        // Obter o tipo de plantão
        const tipoPlantao = tiposPlantao[tipoPlantaoIndex];
        const labelPlantao = labelsPlantao[tipoPlantao];
        
        // Formatar as datas para a descrição
        const dataOriginalFormatada = `${diaOriginalNum}/${(mesOriginal + 1).toString().padStart(2, '0')}`;
        const dataTrocaFormatada = `${diaTrocaNum}/${(mesTroca + 1).toString().padStart(2, '0')}`;
        
        // Determinar a duração do plantão
        let duracao = '12hs';
        if (tipoPlantao === 'dn' || tipoPlantao === 'extra-dn' || tipoPlantao === 'lefe-dn') {
            duracao = '24hs';
        }
        
        // Obter a descrição
        let descricaoOriginal = '';
        let descricaoTroca = '';
        
        if (estaEmModoEdicao()) {
            // Usar a descrição editada pelo usuário para o dia original
            const descricaoEditTextarea = document.getElementById('descricao-edit-textarea');
            if (descricaoEditTextarea) {
                descricaoOriginal = descricaoEditTextarea.value.trim();
                debugLog("Usando descrição editada pelo usuário para o dia original: " + descricaoOriginal);
            }
            
            // Gerar a descrição invertida para o dia da troca
            descricaoTroca = `🔁 Troca de plantão: ${labelPlantao} (${duracao}) 📅 ${dataTrocaFormatada} ➝ ${labelPlantao} 📅 ${dataOriginalFormatada} 🙋🏻‍♂️ Condutor: ${configDescricao.condutor}`;
            debugLog("Descrição gerada para o dia da troca: " + descricaoTroca);
        } else {
            // Gerar descrições automáticas para ambos os dias
            descricaoOriginal = `🔁 Troca de plantão: ${labelPlantao} (${duracao}) 📅 ${dataOriginalFormatada} ➝ ${labelPlantao} 📅 ${dataTrocaFormatada} 🙋🏻‍♂️ Condutor: ${configDescricao.condutor}`;
            descricaoTroca = `🔁 Troca de plantão: ${labelPlantao} (${duracao}) 📅 ${dataTrocaFormatada} ➝ ${labelPlantao} 📅 ${dataOriginalFormatada} 🙋🏻‍♂️ Condutor: ${configDescricao.condutor}`;
            debugLog("Descrições geradas automaticamente");
        }
        
        // Garantir que os meses/anos existam no calendário
        const chaveOriginal = `${mesOriginal}-${anoOriginalNum}`;
        const chaveTroca = `${mesTroca}-${anoTrocaNum}`;
        
        debugLog(`Chave original: ${chaveOriginal}`);
        debugLog(`Chave troca: ${chaveTroca}`);
        
        if (!calendarioData[chaveOriginal]) {
            calendarioData[chaveOriginal] = {};
            debugLog(`Criada nova entrada para ${chaveOriginal}`);
        }
        
        if (!calendarioData[chaveTroca]) {
            calendarioData[chaveTroca] = {};
            debugLog(`Criada nova entrada para ${chaveTroca}`);
        }
        
        // Garantir que os dias existam
        if (!calendarioData[chaveOriginal][diaOriginalNum]) {
            calendarioData[chaveOriginal][diaOriginalNum] = { tipo: [], legendas: [] };
            debugLog(`Criada nova entrada para o dia ${diaOriginalNum} em ${chaveOriginal}`);
        }
        
        if (!calendarioData[chaveTroca][diaTrocaNum]) {
            calendarioData[chaveTroca][diaTrocaNum] = { tipo: [], legendas: [] };
            debugLog(`Criada nova entrada para o dia ${diaTrocaNum} em ${chaveTroca}`);
        }
        
        // 1. Adicionar a anotação de troca no dia original
        const indexTrocaOriginal = calendarioData[chaveOriginal][diaOriginalNum].tipo.indexOf(6); // 6 é o índice do tipo "troca"
        if (indexTrocaOriginal === -1) {
            calendarioData[chaveOriginal][diaOriginalNum].tipo.push(6); // 6 é o índice do tipo "troca"
            calendarioData[chaveOriginal][diaOriginalNum].legendas.push(descricaoOriginal);
            debugLog(`Anotação de troca adicionada ao dia original ${diaOriginalNum}/${mesOriginal+1}`);
        } else {
            calendarioData[chaveOriginal][diaOriginalNum].legendas[indexTrocaOriginal] = descricaoOriginal;
            debugLog(`Anotação de troca atualizada no dia original ${diaOriginalNum}/${mesOriginal+1}`);
        }
        
        // 2. Adicionar a anotação de troca no dia da troca
        const indexTrocaTroca = calendarioData[chaveTroca][diaTrocaNum].tipo.indexOf(6); // 6 é o índice do tipo "troca"
        if (indexTrocaTroca === -1) {
            calendarioData[chaveTroca][diaTrocaNum].tipo.push(6); // 6 é o índice do tipo "troca"
            calendarioData[chaveTroca][diaTrocaNum].legendas.push(descricaoTroca);
            debugLog(`Anotação de troca adicionada ao dia da troca ${diaTrocaNum}/${mesTroca+1}`);
        } else {
            calendarioData[chaveTroca][diaTrocaNum].legendas[indexTrocaTroca] = descricaoTroca;
            debugLog(`Anotação de troca atualizada no dia da troca ${diaTrocaNum}/${mesTroca+1}`);
        }
        
        // Salvar os dados
        salvarDados();
        debugLog("Dados salvos com sucesso");
        
        // Obter o mês e ano atual do calendário
        const mesCalendario = parseInt(document.getElementById('mes-selecionado').value);
        const anoCalendario = parseInt(document.getElementById('ano-selecionado').value);
        
        debugLog(`Mês/ano do calendário: ${mesCalendario}/${anoCalendario}`);
        debugLog(`Mês/ano original: ${mesOriginal}/${anoOriginalNum}`);
        debugLog(`Mês/ano troca: ${mesTroca}/${anoTrocaNum}`);
        
        // Atualizar o calendário se estiver mostrando um dos meses envolvidos
        if (mesCalendario === mesOriginal && anoCalendario === anoOriginalNum) {
            debugLog("Atualizando calendário do mês original");
            gerarCalendario(mesOriginal, anoOriginalNum);
            calcularTotais(mesOriginal, anoOriginalNum);
        }
        
        if (mesCalendario === mesTroca && anoCalendario === anoTrocaNum) {
            debugLog("Atualizando calendário do mês da troca");
            gerarCalendario(mesTroca, anoTrocaNum);
            calcularTotais(mesTroca, anoTrocaNum);
        }
        
        // Fechar o modal
        const modalTrocaPlantao = document.getElementById('modal-troca-plantao');
        if (modalTrocaPlantao) {
            modalTrocaPlantao.style.display = 'none';
        }
        
        showNotification(`Troca de plantão registrada: ${labelPlantao} entre ${dataOriginalFormatada} e ${dataTrocaFormatada}!`);
    }
    
    // Funções para exportar e importar dados
    function exportarDados() {
        try {
            const dadosCompletos = {
                calendario: calendarioData,
                valores: valoresPlantao,
                nomes: labelsPlantao,
                cores: {
                    sd: getComputedStyle(document.documentElement).getPropertyValue('--sd-color').trim(),
                    sn: getComputedStyle(document.documentElement).getPropertyValue('--sn-color').trim(),
                    dn: getComputedStyle(document.documentElement).getPropertyValue('--dn-color').trim(),
                    'extra-sd': getComputedStyle(document.documentElement).getPropertyValue('--extra-sd-color').trim(),
                    'extra-sn': getComputedStyle(document.documentElement).getPropertyValue('--extra-sn-color').trim(),
                    'extra-dn': getComputedStyle(document.documentElement).getPropertyValue('--extra-dn-color').trim(),
                    'lefe-sd': getComputedStyle(document.documentElement).getPropertyValue('--lefe-sd-color').trim(),
                    'lefe-sn': getComputedStyle(document.documentElement).getPropertyValue('--lefe-sn-color').trim(),
                    'lefe-dn': getComputedStyle(document.documentElement).getPropertyValue('--lefe-dn-color').trim(),
                    troca: getComputedStyle(document.documentElement).getPropertyValue('--troca-color').trim(),
                    hoje: getComputedStyle(document.documentElement).getPropertyValue('--today-color').trim()
                }
            };
            
            // Formatar o JSON para melhor visualização
            const dadosTexto = JSON.stringify(dadosCompletos, null, 2);
            
            const modalTitulo = document.getElementById('modal-titulo');
            if (modalTitulo) {
                modalTitulo.innerHTML = '<i class="fas fa-file-export"></i> Exportar Dados';
            }
            
            const dadosTextoElement = document.getElementById('dados-texto');
            if (dadosTextoElement) {
                dadosTextoElement.value = dadosTexto;
            }
            
            const btnAplicarDados = document.getElementById('btn-aplicar-dados');
            if (btnAplicarDados) {
                btnAplicarDados.style.display = 'none';
            }
            
            const btnCopiar = document.getElementById('btn-copiar');
            if (btnCopiar) {
                btnCopiar.style.display = 'block';
            }
            
            const modalDados = document.getElementById('modal-dados');
            if (modalDados) {
                modalDados.style.display = 'flex';
            }
        } catch (error) {
            console.error("Erro ao exportar dados:", error);
            showNotification("Erro ao exportar dados!", 4000);
        }
    }
    
    function importarDados() {
        const modalTitulo = document.getElementById('modal-titulo');
        if (modalTitulo) {
            modalTitulo.innerHTML = '<i class="fas fa-file-import"></i> Importar Dados';
        }
        
        const dadosTextoElement = document.getElementById('dados-texto');
        if (dadosTextoElement) {
            dadosTextoElement.value = '';
        }
        
        const btnAplicarDados = document.getElementById('btn-aplicar-dados');
        if (btnAplicarDados) {
            btnAplicarDados.style.display = 'block';
        }
        
        const btnCopiar = document.getElementById('btn-copiar');
        if (btnCopiar) {
            btnCopiar.style.display = 'none';
        }
        
        const modalDados = document.getElementById('modal-dados');
        if (modalDados) {
            modalDados.style.display = 'flex';
        }
    }
    
    function aplicarDadosImportados() {
        try {
            const dadosTextoElement = document.getElementById('dados-texto');
            if (!dadosTextoElement) {
                throw new Error("Elemento dados-texto não encontrado");
            }
            
            const dados = JSON.parse(dadosTextoElement.value);
            
            // Validar dados básicos
            if (!dados || typeof dados !== 'object') {
                throw new Error("Dados inválidos: formato incorreto");
            }
            
            if (dados.calendario) {
                calendarioData = dados.calendario;
                // Garantir que cada entrada tenha o campo legendas
                Object.keys(calendarioData).forEach(chave => {
                    Object.keys(calendarioData[chave]).forEach(dia => {
                        if (!calendarioData[chave][dia].legendas) {
                            calendarioData[chave][dia].legendas = [];
                        }
                        // Garantir que o array de legendas tenha o mesmo tamanho que o array de tipos
                        if (calendarioData[chave][dia].tipo) {
                            while (calendarioData[chave][dia].legendas.length < calendarioData[chave][dia].tipo.length) {
                                calendarioData[chave][dia].legendas.push('');
                            }
                        }
                    });
                });
            }
            
            if (dados.valores) {
                valoresPlantao = dados.valores;
                atualizarValoresExibidos();
            }
            
            if (dados.nomes) {
                labelsPlantao = dados.nomes;
                atualizarNomesExibidos();
            }
            
            if (dados.cores) {
                localStorage.setItem('coresPlantao', JSON.stringify(dados.cores));
                carregarCoresPersonalizadas();
                aplicarCoresCSS();
            }
            
            // Salvar dados
            salvarDados();
            
            // Recarregar o calendário atual
            const mes = parseInt(document.getElementById('mes-selecionado')?.value || mesAtual);
            const ano = parseInt(document.getElementById('ano-selecionado')?.value || anoAtual);
            gerarCalendario(mes, ano);
            
            fecharModal();
            showNotification("Dados importados com sucesso!");
        } catch (e) {
            console.error("Erro ao aplicar dados importados:", e);
            showNotification("Dados inválidos. Por favor, verifique o formato.", 4000);
        }
    }
    
    function copiarTexto() {
        try {
            const dadosTextoElement = document.getElementById('dados-texto');
            if (!dadosTextoElement) {
                throw new Error("Elemento dados-texto não encontrado");
            }
            
            dadosTextoElement.select();
            document.execCommand('copy');
            showNotification('Dados copiados para a área de transferência!');
        } catch (error) {
            console.error("Erro ao copiar texto:", error);
            showNotification("Erro ao copiar dados!", 4000);
        }
    }
    
    function fecharModal() {
        document.querySelectorAll('.modal').forEach(modal => {
            modal.style.display = 'none';
        });
    }

</script>
</body>
</html>
